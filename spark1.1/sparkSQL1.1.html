<!DOCTYPE html>
<html>
<head>
<title>sparkSQL1.1-zhangzikuo</title>
<style>
#body{
margin-left:auto;
margin-right:auto;
}
</style>
</head>
<body>
<div id="body">
<h2>sparkSQL1.1知识整理</h2>
<div style="line-height:28px; font-family:'Hiragino Sans GB W3','Hiragino Sans GB',Arial,Helvetica,simsun,宋体; font-size:16px">
2014年9月11日，Spark1.1.0忽然之间发布。笔者立即下载、编译、部署了Spark1.1.0。关于Spark1.1的编译和部署，改天在说。
<div style="line-height:28px; font-family:'Hiragino Sans GB W3','Hiragino Sans GB',Arial,Helvetica,simsun,宋体; font-size:16px">
&nbsp; &nbsp; &nbsp; Spark1.1.0中变化较大是sparkSQL和MLlib，sparkSQL1.1.0主要的变动有：</div>
<div style="line-height:28px; font-family:'Hiragino Sans GB W3','Hiragino Sans GB',Arial,Helvetica,simsun,宋体; font-size:16px">
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>增加了JDBC/ODBC Server（ThriftServer），用户可以在应用程序中连接到SparkSQL并使用其中的表和缓存表。</li><li>增加了对JSON文件的支持</li><li>增加了对parquet文件的本地优化</li><li>增加了支持将python、scala、java的lambda函数注册成UDF，并能在SQL中直接引用</li><li>引入了动态字节码生成技术（bytecode generation，即CG），明显地提升了复杂表达式求&#20540;查询的速率。</li><li>统一API接口，如sql()、SchemaRDD生成等。</li><li>......</li></ul>
</div>
<div style="line-height:28px; font-family:'Hiragino Sans GB W3','Hiragino Sans GB',Arial,Helvetica,simsun,宋体; font-size:16px">
&nbsp; &nbsp; &nbsp; 下面分十个小节来介绍sparkSQL1.1.0的架构和使用，希望各位读者joy it！</div>
<div style="line-height:28px; font-family:'Hiragino Sans GB W3','Hiragino Sans GB',Arial,Helvetica,simsun,宋体; font-size:16px">
<div><img alt="" src="https://img-blog.csdn.net/20140915094251365?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYm9va19tbWlja3k=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<div><br>
</div>
第一节：为什么sparkSQL &nbsp; 为本篇，介绍sparkSQL的发展历程和性能</div>
<div style="line-height:28px; font-family:'Hiragino Sans GB W3','Hiragino Sans GB',Arial,Helvetica,simsun,宋体; font-size:16px">
第二节：sparkSQL架构 &nbsp; 介绍catalyst，然后介绍sqlContext、hiveContext的运行架构及区别</div>
<div style="line-height:28px; font-family:'Hiragino Sans GB W3','Hiragino Sans GB',Arial,Helvetica,simsun,宋体; font-size:16px">
第三节：sparkSQL组件之解析 &nbsp; 介绍sparkSQL运行架构中的各个组件的功能和实现</div>
<div style="line-height:28px; font-family:'Hiragino Sans GB W3','Hiragino Sans GB',Arial,Helvetica,simsun,宋体; font-size:16px">
第四节：深入了解sparkSQL之运行 &nbsp; 使用hive/console更深入了解各种计划是如何生成的</div>
<div style="line-height:28px; font-family:'Hiragino Sans GB W3','Hiragino Sans GB',Arial,Helvetica,simsun,宋体; font-size:16px">
第五节：测试环境之搭建 &nbsp; 介绍后面章节将使用的环境搭建和测试数据</div>
<div style="line-height:28px; font-family:'Hiragino Sans GB W3','Hiragino Sans GB',Arial,Helvetica,simsun,宋体; font-size:16px">
第六节：sparkSQL之基础应用 &nbsp; 介绍sqlContext的RDD、Json、parquet使用以及hiveContext使用</div>
<div style="line-height:28px; font-family:'Hiragino Sans GB W3','Hiragino Sans GB',Arial,Helvetica,simsun,宋体; font-size:16px">
第七节：ThriftServer和CLI&nbsp;&nbsp; 介绍TriftServer和CLI的使用，以及如何使用JDBC访问sparkSQL数据</div>
<div style="line-height:28px; font-family:'Hiragino Sans GB W3','Hiragino Sans GB',Arial,Helvetica,simsun,宋体; font-size:16px">
第八节：sparkSQL之综合应用 &nbsp; 介绍sparkSQL和MLlib、sparkSQL和GraphX结合使用</div>
<div style="line-height:28px; font-family:'Hiragino Sans GB W3','Hiragino Sans GB',Arial,Helvetica,simsun,宋体; font-size:16px">
第九节：sparkSQL之调优 &nbsp; 介绍CG、压缩、序化器、缓存之使用</div>
<div style="line-height:28px; font-family:'Hiragino Sans GB W3','Hiragino Sans GB',Arial,Helvetica,simsun,宋体; font-size:16px">
第十节：总结</div>
<div style="line-height:28px; font-family:'Hiragino Sans GB W3','Hiragino Sans GB',Arial,Helvetica,simsun,宋体; font-size:16px">
至于与hive的兼容性、具体的SQL语法以后有机会再介绍。</div>



<article>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
2014年9月11日，Spark1.1.0忽然之间发布。笔者立即下载、编译、部署了Spark1.1.0。关于Spark1.1的编译和部署，请参看笔者博客<a target="_blank" href="http://blog.csdn.net/book_mmicky/article/details/25714445" rel="nofollow" style="color:rgb(255,153,0); text-decoration:none">Spark1.1.0 源码编译和部署包生成</a>&nbsp;。</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
&nbsp; &nbsp; &nbsp; Spark1.1.0中变化较大是sparkSQL和MLlib，sparkSQL1.1.0主要的变动有：</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>增加了JDBC/ODBC Server（ThriftServer），用户可以在应用程序中连接到SparkSQL并使用其中的表和缓存表。</li><li>增加了对JSON文件的支持</li><li>增加了对parquet文件的本地优化</li><li>增加了支持将python、scala、java的lambda函数注册成UDF，并能在SQL中直接引用</li><li>引入了动态字节码生成技术（bytecode generation，即CG），明显地提升了复杂表达式求值查询的速率。</li><li>统一API接口，如sql()、SchemaRDD生成等。</li><li>......</li></ul>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
&nbsp; &nbsp; &nbsp; 下面分十个小节来介绍sparkSQL1.1.0的架构和使用，希望各位读者joy it！</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div><img alt="" src="./css/20140915094251365" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<div><br>
</div>
第一节：为什么sparkSQL &nbsp; 为本篇，介绍sparkSQL的发展历程和性能</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
第二节：sparkSQL架构 &nbsp; 介绍catalyst，然后介绍sqlContext、hiveContext的运行架构及区别</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
第三节：sparkSQL组件之解析 &nbsp; 介绍sparkSQL运行架构中的各个组件的功能和实现</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
第四节：深入了解sparkSQL之运行 &nbsp; 使用hive/console更深入了解各种计划是如何生成的</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
第五节：测试环境之搭建 &nbsp; 介绍后面章节将使用的环境搭建和测试数据</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
第六节：sparkSQL之基础应用 &nbsp; 介绍sqlContext的RDD、Json、parquet使用以及hiveContext使用</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
第七节：ThriftServer和CLI&nbsp;&nbsp; 介绍TriftServer和CLI的使用，以及如何使用JDBC访问sparkSQL数据</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
第八节：sparkSQL之综合应用 &nbsp; 介绍sparkSQL和MLlib、sparkSQL和GraphX结合使用</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
第九节：sparkSQL之调优 &nbsp; 介绍CG、压缩、序化器、缓存之使用</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
第十节：总结</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
至于与hive的兼容性、具体的SQL语法以后有机会再介绍。</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<br>
</div>
<h2 style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px"><a name="t0"></a>
<a target="_blank" name="t0"></a>一：为什么sparkSQL？</h2>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
1：sparkSQL的发展历程。</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
A：hive and shark</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
&nbsp; &nbsp; &nbsp; sparkSQL的前身是shark。在hadoop发展过程中，为了给熟悉RDBMS但又不理解MapReduce的技术人员提供快速上手的工具，hive应运而生，是当时唯一运行在hadoop上的SQL-on-Hadoop工具。但是，MapReduce计算过程中大量的中间磁盘落地过程消耗了大量的I/O，降低的运行效率，为了提高SQL-on-Hadoop的效率，大量的SQL-on-Hadoop工具开始产生，其中表现较为突出的是：</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>MapR的Drill</li><li>Cloudera的Impala</li><li>Shark</li></ul>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
&nbsp; &nbsp; &nbsp; 其中Shark是伯克利实验室spark生态环境的组件之一，它修改了下图所示的右下角的内存管理、物理计划、执行三个模块，并使之能运行在spark引擎上，从而使得SQL查询的速度得到10-100倍的提升。</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div>
<div><img alt="" src="./css/20140915094310865" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<div><br>
</div>
B：Shark和sparkSQL &nbsp; &nbsp; &nbsp;&nbsp;</div>
<div>&nbsp; &nbsp; &nbsp; 但是，随着Spark的发展，对于野心勃勃的Spark团队来说，Shark对于hive的太多依赖（如采用hive的语法解析器、查询优化器等等），制约了Spark的One Stack rule them all的既定方针，制约了spark各个组件的相互集成，所以提出了sparkSQL项目。SparkSQL抛弃原有Shark的代码，汲取了Shark的一些优点，如内存列存储（In-Memory Columnar Storage）、Hive兼容性等，重新开发了SparkSQL代码；由于摆脱了对hive的依赖性，SparkSQL无论在数据兼容、性能优化、组件扩展方面都得到了极大的方便，真可谓“退一步，&nbsp;海阔天空”。</div>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>数据兼容方面 &nbsp;不但兼容hive，还可以从RDD、parquet文件、JSON文件中获取数据，未来版本甚至支持获取RDBMS数据以及cassandra等NOSQL数据</li><li>性能优化方面 &nbsp;除了采取In-Memory Columnar Storage、byte-code&nbsp;generation等优化技术外、将会引进Cost Model对查询进行动态评估、获取最佳物理计划等等</li><li>组件扩展方面 &nbsp;无论是SQL的语法解析器、分析器还是优化器都可以重新定义，进行扩展</li></ul>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
&nbsp; &nbsp; &nbsp; 2014年6月1日，Shark项目和SparkSQL项目的主持人Reynold Xin宣布：停止对Shark的开发，团队将所有资源放sparkSQL项目上，至此，Shark的发展画上了句话，但也因此发展出两个直线：SparkSQL和hive on spark。</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div><img alt="" src="./css/20140915094140531" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
其中sparkSQL作为Spark生态的一员继续发展，而不再受限于hive，只是兼容hive；而hive on spark是一个hive的发展计划，该计划将spark作为hive的底层引擎之一，也就是说，hive将不再受限于一个引擎，可以采用map-reduce、Tez、spark等引擎。</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<br>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
2：sparkSQL的性能</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
&nbsp; &nbsp; &nbsp; shark的出现，使得SQL-on-Hadoop的性能比hive有了10-100倍的提高：</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div><img alt="" src="./css/20140915094400333" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp; &nbsp; &nbsp; &nbsp;那么，摆脱了hive的限制，sparkSQL的性能又有怎么样的表现呢？虽然没有shark相对于hive那样瞩目地性能提升，但也表现得非常优异：</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div><img alt="" src="./css/20140915094415699" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;&nbsp; &nbsp; &nbsp; 为什么sparkSQL的性能会得到怎么大的提升呢？主要sparkSQL在下面几点做了优化：</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
A：内存列存储（In-Memory Columnar Storage）</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div>&nbsp; &nbsp; &nbsp; sparkSQL的表数据在内存中存储不是采用原生态的JVM对象存储方式，而是采用内存列存储，如下图所示。</div>
<div>
<div><img alt="" src="./css/20140915094425901" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp; &nbsp; &nbsp; 该存储方式无论在空间占用量和读取吞吐率上都占有很大优势。</div>
<div>&nbsp; &nbsp; &nbsp; 对于原生态的JVM对象存储方式，每个对象通常要增加12-16字节的额外开销，对于一个270MB的TPC-H lineitem table数据，使用这种方式读入内存，要使用970MB左右的内存空间（通常是2～5倍于原生数据空间）；另外，使用这种方式，每个数据记录产生一个JVM对象，如果是大小为200B的数据记录，32G的堆栈将产生1.6亿个对象，这么多的对象，对于GC来说，可能要消耗几分钟的时间来处理（JVM的垃圾收集时间与堆栈中的对象数量呈线性相关）。显然这种内存存储方式对于基于内存计算的spark来说，很昂贵也负担不起。</div>
<div>&nbsp; &nbsp; &nbsp; 对于内存列存储来说，将所有原生数据类型的列采用原生数组来存储，将Hive支持的复杂数据类型（如array、map等）先序化后并接成一个字节数组来存储。这样，每个列创建一个JVM对象，从而导致可以快速的GC和紧凑的数据存储；额外的，还可以使用低廉CPU开销的高效压缩方法（如字典编码、行长度编码等压缩方法）降低内存开销；更有趣的是，对于分析查询中频繁使用的聚合特定列，性能会得到很大的提高，原因就是这些列的数据放在一起，更容易读入内存进行计算。</div>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<br>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
B：字节码生成技术（bytecode generation，即CG）</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div>&nbsp; &nbsp; &nbsp; 在数据库查询中有一个昂贵的操作是查询语句中的表达式，主要是由于JVM的内存模型引起的。比如如下一个查询：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39288715#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39288715#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39288715#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39288715#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/468891" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/468891/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:4382px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 2961px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_1" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_1" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=1&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 2961px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_91" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_91" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=91&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">SELECT&nbsp;a&nbsp;+&nbsp;b&nbsp;FROM&nbsp;table&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div>&nbsp; &nbsp; &nbsp; 在这个查询里，如果采用通用的SQL语法途径去处理，会先生成一个表达式树（有两个节点的Add树，参考后面章节），在物理处理这个表达式树的时候，将会如图所示的7个步骤：</div>
<div>
<ol style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>调用虚函数Add.eval()，需要确认Add两边的数据类型</li><li>调用虚函数a.eval()，需要确认a的数据类型</li><li>确定a的数据类型是Int，装箱</li><li>调用虚函数b.eval()，需要确认b的数据类型</li><li>确定b的数据类型是Int，装箱</li><li>调用Int类型的Add</li><li>返回装箱后的计算结果</li></ol>
</div>
<div>其中多次涉及到虚函数的调用，虚函数的调用会打断CPU的正常流水线处理，减缓执行。</div>
<div>&nbsp; &nbsp; &nbsp; Spark1.1.0在catalyst模块的expressions增加了codegen模块，如果使用动态字节码生成技术（配置spark.sql.codegen参数），sparkSQL在执行物理计划的时候，对匹配的表达式采用特定的代码，动态编译，然后运行。如上例子，匹配到Add方法：</div>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div><img alt="" src="./css/20140915094456384" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
然后，通过调用，最终调用：</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<img alt="" src="./css/20140915094505853" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
最终实现效果类似如下伪代码：</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39288715#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39288715#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39288715#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39288715#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/468891" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/468891/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:5274px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 3588px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_2" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_2" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=2&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 3588px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_92" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_92" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=92&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">val&nbsp;a:&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">Int</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">inputRow</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.getInt(0)&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">val&nbsp;b:&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">Int</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">inputRow</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.getInt(1)&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">val&nbsp;result:&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">Int</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">a</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;+&nbsp;b&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">resultRow.setInt(0,&nbsp;result)&nbsp;&nbsp;</span></li></ol>
</div>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
对于Spark1.1.0，对SQL表达式都作了CG优化，具体可以参看codegen模块。CG优化的实现主要还是依靠scala2.10的运行时放射机制（runtime reflection）。对于SQL查询的CG优化，可以简单地用下图来表示：</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div><img alt="" src="./css/20140915094548457" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
C：scala代码优化</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
&nbsp; &nbsp; &nbsp; 另外，sparkSQL在使用Scala编写代码的时候，尽量避免低效的、容易GC的代码；尽管增加了编写代码的难度，但对于用户来说，还是使用统一的接口，没受到使用上的困难。下图是一个scala代码优化的示意图：</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div><img alt="" src="./css/20140915094605320" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<h2><a name="t1"></a><a target="_blank" name="t1"></a>&nbsp;<a target="_blank" href="http://blog.csdn.net/book_mmicky/article/details/39956809" rel="nofollow" style="line-height:30px; font-family:&#39;Microsoft YaHei&#39;; color:rgb(51,51,51); font-size:20px; text-decoration:none">二：sparkSQL运行架构</a></h2>
<h2><a name="t2"></a><a target="_blank" name="t2"></a><span style="text-align:right; color:rgb(153,153,153); font-size:16px">在介绍sparkSQL之前，我们首先来看看，传统的关系型数据库是怎么运行的。当我们提交了一个很简单的查询：</span></h2>
<div id="article_content" class="article_content">
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/481566" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/481566/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:497px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 4064px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_3" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_3" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=3&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 4064px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_93" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_93" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=93&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">SELECT&nbsp;&nbsp;a1,a2,a3&nbsp;&nbsp;FROM&nbsp;&nbsp;tableA&nbsp;&nbsp;Where&nbsp;&nbsp;condition&nbsp;&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141010090742518" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
可以看得出来，该语句是由Projection（a1，a2，a3）、Data Source（tableA）、Filter（condition）组成，分别对应sql查询过程中的Result、Data Source、Operation，也就是说SQL语句按Result--&gt;Data Source--&gt;Operation的次序来描述的。那么，SQL语句在实际的运行过程中是怎么处理的呢？一般的数据库系统先将读入的SQL语句（Query）先进行解析（Parse），分辨出SQL语句中哪些词是关键词（如SELECT、FROM、WHERE），哪些是表达式、哪些是Projection、哪些是Data
 Source等等。这一步就可以判断SQL语句是否规范，不规范就报错，规范就继续下一步过程绑定（Bind），这个过程将SQL语句和数据库的数据字典（列、表、视图等等）进行绑定，如果相关的Projection、Data Source等等都是存在的话，就表示这个SQL语句是可以执行的；而在执行前，一般的数据库会提供几个执行计划，这些计划一般都有运行统计数据，数据库会在这些计划中选择一个最优计划（Optimize），最终执行该计划（Execute），并返回结果。当然在实际的执行过程中，是按Operation--&gt;Data
 Source--&gt;Result的次序来进行的，和SQL语句的次序刚好相反；在执行过程有时候甚至不需要读取物理表就可以返回结果，比如重新运行刚运行过的SQL语句，可能直接从数据库的缓冲池中获取返回结果。</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
&nbsp; &nbsp; &nbsp; 以上过程看上去非常简单，但实际上会包含很多复杂的操作细节在里面。而这些操作细节都和Tree有关，在数据库解析（Parse）SQL语句的时候，会将SQL语句转换成一个树型结构来进行处理，如下面一个查询，会形成一个含有多个节点（TreeNode）的Tree，然后在后续的处理过程中对该Tree进行一系列的操作。</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<img alt="" src="./css/20141010090811908" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
下图给出了对Tree的一些可能的操作细节，对于Tree的处理过程中所涉及更多的细节，可以查看相关的数据库论文。</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<img alt="" src="./css/20141010090630593" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div><br>
</div>
&nbsp;OK，上面简单介绍了关系型数据库的运行过程，那么，sparkSQL是不是也采用类似的方式处理呢？答案是肯定的。下面我们先来看看sparkSQL中的两个重要概念Tree和Rule、然后再介绍一下sparkSQL的两个分支sqlContext和hiveContext、最后再综合看看sparkSQL的优化器Catalyst。</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<br>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
1：Tree和Rule</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
&nbsp; &nbsp; &nbsp; sparkSQL对SQL语句的处理和关系型数据库对SQL语句的处理采用了类似的方法，首先会将SQL语句进行解析（Parse），然后形成一个Tree，在后续的如绑定、优化等处理过程都是对Tree的操作，而操作的方法是采用Rule，通过模式匹配，对不同类型的节点采用不同的操作。</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
A：Tree</div>
<ul style="padding-bottom:0px; line-height:28px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px; padding-top:0px">
<li style="font-size:1em"><span style="font-size:1em">Tree的相关代码定义在</span><span style="font-size:1em">sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/trees</span></li><li style="font-size:1em"><span style="font-size:1em">Logical Plans、Expressions、Physical Operators都可以使用Tree表示</span></li><li style="font-size:1em"><span style="font-size:1em">Tree的具体操作是通过TreeNode来实现的</span>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li style="font-size:1em">sparkSQL定义了catalyst.trees的日志，通过这个日志可以形象的表示出树的结构</li><li style="font-size:1em"><span style="font-size:1em">TreeNode可以使用scala的集合操作方法（如foreach, map, flatMap, collect等）进行操作</span></li><li>有了TreeNode，通过Tree中各个TreeNode之间的关系，可以对Tree进行遍历操作，如使用transformDown、transformUp将Rule应用到给定的树段，然后用结果替代旧的树段；也可以使用transformChildrenDown、transformChildrenUp对一个给定的节点进行操作，通过迭代将Rule应用到该节点以及子节点。</li></ul>
</li></ul>
<img alt="" src="./css/20141010091019127" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>TreeNode可以细分成三种类型的Node：
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>UnaryNode 一元节点，即只有一个子节点。如Limit、Filter操作</li><li>BinaryNode 二元节点，即有左右子节点的二叉节点。如Jion、Union操作</li><li>LeafNode 叶子节点，没有子节点的节点。主要用户命令类操作，如SetCommand</li></ul>
</li></ul>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div><img alt="" src="./css/20141010091119530" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<br>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
B：Rule</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>Rule的相关代码定义在sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/rules</li><li>Rule在sparkSQL的Analyzer、Optimizer、SparkPlan等各个组件中都有应用到</li><li>Rule是一个抽象类，具体的Rule实现是通过RuleExecutor完成</li><li>Rule通过定义batch和batchs，可以简便的、模块化地对Tree进行transform操作</li><li>Rule通过定义Once和FixedPoint，可以对Tree进行一次操作或多次操作（如对某些Tree进行多次迭代操作的时候，达到FixedPoint次数迭代或达到前后两次的树结构没变化才停止操作，具体参看RuleExecutor.apply）</li></ul>
<div><img alt="" src="./css/20141010091143195" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<div>&nbsp; &nbsp; &nbsp; 拿个简单的例子，在处理由解析器（SqlParse）生成的LogicPlan Tree的时候，在Analyzer中就定义了多种Rules应用到LogicPlan Tree上。</div>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
&nbsp; &nbsp; &nbsp; 应用示意图：<br>
<div>
<div><img alt="" src="./css/20141010091018093" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp; &nbsp; &nbsp;&nbsp;Analyzer中使用的Rules，定义了batches，由多个batch构成，如MultiInstanceRelations、Resolution、Check Analysis、AnalysisOperators等构成；每个batch又有不同的rule构成，如Resolution由ResolveReferences 、ResolveRelations、ResolveSortReferences 、NewRelationInstances等构成；每个rule又有自己相对应的处理函数，可以具体参看Analyzer中的ResolveReferences
 、ResolveRelations、ResolveSortReferences 、NewRelationInstances函数；同时要注意的是，不同的rule应用次数是不同的：如CaseInsensitiveAttributeReferences这个batch中rule只应用了一次（Once），而Resolution这个batch中的rule应用了多次（fixedPoint = FixedPoint(100)，也就是说最多应用100次，除非前后迭代结果一致退出）。</div>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div><img alt="" src="./css/20141010091257202" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<div>在整个sql语句的处理过程中，Tree和Rule相互配合，完成了解析、绑定（在sparkSQL中称为Analysis）、优化、物理计划等过程，最终生成可以执行的物理计划。</div>
<div>知道了sparkSQL的各个过程的基本处理方式，下面来看看sparkSQL的运行过程。sparkSQL有两个分支，sqlContext和hivecontext，sqlContext现在只支持sql语法解析器（SQL-92语法）；hiveContext现在支持sql语法解析器和hivesql语法解析器，默认为hivesql语法解析器，用户可以通过配置切换成sql语法解析器，来运行hiveql不支持的语法，如select 1。关于sqlContext和hiveContext的具体应用请参看第六部分。</div>
<div><br>
</div>
<div>2：sqlContext的运行过程</div>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
&nbsp; &nbsp; &nbsp; sqlContext是使用sqlContext.sql（sqlText）来提交用户sql语句：</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/481566" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/481566/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:2355px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 6332px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_4" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_4" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=4&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 6332px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_94" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_94" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=94&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">/**源自sql/core/src/main/scala/org/apache/spark/sql/SQLContext.scala&nbsp;&nbsp;*/&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;def&nbsp;sql(sqlText:&nbsp;String):&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">SchemaRDD</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">dialect</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;==&nbsp;"sql")&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;SchemaRDD(this,&nbsp;parseSql(sqlText))&nbsp;&nbsp;&nbsp;//parseSql(sqlText)对sql语句进行语法解析&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sys.error(s"Unsupported&nbsp;SQL&nbsp;dialect:&nbsp;$dialect")&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;}&nbsp;&nbsp;</span></li></ol>
</div>
sqlContext.sql的返回结果是SchemaRDD，调用了new SchemaRDD(this, parseSql(sqlText)) 来对sql语句进行处理，处理之前先使用catalyst.SqlParser对sql语句进行语法解析，使之生成Unresolved LogicalPlan。<span style="font-family:monospace; white-space:pre"></span></div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<span style="font-family:monospace; white-space:pre"></span>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/481566" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/481566/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:2617px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 6600px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_5" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_5" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=5&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 6600px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_95" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_95" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=95&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">/**源自sql/core/src/main/scala/org/apache/spark/sql/SQLContext.scala&nbsp;&nbsp;*/&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;protected[sql]&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">parser</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">new</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;catalyst.SqlParser&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;protected[sql]&nbsp;def&nbsp;parseSql(sql:&nbsp;String):&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">LogicalPlan</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">parser</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">(sql)&nbsp;&nbsp;</span></span></li></ol>
</div>
<span style="font-family:monospace; white-space:pre">类</span><span style="font-family:monospace; white-space:pre">SchemaRDD继承自</span><span style="font-family:monospace; white-space:pre">SchemaRDDLike</span></div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<img alt="" src="./css/20141010091311429" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/481566" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/481566/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:2762px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 6780px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_6" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_6" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=6&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 6780px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_96" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_96" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=96&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">/**源自sql/core/src/main/scala/org/apache/spark/sql/SchemaRDD.scala&nbsp;&nbsp;*/&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">class&nbsp;SchemaRDD(&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;@transient&nbsp;val&nbsp;sqlContext:&nbsp;SQLContext,&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;@transient&nbsp;val&nbsp;baseLogicalPlan:&nbsp;LogicalPlan)&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;extends&nbsp;RDD[Row](sqlContext.sparkContext,&nbsp;Nil)&nbsp;with&nbsp;SchemaRDDLike&nbsp;&nbsp;</span></li></ol>
</div>
<span style="font-family:monospace; white-space:pre"></span><span style="font-family:monospace; white-space:pre">SchemaRDDLike中调用sqlContext.executePlan(baseLogicalPlan)来执行catalyst.SqlParser解析后生成Unresolved LogicalPlan，这里的baseLogicalPlan就是指Unresolved LogicalPlan。</span><span style="font-family:monospace; white-space:pre"></span></div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<span style="font-family:monospace; white-space:pre"></span>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/481566" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/481566/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:2970px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 6968px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_7" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_7" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=7&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 6968px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_97" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_97" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=97&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">/**源自sql/core/src/main/scala/org/apache/spark/sql/SchemaRDDLike.scala&nbsp;&nbsp;*/&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">private[sql]&nbsp;trait&nbsp;SchemaRDDLike&nbsp;{&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;@transient&nbsp;val&nbsp;sqlContext:&nbsp;SQLContext&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;@transient&nbsp;val&nbsp;baseLogicalPlan:&nbsp;LogicalPlan&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;private[sql]&nbsp;def&nbsp;baseSchemaRDD:&nbsp;SchemaRDD&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;lazy&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">queryExecution</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">sqlContext</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.executePlan(baseLogicalPlan)&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div><span style="font-family:monospace; white-space:pre">sqlContext.executePlan做了什么呢？它调用了</span><span style="font-family:monospace; white-space:pre">QueryExecution类</span></div>
<div><span style="font-family:monospace; white-space:pre"></span>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/481566" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/481566/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:3186px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 7190px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_8" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_8" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=8&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 7190px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_98" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_98" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=98&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">/**源自sql/core/src/main/scala/org/apache/spark/sql/SQLContext.scala&nbsp;&nbsp;*/&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">protected[sql]&nbsp;def&nbsp;executePlan(plan:&nbsp;LogicalPlan):&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">this.QueryExecution</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">new</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;this.QueryExecution&nbsp;{&nbsp;val&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">logical</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">plan</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;}&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<span style="font-family:monospace; white-space:pre">QueryExecution类的定义：</span></div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<span style="font-family:monospace; white-space:pre"></span>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/481566" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/481566/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:3332px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 7342px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_9" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_9" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=9&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 7342px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_99" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_99" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=99&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">/**源自sql/core/src/main/scala/org/apache/spark/sql/SQLContext.scala&nbsp;&nbsp;*/&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">protected&nbsp;abstract&nbsp;class&nbsp;QueryExecution&nbsp;{&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;logical:&nbsp;LogicalPlan&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//对Unresolved&nbsp;LogicalPlan进行analyzer，生成resolved&nbsp;LogicalPlan&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;lazy&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">analyzed</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">ExtractPythonUdfs</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">(analyzer(logical))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//对resolved&nbsp;LogicalPlan进行optimizer，生成optimized&nbsp;LogicalPlan&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;lazy&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">optimizedPlan</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">optimizer</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">(analyzed)&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;将optimized&nbsp;LogicalPlan转换成PhysicalPlan&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;lazy&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">sparkPlan</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SparkPlan.currentContext.set(self)&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;planner(optimizedPlan).next()&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;PhysicalPlan执行前的准备工作，生成可执行的物理计划&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;lazy&nbsp;val&nbsp;executedPlan:&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">SparkPlan</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">prepareForExecution</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">(sparkPlan)&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//执行可执行物理计划&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;lazy&nbsp;val&nbsp;toRdd:&nbsp;RDD[Row]&nbsp;=&nbsp;executedPlan.execute()&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;......&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;}&nbsp;&nbsp;</span></li></ol>
</div>
sqlContext总的一个过程如下图所示：</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<ol style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>SQL语句经过SqlParse解析成<span style="font-family:monospace"><span style="white-space:pre">Unresolved</span></span><span style="font-family:monospace; white-space:pre">LogicalPlan；</span></li><li><span style="font-family:monospace; white-space:pre">使用</span><span style="font-family:monospace; white-space:pre">analyzer结合数据数据字典（catalog）进行绑定，生成</span><span style="font-family:monospace"><span style="white-space:pre">resolved</span></span><span style="font-family:monospace; white-space:pre">LogicalPlan；</span></li><li><span style="font-family:monospace"><span style="white-space:pre">使用</span></span><span style="font-family:monospace; white-space:pre">optimizer对</span><span style="font-family:monospace"><span style="white-space:pre">resolved</span></span><span style="font-family:monospace; white-space:pre">LogicalPlan进行优化，生成</span><span style="font-family:monospace; white-space:pre">optimized</span><span style="font-family:monospace; white-space:pre">LogicalPlan；</span></li><li><span style="font-family:monospace"><span style="white-space:pre">使用</span></span><span style="font-family:monospace; white-space:pre">SparkPlan将</span><span style="font-family:monospace; white-space:pre">LogicalPlan转换成</span><span style="font-family:monospace; white-space:pre">PhysicalPlan；</span></li><li><span style="font-family:monospace"><span style="white-space:pre">使用</span></span><span style="font-family:monospace; white-space:pre">prepareForExecution()将</span><span style="font-family:monospace; white-space:pre">PhysicalPlan转换成可执行物理计划；</span></li><li><span style="font-family:monospace"><span style="white-space:pre">使用</span></span><span style="font-family:monospace; white-space:pre">execute()执行</span><span style="font-family:monospace; white-space:pre">可执行物理计划；</span></li><li><span style="font-family:monospace; white-space:pre">生成SchemaRDD。</span></li></ol>
<div><span style="font-family:monospace"><span style="white-space:pre">在整个运行过程中涉及到多个sparkSQL的组件，如</span></span>SqlParse、<span style="font-family:monospace; white-space:pre">analyzer、</span><span style="font-family:monospace; white-space:pre">optimizer、</span><span style="font-family:monospace; white-space:pre">SparkPlan等等，其功能和</span><span style="font-family:monospace"><span style="white-space:pre">实现在下一章节中详解。</span></span></div>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<span style="font-family:monospace; white-space:pre"><img alt="" src="./css/20141010091108125" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</span></div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<br>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<br>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
3：hiveContext的运行过程</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
&nbsp; &nbsp; &nbsp; 在分布式系统中，由于历史原因，很多数据已经定义了hive的元数据，通过这些hive元数据，sparkSQL使用hiveContext很容易实现对这些数据的访问。值得注意的是hiveContext继承自sqlContext，所以在hiveContext的的运行过程中除了override的函数和变量，可以使用和sqlContext一样的函数和变量。</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
&nbsp; &nbsp; &nbsp; 从sparkSQL1.1开始，hiveContext使用hiveContext.sql（sqlText）来提交用户sql语句进行查询：</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/481566" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/481566/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:4286px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 8376px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_10" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_10" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=10&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 8376px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_100" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_100" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=100&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">/**源自sql/hive/src/main/scala/org/apache/spark/sql/hive/HiveContext.scala&nbsp;&nbsp;*/&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">override&nbsp;def&nbsp;sql(sqlText:&nbsp;String):&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">SchemaRDD</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;使用spark.sql.dialect定义采用的语法解析器&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">dialect</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;==&nbsp;"sql")&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super.sql(sqlText)&nbsp;&nbsp;&nbsp;&nbsp;//如果使用sql解析器，则使用sqlContext的sql方法&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">dialect</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;==&nbsp;"hiveql")&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//如果使用和hiveql解析器，则使用HiveQl.parseSql&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;SchemaRDD(this,&nbsp;HiveQl.parseSql(sqlText))&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;else&nbsp;{&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sys.error(s"Unsupported&nbsp;SQL&nbsp;dialect:&nbsp;$dialect.&nbsp;&nbsp;Try&nbsp;'sql'&nbsp;or&nbsp;'hiveql'")&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;}&nbsp;&nbsp;</span></li></ol>
</div>
hiveContext.sql首先根据用户的语法设置（spark.sql.dialect）决定具体的执行过程，如果dialect == "sql"则采用sqlContext的sql语法执行过程；如果是dialect == "hiveql"，则采用hiveql语法执行过程。在这里我们主要看看hiveql语法执行过程。可以看出，hiveContext.sql调用了new SchemaRDD(this, HiveQl.parseSql(sqlText))对hiveql语句进行处理，处理之前先使用对语句进行语法解析。<span style="font-family:monospace; white-space:pre"></span></div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<span style="font-family:monospace; white-space:pre"></span>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/481566" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/481566/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:4629px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 8753px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_11" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_11" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=11&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 8753px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_101" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_101" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=101&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">/**源自src/main/scala/org/apache/spark/sql/hive/HiveQl.scala&nbsp;&nbsp;*/&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;/**&nbsp;Returns&nbsp;a&nbsp;LogicalPlan&nbsp;for&nbsp;a&nbsp;given&nbsp;HiveQL&nbsp;string.&nbsp;*/&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;def&nbsp;parseSql(sql:&nbsp;String):&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">LogicalPlan</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(条件)&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//非hive命令的处理，如set、cache&nbsp;table、add&nbsp;jar等直接转化成command类型的LogicalPlan&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.....&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">tree</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">getAst</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">(sql)&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(nativeCommands&nbsp;contains&nbsp;tree.getText)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NativeCommand(sql)&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nodeToPlan(tree)&nbsp;match&nbsp;{&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">NativePlaceholder</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;NativeCommand(sql)&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">other</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;other&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;{&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//异常处理&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;......&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;}&nbsp;&nbsp;</span></li></ol>
</div>
<span style="font-family:monospace; white-space:pre"></span></div>
<span style="line-height:28px; font-family:monospace; white-space:pre; font-size:16px">因为sparkSQL所支持的hiveql除了兼容hive语句外，还兼容一些sparkSQL本身的语句，所以在HiveQl.parseSql对hiveql语句语法解析的时候：</span>
<ul style="padding-bottom:0px; line-height:28px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px; padding-top:0px">
<li>首先考虑一些非hive语句的处理，这些命令属于sparkSQL本身的命令语句，如设置sparkSQL运行参数的set命令、cache table、add jar等，将这些语句转换成command类型的LogicalPlan；</li><li>如果是hive语句，则调用getAst(sql)使用hive的ParseUtils将该语句先解析成AST树，然后根据AST树中的关键字进行转换：类似命令型的语句、DDL类型的语句转换成command类型的LogicalPlan；其他的转换通过nodeToPlan转换成LogicalPlan。</li></ul>
<div><span style="font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体"><span style="line-height:28px; white-space:pre"></span></span>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/481566" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/481566/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:5243px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 9413px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_12" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_12" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=12&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 9413px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_102" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_102" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=102&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">/**源自src/main/scala/org/apache/spark/sql/hive/HiveQl.scala&nbsp;&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">/**&nbsp;*&nbsp;Returns&nbsp;the&nbsp;AST&nbsp;for&nbsp;the&nbsp;given&nbsp;SQL&nbsp;string.&nbsp;&nbsp;&nbsp;&nbsp;*/&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;def&nbsp;getAst(sql:&nbsp;String):&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">ASTNode</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">ParseUtils</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.findRootNonNullToken((new&nbsp;ParseDriver).parse(sql))&nbsp;&nbsp;</span></span></li></ol>
</div>
<span style="line-height:28px; font-family:monospace; white-space:pre; font-size:16px"></span><span style="line-height:28px; font-family:monospace; white-space:pre; font-size:16px">和sqlContext一样，类SchemaRDD继承自SchemaRDDLike，SchemaRDDLike调用sqlContext.executePlan(baseLogicalPlan)，不过hiveContext重写了executePlan()函数：</span><span style="line-height:28px; font-family:monospace; white-space:pre; font-size:16px"></span></div>
<div><span style="line-height:28px; font-family:monospace; white-space:pre; font-size:16px"></span>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/481566" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/481566/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:5389px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 9566px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_13" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_13" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=13&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 9566px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_103" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_103" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=103&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">/**源自sql/hive/src/main/scala/org/apache/spark/sql/hive/HiveContext.scala&nbsp;&nbsp;*/&nbsp;&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">override&nbsp;protected[sql]&nbsp;def&nbsp;executePlan(plan:&nbsp;LogicalPlan):&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">this.QueryExecution</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">new</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;this.QueryExecution&nbsp;{&nbsp;val&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">logical</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">plan</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;}&nbsp;&nbsp;</span></span></li></ol>
</div>
<span style="line-height:28px; font-family:monospace; white-space:pre; font-size:16px">并使用了一个继承自sqlContext.</span><span style="line-height:28px; font-family:monospace; white-space:pre; font-size:16px">QueryExecution的</span><span style="line-height:28px; font-family:monospace; white-space:pre; font-size:16px">新的</span><span style="line-height:28px; font-family:monospace; white-space:pre; font-size:16px">QueryExecution类</span><span style="line-height:28px; font-family:monospace; white-space:pre; font-size:16px">：</span></div>
<div><span style="line-height:28px; font-family:monospace; white-space:pre; font-size:16px"></span>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/481566" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/481566/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:5534px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 9718px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_14" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_14" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=14&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 9718px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_104" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_104" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=104&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">/**源自sql/hive/src/main/scala/org/apache/spark/sql/hive/HiveContext.scala&nbsp;&nbsp;*/&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;protected[sql]&nbsp;abstract&nbsp;class&nbsp;QueryExecution&nbsp;extends&nbsp;super.QueryExecution&nbsp;{&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO:&nbsp;Create&nbsp;mixin&nbsp;for&nbsp;the&nbsp;analyzer&nbsp;instead&nbsp;of&nbsp;overriding&nbsp;things&nbsp;here.&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;override&nbsp;lazy&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">optimizedPlan</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">optimizer</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">(ExtractPythonUdfs(catalog.PreInsertionCasts(catalog.CreateTables(analyzed))))&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;override&nbsp;lazy&nbsp;val&nbsp;toRdd:&nbsp;RDD[Row]&nbsp;=&nbsp;executedPlan.execute().map(_.copy())&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;......&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;}&nbsp;&nbsp;</span></li></ol>
</div>
<span style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px"></span></div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
所以在hiveContext的运行过程基本和sqlContext一致，除了override的catalog、functionRegistry、analyzer、planner、optimizedPlan、toRdd。</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
hiveContext的catalog，是指向 Hive Metastore：</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/481566" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/481566/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:5841px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 10032px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_15" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_15" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=15&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 10032px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_105" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_105" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=105&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">/**源自sql/hive/src/main/scala/org/apache/spark/sql/hive/HiveContext.scala&nbsp;&nbsp;*/&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">/*&nbsp;A&nbsp;catalyst&nbsp;metadata&nbsp;catalog&nbsp;that&nbsp;points&nbsp;to&nbsp;the&nbsp;Hive&nbsp;Metastore.&nbsp;*/&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;@transient&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;override&nbsp;protected[sql]&nbsp;lazy&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">catalog</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">new</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;HiveMetastoreCatalog(this)&nbsp;with&nbsp;OverrideCatalog&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;override&nbsp;def&nbsp;lookupRelation(&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;databaseName:&nbsp;Option[String],&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tableName:&nbsp;String,&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alias:&nbsp;Option[String]&nbsp;=&nbsp;None):&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">LogicalPlan</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LowerCaseSchema(super.lookupRelation(databaseName,&nbsp;tableName,&nbsp;alias))&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;}&nbsp;&nbsp;</span></li></ol>
</div>
hiveContext的analyzer，使用了新的catalog和functionRegistry：</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/481566" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/481566/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:6145px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 10342px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_16" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_16" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=16&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 10342px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_106" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_106" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=106&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">/**源自sql/hive/src/main/scala/org/apache/spark/sql/hive/HiveContext.scala&nbsp;&nbsp;*/&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;/*&nbsp;An&nbsp;analyzer&nbsp;that&nbsp;uses&nbsp;the&nbsp;Hive&nbsp;metastore.&nbsp;*/&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;@transient&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;override&nbsp;protected[sql]&nbsp;lazy&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">analyzer</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">new</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;Analyzer(catalog,&nbsp;functionRegistry,&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">caseSensitive</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">false</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">)&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
hiveContext的planner，使用新定义的hivePlanner：</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39956809#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/481566" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/481566/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:6326px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 10530px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_17" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_17" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=17&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 10530px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_107" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_107" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=107&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">/**源自sql/hive/src/main/scala/org/apache/spark/sql/hive/HiveContext.scala&nbsp;&nbsp;*/&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;@transient&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;override&nbsp;protected[sql]&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">planner</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">hivePlanner</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
所以hiveContext总的一个过程如下图所示：</div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<ol style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>SQL语句经过HiveQl.parseSql解析成Unresolved LogicalPlan，在这个解析过程中对hiveql语句使用getAst()获取AST树，然后再进行解析；</li><li>使用analyzer结合数据hive源数据Metastore（新的catalog）进行绑定，生成resolved LogicalPlan；</li><li>使用optimizer对resolved LogicalPlan进行优化，生成optimized LogicalPlan，优化前使用了ExtractPythonUdfs(catalog.PreInsertionCasts(catalog.CreateTables(analyzed)))进行预处理；</li><li>使用hivePlanner将LogicalPlan转换成PhysicalPlan；</li><li>使用prepareForExecution()将PhysicalPlan转换成可执行物理计划；</li><li>使用execute()执行可执行物理计划；</li><li>执行后，使用map(_.copy)将结果导入SchemaRDD。</li></ol>
<span style="font-family:monospace; white-space:pre">hiveContxt还有很多针对hive的特性，更细节的内容参看源码。</span></div>
<div style="line-height:28px; font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:16px">
<div>
<div><img alt="" src="./css/20141010091139890" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;</div>
<div>4：catalyst优化器</div>
<div>&nbsp; &nbsp; &nbsp; sparkSQL1.1总体上由四个模块组成：core、catalyst、hive、hive-Thriftserver：</div>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>core处理数据的输入输出，从不同的数据源获取数据（RDD、Parquet、json等），将查询结果输出成schemaRDD；</li><li>catalyst处理查询语句的整个处理过程，包括解析、绑定、优化、物理计划等，说其是优化器，还不如说是查询引擎；</li><li>hive对hive数据的处理</li><li>hive-ThriftServer提供CLI和JDBC/ODBC接口</li></ul>
<div>&nbsp; &nbsp; &nbsp; 在这四个模块中，catalyst处于最核心的部分，其性能优劣将影响整体的性能。由于发展时间尚短，还有很多不足的地方，但其插件式的设计，为未来的发展留下了很大的空间。下面是catalyst的一个设计图：</div>
<div><img alt="" src="./css/20141010091152500" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
</div>
<div>&nbsp;其中虚线部分是以后版本要实现的功能，实线部分是已经实现的功能。从上图看，catalyst主要的实现组件有：</div>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>sqlParse，完成sql语句的语法解析功能，目前只提供了一个简单的sql解析器；</li><li>Analyzer，主要完成绑定工作，将不同来源的Unresolved LogicalPlan和数据元数据（如hive metastore、Schema catalog）进行绑定，生成resolved LogicalPlan；</li><li>optimizer对resolved LogicalPlan进行优化，生成optimized LogicalPlan；</li><li>Planner将LogicalPlan转换成PhysicalPlan；</li><li>CostModel，主要根据过去的性能统计数据，选择最佳的物理执行计划</li></ul>
<div><span style="font-family:monospace"><span style="white-space:pre">这些组件的基本实现方法：</span></span></div>
<div><span style="font-family:monospace"><span style="white-space:pre"></span></span>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>先将sql语句通过解析生成Tree，然后在不同阶段使用不同的Rule应用到Tree上，通过转换完成各个组件的功能。</li><li>Analyzer使用Analysis Rules，配合数据元数据（如hive metastore、Schema catalog），完善Unresolved LogicalPlan的属性而转换成resolved LogicalPlan；</li><li>optimizer使用Optimization Rules，对resolved LogicalPlan进行合并、列裁剪、过滤器下推等优化作业而转换成optimized LogicalPlan；</li><li>Planner使用Planning Strategies，对optimized LogicalPlan</li></ul>
</div>
</div>
<div><span style="font-family:monospace"><span style="white-space:pre">关于本篇中涉及到的相关概念和组件在下篇再详细介绍。</span></span></div>
<h2><a name="t3"></a><a target="_blank" name="t3"></a><span style="font-family:monospace"><span style="white-space:pre"><a target="_blank" href="http://blog.csdn.net/book_mmicky/article/details/40504483" rel="nofollow" style="line-height:30px; font-family:&#39;Microsoft YaHei&#39;; color:rgb(51,51,51); font-size:20px; text-decoration:none">三：sparkSQL组件之解析</a></span></span></h2>
<div><span style="font-family:monospace"><span style="font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体">上篇在</span><span style="font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体">总体上</span><span style="font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体">介绍了sparkSQL的运行架构及其基本实现方法（Tree和Rule的配合），也大致介绍了sparkSQL中涉及到的各个概念和组件。本篇将详细地介绍一下关键的一些概念和组件，由于hiveContext继承自sqlContext，关键的概念和组件类似，只不过后者针对hive的特性做了一些修正和重写，所以本篇就只介绍sqlContext的</span><wbr style="font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体"><span style="font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体">关键的概念和组件。</span><span style="line-height:26px; font-family:Arial; font-size:14px"></span>
<div style="font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体">
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>概念：
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li><span style="font-family:monospace; white-space:pre">LogicalPlan</span></li></ul>
</li><li><span style="font-family:monospace; white-space:pre">组件：</span>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li><span style="font-family:monospace; white-space:pre">SqlParser</span></li><li><span style="font-family:monospace; white-space:pre">Analyzer</span></li><li><span style="font-family:monospace; white-space:pre">Optimizer</span></li><li><span style="font-family:monospace; white-space:pre">Planner</span></li></ul>
</li></ul>
</div>
<div style="font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体">
<div style="font-family:monospace; white-space:pre"><br>
</div>
<div style="font-family:monospace; white-space:pre">1：LogicalPlan</div>
<div style="font-family:monospace; white-space:pre">在sparkSQL的运行架构中，LogicalPlan贯穿了大部分的过程，其中catalyst中的SqlParser、Analyzer、Optimizer都要对LogicalPlan进行操作。LogicalPlan的定义如下:</div>
<div><pre style="BORDER-BOTTOM: rgb(136,136,136) 1px solid; BORDER-LEFT: rgb(136,136,136) 1px solid; PADDING-BOTTOM: 2px; PADDING-LEFT: 2px; PADDING-RIGHT: 2px; WORD-WRAP: break-word; WHITE-SPACE: pre-wrap; BORDER-TOP: rgb(136,136,136) 1px solid; BORDER-RIGHT: rgb(136,136,136) 1px solid; PADDING-TOP: 2px" class="prettyprint" name="code" snippet_file_name="blog_20141118_1_1347690" code_snippet_id="524149">&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;abstract class LogicalPlan extends QueryPlan[LogicalPlan] {
  self: Product =&gt;
  case class Statistics(
    sizeInBytes: BigInt
  )
  lazy val statistics: Statistics = {
    if (children.size == 0) {
      throw new UnsupportedOperationException(s"LeafNode $nodeName must implement statistics.")
    }

    Statistics(
      sizeInBytes = children.map(_.statistics).map(_.sizeInBytes).product)
  }

  /**
   * Returns the set of attributes that this node takes as
   * input from its children.
   */
  lazy val inputSet: AttributeSet = AttributeSet(children.flatMap(_.output))

  /**
   * Returns true if this expression and all its children have been resolved to a specific schema
   * and false if it is still contains any unresolved placeholders. Implementations of LogicalPlan
   * can override this (e.g.
   * [[org.apache.spark.sql.catalyst.analysis.UnresolvedRelation UnresolvedRelation]]
   * should return `false`).
   */
  lazy val resolved: Boolean = !expressions.exists(!_.resolved) &amp;&amp; childrenResolved

  /**
   * Returns true if all its children of this query plan have been resolved.
   */
  def childrenResolved: Boolean = !children.exists(!_.resolved)

  /**
   * Optionally resolves the given string to a [[NamedExpression]] using the input from all child
   * nodes of this LogicalPlan. The attribute is expressed as
   * as string in the following form: `[scope].AttributeName.[nested].[fields]...`.
   */
  def resolveChildren(name: String): Option[NamedExpression] =
    resolve(name, children.flatMap(_.output))

  /**
   * Optionally resolves the given string to a [[NamedExpression]] based on the output of this
   * LogicalPlan. The attribute is expressed as string in the following form:
   * `[scope].AttributeName.[nested].[fields]...`.
   */
  def resolve(name: String): Option[NamedExpression] =
    resolve(name, output)

  /** Performs attribute resolution given a name and a sequence of possible attributes. */
  protected def resolve(name: String, input: Seq[Attribute]): Option[NamedExpression] = {
    val parts = name.split("\\.")
    val options = input.flatMap { option =&gt;
      val remainingParts =
        if (option.qualifiers.contains(parts.head) &amp;&amp; parts.size &gt; 1) parts.drop(1) else parts
      if (option.name == remainingParts.head) (option, remainingParts.tail.toList) :: Nil else Nil
    }

    options.distinct match {
      case Seq((a, Nil)) =&gt; Some(a) // One match, no nested fields, use it.
      // One match, but we also need to extract the requested nested field.
      case Seq((a, nestedFields)) =&gt;
        a.dataType match {
          case StructType(fields) =&gt;
            Some(Alias(nestedFields.foldLeft(a: Expression)(GetField), nestedFields.last)())
          case _ =&gt; None // Don't know how to resolve these field references
        }
      case Seq() =&gt; None         // No matches.
      case ambiguousReferences =&gt;
        throw new TreeNodeException(
          this, s"Ambiguous references to $name: ${ambiguousReferences.mkString(",")}")
    }
  }
}&lt;/p&gt;</pre>在LogicalPlan里维护者一套统计数据和属性数据，也提供了解析方法。同时延伸了三种类型的LogicalPlan：</div>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>LeafNode：对应于trees.LeafNode的LogicalPlan</li><li>UnaryNode：对应于trees.UnaryNode的LogicalPlan</li><li>BinaryNode：对应于trees.BinaryNode的LogicalPlan</li></ul>
</div>
<div style="font-family:monospace; white-space:pre">而对于SQL语句解析时，会调用和SQL匹配的操作方法来进行解析；这些操作分四大类，最终生成LeafNode、UnaryNode、BinaryNode中的一种：</div>
<div style="font-family:monospace; white-space:pre">
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>basicOperators：一些数据基本操作，如Ioin、Union、Filter、Project、Sort</li><li>commands：一些命令操作，如SetCommand、CacheCommand</li><li>partitioning：一些分区操作，如RedistributeData</li><li>ScriptTransformation：对脚本的处理，如ScriptTransformation</li><li>LogicalPlan类的总体架构如下所示</li></ul>
</div>
<div style="font-family:monospace; white-space:pre">
<div><img alt="" src="./css/20141027105435521" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;</div>
<div style="font-family:monospace; white-space:pre">2：SqlParser</div>
<div style="font-family:monospace; white-space:pre">SqlParser的功能就是将SQL语句解析成Unresolved LogicalPlan。现阶段的SqlParser语法解析功能比较简单，支持的语法比较有限。其解析过程中有两个关键组件和一个关键函数：</div>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li><span style="font-family:monospace; white-space:pre">词法读入器Sql</span><span style="font-family:monospace"><span style="white-space:pre">Lexical，其作用就是将输入的SQL语句进行扫描、去空、去注释、校验、分词等动作。</span></span></li><li><span style="font-family:monospace; white-space:pre">SQL语法表达式query，其作用定义SQL语法表达式，同时也定义了SQL语法表达式的具体实现，即将不同的表达式生成不同sparkSQL的</span><span style="font-family:monospace; white-space:pre">Unresolved LogicalPlan。</span></li><li><span style="font-family:monospace"><span style="white-space:pre">函数phrase()，上面个两个组件通过调用phrase(query)(new lexical.Scanner(input))，完成对SQL语句的解析；在</span><span style="white-space:pre">解析过程中，SqlLexical一边读入，一边解析，如果碰上生成符合SQL语法的表达式时，就调用相应SQL语法表达式的具体实现函数，将SQL语句解析成Unresolved
 LogicalPlan。 </span></span></li></ul>
</div>
<div style="font-family:monospace; white-space:pre">下面看看sparkSQL的整个解析过程和相关组件：</div>
<div style="font-family:monospace; white-space:pre">A：解析过程</div>
<div style="font-family:monospace; white-space:pre">首先，在sqlContext中使用下面代码调用catalyst.SqlParser：</div>
<div><pre style="BORDER-BOTTOM: rgb(136,136,136) 1px solid; BORDER-LEFT: rgb(136,136,136) 1px solid; PADDING-BOTTOM: 2px; PADDING-LEFT: 2px; PADDING-RIGHT: 2px; WORD-WRAP: break-word; WHITE-SPACE: pre-wrap; BORDER-TOP: rgb(136,136,136) 1px solid; BORDER-RIGHT: rgb(136,136,136) 1px solid; PADDING-TOP: 2px" class="prettyprint" name="code" snippet_file_name="blog_20141118_2_3380129" code_snippet_id="524149">&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;&lt;span style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"&gt;&lt;span style="white-space: normal;"&gt;/*源自 sql/core/src/main/scala/org/apache/spark/sql/SQLContext.scala */&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;&lt;span style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"&gt;&lt;span style="white-space: normal;"&gt;&nbsp; protected[sql] val parser = new catalyst.SqlParser&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;&lt;span style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"&gt;&lt;span style="white-space: normal;"&gt;&nbsp; protected[sql] def parseSql(sql: String): LogicalPlan = parser(sql)&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;</pre>然后，直接在SqlParser的apply方法中对输入的SQL语句进行解析，解析功能的核心代码就是：</div>
<div>phrase(query)(new lexical.Scanner(input))</div>
<div><pre style="BORDER-BOTTOM: rgb(136,136,136) 1px solid; BORDER-LEFT: rgb(136,136,136) 1px solid; PADDING-BOTTOM: 2px; PADDING-LEFT: 2px; PADDING-RIGHT: 2px; WORD-WRAP: break-word; WHITE-SPACE: pre-wrap; BORDER-TOP: rgb(136,136,136) 1px solid; BORDER-RIGHT: rgb(136,136,136) 1px solid; PADDING-TOP: 2px" class="prettyprint" name="code" snippet_file_name="blog_20141118_3_6402147" code_snippet_id="524149">&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;/*源自 src/main/scala/org/apache/spark/sql/catalyst/SqlParser.scala */&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;class SqlParser extends StandardTokenParsers with PackratParsers {
  def apply(input: String): LogicalPlan = {
    if (input.trim.toLowerCase.startsWith("set")) {
      //set设置项的处理&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;    ......
    } else {
      &lt;span style="color: rgb(255, 0, 0);"&gt;phrase(query)(new lexical.Scanner(input))&lt;/span&gt; match {
        case Success(r, x) =&gt; r
        case x =&gt; sys.error(x.toString)
      }
    }
  }&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;......&lt;/p&gt;</pre></div>
<div>可以看得出来，该语句就是调用<span style="font-family:monospace; white-space:pre">phrase()函数，</span>使用SQL语法表达式query，对词法读入器lexical读入的SQL语句进行解析，其中词法读入器lexical通过重写语句：override val lexical = new SqlLexical(reservedWords) 调用扩展了功能的SqlLexical。其定义：</div>
<div><pre style="BORDER-BOTTOM: rgb(136,136,136) 1px solid; BORDER-LEFT: rgb(136,136,136) 1px solid; PADDING-BOTTOM: 2px; PADDING-LEFT: 2px; PADDING-RIGHT: 2px; WORD-WRAP: break-word; WHITE-SPACE: pre-wrap; BORDER-TOP: rgb(136,136,136) 1px solid; BORDER-RIGHT: rgb(136,136,136) 1px solid; PADDING-TOP: 2px" class="prettyprint" name="code" snippet_file_name="blog_20141118_4_188316" code_snippet_id="524149">&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;&lt;span style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"&gt;/*源自 src/main/scala/org/apache/spark/sql/catalyst/SqlParser.scala */&lt;/span&gt; &nbsp;&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;// Use reflection to find the reserved words defined in this class.
  protected val reservedWords =
    this.getClass
      .getMethods
      .filter(_.getReturnType == classOf[Keyword])
      .map(_.invoke(this).asInstanceOf[Keyword].str)

  override val lexical = new SqlLexical(reservedWords)&lt;/p&gt;</pre></div>
<div>
<div>为了加深对SQL语句解析过程的理解，让我们看看下面这个简单数字表达式解析过程来说明：</div>
<div><pre style="BORDER-BOTTOM: rgb(136,136,136) 1px solid; BORDER-LEFT: rgb(136,136,136) 1px solid; PADDING-BOTTOM: 2px; PADDING-LEFT: 2px; PADDING-RIGHT: 2px; WORD-WRAP: break-word; WHITE-SPACE: pre-wrap; BORDER-TOP: rgb(136,136,136) 1px solid; BORDER-RIGHT: rgb(136,136,136) 1px solid; PADDING-TOP: 2px" class="prettyprint" name="code" snippet_file_name="blog_20141118_5_4813516" code_snippet_id="524149">&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;import scala.util.parsing.combinator.PackratParsers
import scala.util.parsing.combinator.syntactical._

object mylexical extends StandardTokenParsers with PackratParsers {
  //定义分割符
  lexical.delimiters ++= List(".", ";", "+", "-", "*")
  //定义表达式，支持加，减，乘
  lazy val expr: PackratParser[Int] = plus | minus | multi
  //加法表示式的实现
  lazy val plus: PackratParser[Int] = num ~ "+" ~ num ^^ { case n1 ~ "+" ~ n2 =&gt; n1.toInt + n2.toInt}
  //减法表达式的实现
  lazy val minus: PackratParser[Int] = num ~ "-" ~ num ^^ { case n1 ~ "-" ~ n2 =&gt; n1.toInt - n2.toInt}
  //乘法表达式的实现
  lazy val multi: PackratParser[Int] = num ~ "*" ~ num ^^ { case n1 ~ "*" ~ n2 =&gt; n1.toInt * n2.toInt}
  lazy val num = numericLit

  def parse(input: String) =&nbsp;{&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;    //定义词法读入器myread，并将扫描头放置在input的首位&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;    val myread = new PackratReader(new lexical.Scanner(input)) 
    print("处理表达式 " + input)
    phrase(expr)(myread) match {
      case Success(result, _) =&gt; println(" Success!"); println(result); Some(result)
      case n =&gt; println(n); println("Err!"); None
    }
  }

  def main(args: Array[String]) {
    val prg = "6 * 3" :: "24-/*aaa*/4" :: "a+5" :: "21/3" :: Nil
    prg.map(parse)
  }
}&lt;/p&gt;</pre>运行结果：</div>
<div><pre style="BORDER-BOTTOM: rgb(136,136,136) 1px solid; BORDER-LEFT: rgb(136,136,136) 1px solid; PADDING-BOTTOM: 2px; PADDING-LEFT: 2px; PADDING-RIGHT: 2px; WORD-WRAP: break-word; WHITE-SPACE: pre-wrap; BORDER-TOP: rgb(136,136,136) 1px solid; BORDER-RIGHT: rgb(136,136,136) 1px solid; PADDING-TOP: 2px" class="prettyprint" name="code" snippet_file_name="blog_20141118_6_4978615" code_snippet_id="524149">&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;处理表达式 6 * 3 Success!     //lexical对空格进行了处理，得到6*3
18     //6*3符合乘法表达式，调用n1.toInt * n2.toInt，得到结果并返回&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;处理表达式 24-/*aaa*/4 Success!  //lexical对注释进行了处理，得到20-4
20    //20-4符合减法表达式，调用n1.toInt - n2.toInt，得到结果并返回
处理表达式 a+5[1.1] failure: number expected 
      //lexical在解析到a，发现不是整数型，故报错误位置和内容
a+5
^
Err!
处理表达式 21/3[1.3] failure: ``*'' expected but ErrorToken(illegal character) found
      //lexical在解析到/，发现不是分割符，故报错误位置和内容
21/3
  ^
Err!&lt;/p&gt;</pre>
<div>&nbsp; &nbsp; &nbsp; 在运行的时候，首先对表达式 6 * 3 进行解析，词法读入器myread将扫描头置于6的位置；当phrase()函数使用定义好的数字表达式expr处理6 * 3的时候，6 * 3每读入一个词法，就和expr进行匹配，如读入6*和expr进行匹配，先匹配表达式plus，*和+匹配不上；就继续匹配表达式minus，*和-匹配不上；就继续匹配表达式multi，这次匹配上了，等读入3的时候，因为3是num类型，就调用调用n1.toInt * n2.toInt进行计算。</div>
<div>&nbsp; &nbsp; &nbsp; 注意，这里的expr、plus、minus、multi、num都是表达式，|、~、^^是复合因子，表达式和复合因子可以组成一个新的表达式，如plus（num ~ "+" ~ num ^^ { case n1 ~ "+" ~ n2 =&gt; n1.toInt + n2.toInt}）就是一个由num、+、num、函数构成的复合表达式；而expr（plus | minus | multi）是由plus、minus、multi构成的复合表达式；复合因子的含义定义在类scala/util/parsing/combinator/Parsers.scala，下面是几个常用的复合因子：</div>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>p ~ q<span style="white-space:pre"> </span>p成功，才会q；放回p,q的结果</li><li>p ~&gt; q<span style="white-space:pre"> </span>p成功，才会q，返回q的结果</li><li>p &lt;~ q<span style="white-space:pre"> </span>p成功，才会q，返回p的结果</li><li>p | q<span style="white-space:pre"> </span>p失败则q，返回第一个成功的结果</li><li>p ^^ f<span style="white-space:pre"> </span>如果p成功，将函数f应用到p的结果上</li><li>p ^? f<span style="white-space:pre"> </span>如果p成功，如果函数f可以应用到p的结果上的话，就将p的结果用f进行转换</li></ul>
</div>
<div>&nbsp; &nbsp; &nbsp; 针对上面的6 * 3使用的是multi表达式（num ~ "*" ~ num ^^ { case n1 ~ "*" ~ n2 =&gt; n1.toInt * n2.toInt}），其含义就是：num后跟*再跟num，如果满足就将使用函数n1.toInt * n2.toInt。</div>
<div>&nbsp; &nbsp; &nbsp; 到这里为止，大家应该明白整个解析过程了吧，<img title="sparkSQL1.1入门之三：sparkSQL组件之解析 - mmicky - mmicky 的博客" alt="sparkSQL1.1入门之三：sparkSQL组件之解析 - mmicky - mmicky 的博客" src="./css/face1.gif" style="border-right-width:0px; max-width:100%; border-top-width:0px; border-bottom-width:0px; border-left-width:0px">。SqlParser的原理和这个表达式解析器使用了一样的原理，只不过是定义的SQL语法表达式query复杂一些，使用的词法读入器更丰富一些而已。下面分别介绍一下相关组件SqlParser、SqlLexical、query。</div>
<div><br>
</div>
<div>B：SqlParser</div>
<div>首先，看看SqlParser的UML图：</div>
<div><img alt="" src="./css/20141027105454506" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<div>其次，看看SqlParser的定义，SqlParser继承自类StandardTokenParsers和特质PackratParsers：</div>
<div>其中，PackratParsers：</div>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>扩展了scala.util.parsing.combinator.Parsers所提供的parser，做了内存化处理；</li><li>Packrat解析器实现了回溯解析和递归下降解析，具有无限先行和线性分析时的优势。同时，也支持左递归词法解析。</li><li>从Parsers中继承出来的class或trait都可以使用PackratParsers，如：object MyGrammar extends StandardTokenParsers with PackratParsers；</li><li>PackratParsers将分析结果进行缓存，因此，PackratsParsers需要PackratReader（内存化处理的Reader）作为输入，程序员可以手工创建PackratReader，如production(new PackratReader(new lexical.Scanner(input)))，更多的细节参见scala库中/scala/util/parsing/combinator/PackratParsers.scala文件。</li></ul>
<div>StandardTokenParsers是最终继承自Parsers</div>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>增加了词法的处理能力（Parsers是字符处理），在StdTokenParsers中定义了四种基本词法：
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>keyword tokens</li><li>numeric literal tokens</li><li>string literal tokens</li><li>identifier tokens</li></ul>
</li><li>定义了一个词法读入器lexical，可以进行词法读入</li></ul>
</div>
<div>SqlParser在进行解析SQL语句的时候是调用了PackratParsers中phrase()：</div>
<div><pre style="BORDER-BOTTOM: rgb(136,136,136) 1px solid; BORDER-LEFT: rgb(136,136,136) 1px solid; PADDING-BOTTOM: 2px; PADDING-LEFT: 2px; PADDING-RIGHT: 2px; WORD-WRAP: break-word; WHITE-SPACE: pre-wrap; BORDER-TOP: rgb(136,136,136) 1px solid; BORDER-RIGHT: rgb(136,136,136) 1px solid; PADDING-TOP: 2px" class="prettyprint" name="code" snippet_file_name="blog_20141118_7_4030899" code_snippet_id="524149">&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;/*源自 scala/util/parsing/combinator/PackratParsers.scala&nbsp;*/&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt; /**
   *  A parser generator delimiting whole phrases (i.e. programs).
   *
   *  Overridden to make sure any input passed to the argument parser
   *  is wrapped in a `PackratReader`.
   */
  override def phrase[T](p: Parser[T]) = {
    val q = super.phrase(p)
    new PackratParser[T] {
      def apply(in: Input) = in match {
        case in: PackratReader[_] =&gt; q(in)
        case in =&gt; q(new PackratReader(in))
      }
    }
  }&lt;/p&gt;</pre>在解析过程中，一般会定义多个表达式，如上面例子中的plus | minus | multi，一旦前一个表达式不能解析的话，就会调用下一个表达式进行解析：</div>
<div><pre style="BORDER-BOTTOM: rgb(136,136,136) 1px solid; BORDER-LEFT: rgb(136,136,136) 1px solid; PADDING-BOTTOM: 2px; PADDING-LEFT: 2px; PADDING-RIGHT: 2px; WORD-WRAP: break-word; WHITE-SPACE: pre-wrap; BORDER-TOP: rgb(136,136,136) 1px solid; BORDER-RIGHT: rgb(136,136,136) 1px solid; PADDING-TOP: 2px" class="prettyprint" name="code" snippet_file_name="blog_20141118_8_782671" code_snippet_id="524149">&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;&lt;span style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"&gt;/&lt;/span&gt;*源自 scala/util/parsing/combinator/Parsers.scala */&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;    def append[U &gt;: T](p0: =&gt; Parser[U]): Parser[U] = { lazy val p = p0 // lazy argument
      Parser{ in =&gt; this(in) append p(in)}
    }&lt;/p&gt;</pre>表达式解析正确后，具体的实现函数是在<span style="white-space:pre">PackratParsers中完成：</span></div>
<div><pre style="BORDER-BOTTOM: rgb(136,136,136) 1px solid; BORDER-LEFT: rgb(136,136,136) 1px solid; PADDING-BOTTOM: 2px; PADDING-LEFT: 2px; PADDING-RIGHT: 2px; WORD-WRAP: break-word; WHITE-SPACE: pre-wrap; BORDER-TOP: rgb(136,136,136) 1px solid; BORDER-RIGHT: rgb(136,136,136) 1px solid; PADDING-TOP: 2px" class="prettyprint" name="code" snippet_file_name="blog_20141118_9_5407871" code_snippet_id="524149">&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;&lt;span style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"&gt;/*源自 scala/util/parsing/combinator/PackratParsers.scala&nbsp;*/&lt;/span&gt; &nbsp;&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt; def memo[T](p: super.Parser[T]): PackratParser[T] = {
    new PackratParser[T] {
      def apply(in: Input) = {
        val inMem = in.asInstanceOf[PackratReader[Elem]]

        //look in the global cache if in a recursion
        val m = recall(p, inMem)
        m match {
          //nothing has been done due to recall
          case None =&gt;
            val base = LR(Failure("Base Failure",in), p, None)
            inMem.lrStack = base::inMem.lrStack
            //cache base result
            inMem.updateCacheAndGet(p,MemoEntry(Left(base)))
            //parse the input
            val tempRes = p(in)
            //the base variable has passed equality tests with the cache
            inMem.lrStack = inMem.lrStack.tail
            //check whether base has changed, if yes, we will have a head
            base.head match {
              case None =&gt;
                /*simple result*/
                inMem.updateCacheAndGet(p,MemoEntry(Right(tempRes)))
                tempRes
              case s@Some(_) =&gt;
                /*non simple result*/
                base.seed = tempRes
                //the base variable has passed equality tests with the cache
                val res = lrAnswer(p, inMem, base)
                res
            }

          case Some(mEntry) =&gt; {
            //entry found in cache
            mEntry match {
              case MemoEntry(Left(recDetect)) =&gt; {
                setupLR(p, inMem, recDetect)
                //all setupLR does is change the heads of the recursions, so the seed will stay the same
                recDetect match {case LR(seed, _, _) =&gt; seed.asInstanceOf[ParseResult[T]]}
              }
              case MemoEntry(Right(res: ParseResult[_])) =&gt; res.asInstanceOf[ParseResult[T]]
            }
          }
        }
      }
    }
  }&lt;/p&gt;</pre>StandardTokenParsers增加了词法处理能力，SqlParers定义了大量的关键字，重写了词法读入器，将这些关键字应用于词法读入器。</div>
<div><br>
</div>
<div>C：SqlLexical</div>
<div>词法读入器SqlLexical扩展了StdLexical的功能，首先增加了大量的关键字：</div>
</div>
</div>
<div><pre style="BORDER-BOTTOM: rgb(136,136,136) 1px solid; BORDER-LEFT: rgb(136,136,136) 1px solid; PADDING-BOTTOM: 2px; PADDING-LEFT: 2px; PADDING-RIGHT: 2px; WORD-WRAP: break-word; WHITE-SPACE: pre-wrap; BORDER-TOP: rgb(136,136,136) 1px solid; BORDER-RIGHT: rgb(136,136,136) 1px solid; PADDING-TOP: 2px" class="prettyprint" name="code" snippet_file_name="blog_20141118_10_6096358" code_snippet_id="524149">&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;&lt;span style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"&gt;/*源自 src/main/scala/org/apache/spark/sql/catalyst/SqlParser.scala */&lt;/span&gt;&lt;span style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"&gt; &nbsp;&lt;/span&gt;&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;  protected val ALL = Keyword("ALL")
  protected val AND = Keyword("AND")
  protected val AS = Keyword("AS")
  protected val ASC = Keyword("ASC")
  ......
  protected val SUBSTR = Keyword("SUBSTR")
  protected val SUBSTRING = Keyword("SUBSTRING")&lt;/p&gt;</pre>其次丰富了分隔符、词法处理、空格注释处理：</div>
<div><pre style="BORDER-BOTTOM: rgb(136,136,136) 1px solid; BORDER-LEFT: rgb(136,136,136) 1px solid; PADDING-BOTTOM: 2px; PADDING-LEFT: 2px; PADDING-RIGHT: 2px; WORD-WRAP: break-word; WHITE-SPACE: pre-wrap; BORDER-TOP: rgb(136,136,136) 1px solid; BORDER-RIGHT: rgb(136,136,136) 1px solid; PADDING-TOP: 2px" class="prettyprint" name="code" snippet_file_name="blog_20141118_11_4625254" code_snippet_id="524149">&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;&lt;span style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"&gt;/*源自 src/main/scala/org/apache/spark/sql/catalyst/SqlParser.scala */&lt;/span&gt;&lt;span style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"&gt; &lt;/span&gt;&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;delimiters += (
      "@", "*", "+", "-", "&lt;", "=", "&lt;&gt;", "!=", "&lt;=", "&gt;=", "&gt;", "/", "(", ")",
      ",", ";", "%", "{", "}", ":", "[", "]"
  )

  override lazy val token: Parser[Token] = (
    identChar ~ rep( identChar | digit ) ^^
      { case first ~ rest =&gt; processIdent(first :: rest mkString "") }
      | rep1(digit) ~ opt('.' ~&gt; rep(digit)) ^^ {
      case i ~ None    =&gt; NumericLit(i mkString "")
      case i ~ Some(d) =&gt; FloatLit(i.mkString("") + "." + d.mkString(""))
    }
      | '\'' ~ rep( chrExcept('\'', '\n', EofCh) ) ~ '\'' ^^
      { case '\'' ~ chars ~ '\'' =&gt; StringLit(chars mkString "") }
      | '\"' ~ rep( chrExcept('\"', '\n', EofCh) ) ~ '\"' ^^
      { case '\"' ~ chars ~ '\"' =&gt; StringLit(chars mkString "") }
      | EofCh ^^^ EOF
      | '\'' ~&gt; failure("unclosed string literal")
      | '\"' ~&gt; failure("unclosed string literal")
      | delim
      | failure("illegal character")
    )

  override def identChar = letter | elem('_') | elem('.')

  override def whitespace: Parser[Any] = rep(
    whitespaceChar
      | '/' ~ '*' ~ comment
      | '/' ~ '/' ~ rep( chrExcept(EofCh, '\n') )
      | '#' ~ rep( chrExcept(EofCh, '\n') )
      | '-' ~ '-' ~ rep( chrExcept(EofCh, '\n') )
      | '/' ~ '*' ~ failure("unclosed comment")
  )&lt;/p&gt;</pre>最后看看SQL语法表达式query。</div>
</div>
<div><br>
</div>
<div>D：query</div>
<div>SQL语法表达式支持3种操作：select、insert、cache</div>
<div><pre style="BORDER-BOTTOM: rgb(136,136,136) 1px solid; BORDER-LEFT: rgb(136,136,136) 1px solid; PADDING-BOTTOM: 2px; PADDING-LEFT: 2px; PADDING-RIGHT: 2px; WORD-WRAP: break-word; WHITE-SPACE: pre-wrap; BORDER-TOP: rgb(136,136,136) 1px solid; BORDER-RIGHT: rgb(136,136,136) 1px solid; PADDING-TOP: 2px" class="prettyprint" name="code" snippet_file_name="blog_20141118_12_2282098" code_snippet_id="524149">&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;&lt;span style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"&gt;/*源自 src/main/scala/org/apache/spark/sql/catalyst/SqlParser.scala */&lt;/span&gt;&lt;span style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"&gt; &lt;/span&gt;&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;protected lazy val query: Parser[LogicalPlan] = (
    select * (
        UNION ~ ALL ^^^ { (q1: LogicalPlan, q2: LogicalPlan) =&gt; Union(q1, q2) } |
        INTERSECT ^^^ { (q1: LogicalPlan, q2: LogicalPlan) =&gt; Intersect(q1, q2) } |
        EXCEPT ^^^ { (q1: LogicalPlan, q2: LogicalPlan) =&gt; Except(q1, q2)} |
        UNION ~ opt(DISTINCT) ^^^ { (q1: LogicalPlan, q2: LogicalPlan) =&gt; Distinct(Union(q1, q2)) }
      )
    | insert | cache
  )&lt;/p&gt;</pre></div>
<div>而这些操作还有具体的定义，如select，这里开始定义了具体的函数，将SQL语句转换成构成<span style="font-family:monospace; white-space:pre">Unresolved LogicalPlan的一些Node</span>：</div>
<div><pre style="BORDER-BOTTOM: rgb(136,136,136) 1px solid; BORDER-LEFT: rgb(136,136,136) 1px solid; PADDING-BOTTOM: 2px; PADDING-LEFT: 2px; PADDING-RIGHT: 2px; WORD-WRAP: break-word; WHITE-SPACE: pre-wrap; BORDER-TOP: rgb(136,136,136) 1px solid; BORDER-RIGHT: rgb(136,136,136) 1px solid; PADDING-TOP: 2px" class="prettyprint" name="code" snippet_file_name="blog_20141118_13_2970584" code_snippet_id="524149">&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;&lt;span style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"&gt;/*源自 src/main/scala/org/apache/spark/sql/catalyst/SqlParser.scala */&lt;/span&gt;&lt;span style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"&gt; &lt;/span&gt;&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;  protected lazy val select: Parser[LogicalPlan] =
    SELECT ~&gt; opt(DISTINCT) ~ projections ~
    opt(from) ~ opt(filter) ~
    opt(grouping) ~
    opt(having) ~
    opt(orderBy) ~
    opt(limit) &lt;~ opt(";") ^^ {
      case d ~ p ~ r ~ f ~ g ~ h ~ o ~ l  =&gt;
        val base = r.getOrElse(NoRelation)
        val withFilter = f.map(f =&gt; Filter(f, base)).getOrElse(base)
        val withProjection =
          g.map {g =&gt;
            Aggregate(assignAliases(g), assignAliases(p), withFilter)
          }.getOrElse(Project(assignAliases(p), withFilter))
        val withDistinct = d.map(_ =&gt; Distinct(withProjection)).getOrElse(withProjection)
        val withHaving = h.map(h =&gt; Filter(h, withDistinct)).getOrElse(withDistinct)
        val withOrder = o.map(o =&gt; Sort(o, withHaving)).getOrElse(withHaving)
        val withLimit = l.map { l =&gt; Limit(l, withOrder) }.getOrElse(withOrder)
        withLimit
  }
&lt;/p&gt;&lt;div&gt;
&lt;/div&gt;</pre></div>
<div><br>
</div>
<div style="font-family:monospace; white-space:pre">3：Analyzer</div>
<div><span style="font-family:monospace"><span style="white-space:pre">Analyzer的功能就是对来自SqlParser的Unresolved LogicalPlan中的UnresolvedAttribute项和UnresolvedRelation项，对照catalog和FunctionRegistry生成Analyzed LogicalPlan</span></span><span style="font-family:monospace; white-space:pre">。Analyzer定义了5大类14小类的rule：</span></div>
<div><pre style="BORDER-BOTTOM: rgb(136,136,136) 1px solid; BORDER-LEFT: rgb(136,136,136) 1px solid; PADDING-BOTTOM: 2px; PADDING-LEFT: 2px; PADDING-RIGHT: 2px; WORD-WRAP: break-word; WHITE-SPACE: pre-wrap; BORDER-TOP: rgb(136,136,136) 1px solid; BORDER-RIGHT: rgb(136,136,136) 1px solid; PADDING-TOP: 2px" class="prettyprint" name="code" snippet_file_name="blog_20141118_14_2263631" code_snippet_id="524149">&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;/*源自&nbsp;&lt;span style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"&gt;sql/catalyst/src/main/scala/org/apache/spark/&lt;/span&gt;&lt;span style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"&gt;sql/catalyst/analysis/Analyzer.scala */&lt;/span&gt;&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;  val batches: Seq[Batch] = Seq(
    Batch("MultiInstanceRelations", Once,
      NewRelationInstances),
    Batch("CaseInsensitiveAttributeReferences", Once,
      (if (caseSensitive) Nil else LowercaseAttributeReferences :: Nil) : _*),
    Batch("Resolution", fixedPoint,
      ResolveReferences ::
      ResolveRelations ::
      ResolveSortReferences ::
      NewRelationInstances ::
      ImplicitGenerate ::
      StarExpansion ::
      ResolveFunctions ::
      GlobalAggregates ::
      UnresolvedHavingClauseAttributes :: 
      typeCoercionRules :_*),
    Batch("Check Analysis", Once,
      CheckResolution),
    Batch("AnalysisOperators", fixedPoint,
      EliminateAnalysisOperators)
  )&lt;/p&gt;</pre></div>
</div>
<span style="font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体; font-size:1em"></span><span style="line-height:26px; font-family:Arial; font-size:14px"></span>
<ul style="padding-bottom:0px; line-height:26px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:0px">
<li><span style="font-size:1em">MultiInstanceRelations</span>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li><span style="font-size:1em">NewRelationInstances</span></li></ul>
</li><li><span style="font-size:1em">CaseInsensitiveAttributeReferences</span>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li><span style="font-size:1em">LowercaseAttributeReferences</span></li></ul>
</li><li><span style="font-size:1em">Resolution</span>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li><span style="font-size:1em">ResolveReferences</span></li><li><span style="font-size:1em">ResolveRelations</span></li><li><span style="font-size:1em">ResolveSortReferences&nbsp;</span></li><li><span style="font-size:1em">NewRelationInstances&nbsp;</span></li><li><span style="font-size:1em">ImplicitGenerate</span></li><li><span style="font-size:1em">StarExpansion</span></li><li><span style="font-size:1em">ResolveFunctions</span></li><li><span style="font-size:1em">GlobalAggregates</span></li><li><span style="font-size:1em">UnresolvedHavingClauseAttributes</span></li><li><span style="font-size:1em"><span style="color:rgb(255,0,0)">typeCoercionRules</span></span></li></ul>
</li><li><span style="font-size:1em">Check Analysis</span>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li><span style="font-size:1em">CheckResolution</span></li></ul>
</li><li><span style="font-size:1em">AnalysisOperators</span>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li><span style="font-size:16px">EliminateAnalysisOperators</span></li></ul>
</li></ul>
<div style="font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体">
<div><span style="font-family:monospace; white-space:pre">这些rule</span><span style="font-family:monospace; white-space:pre">都是使用transform对</span><span style="font-family:monospace; white-space:pre; font-size:15px">Unresolved</span><span style="font-family:monospace; white-space:pre">LogicalPlan进行操作，其中</span><span style="font-family:monospace"><span style="white-space:pre">typeCoercionRules是对HiveQL语义进行处理，在其下面又定义了多个rule：PropagateTypes、ConvertNaNs、WidenTypes、PromoteStrings、BooleanComparisons、BooleanCasts、StringToIntegralCasts、FunctionArgumentConversion、CaseWhenCoercion、Division，同样了这些rule也是使用</span></span><span style="font-family:monospace; white-space:pre">transform对</span><span style="font-family:monospace; white-space:pre; font-size:15px">Unresolved</span><span style="font-family:monospace; white-space:pre">LogicalPlan进行操作。这些rule操作后，使得LogicalPlan的信息变得丰满和易懂。下面拿其中的两个rule来简单介绍一下：</span></div>
<div><span style="font-family:monospace; white-space:pre">比如rule之</span><span style="font-family:monospace"><span style="white-space:pre">ResolveReferences，最终调用LogicalPlan的resolveChildren对列名给一名字和序号，如name#67之列的，这样保持列的唯一性：</span></span></div>
<div><pre style="BORDER-BOTTOM: rgb(136,136,136) 1px solid; BORDER-LEFT: rgb(136,136,136) 1px solid; PADDING-BOTTOM: 2px; PADDING-LEFT: 2px; PADDING-RIGHT: 2px; WORD-WRAP: break-word; WHITE-SPACE: pre-wrap; BORDER-TOP: rgb(136,136,136) 1px solid; BORDER-RIGHT: rgb(136,136,136) 1px solid; PADDING-TOP: 2px" class="prettyprint" name="code" snippet_file_name="blog_20141118_15_5742997" code_snippet_id="524149">&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;/*源自&nbsp;&lt;span style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"&gt;sql/catalyst/src/main/scala/org/apache/spark/&lt;/span&gt;&lt;span style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"&gt;sql/catalyst/analysis/Analyzer.scala */&lt;/span&gt;&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;  object ResolveReferences extends Rule[LogicalPlan] {
    def apply(plan: LogicalPlan): LogicalPlan = plan transformUp {
      case q: LogicalPlan if q.childrenResolved =&gt;
        logTrace(s"Attempting to resolve ${q.simpleString}")
        q transformExpressions {
          case u @ UnresolvedAttribute(name) =&gt;
            // Leave unchanged if resolution fails.  Hopefully will be resolved next round.
            val result = q.resolveChildren(name).getOrElse(u)
            logDebug(s"Resolving $u to $result")
            result
        }
    }
  }&lt;/p&gt;</pre>&nbsp; &nbsp; &nbsp; 又比如rule之StarExpansion，其作用就是将Select * Fom tbl中的*展开，赋予列名：</div>
<div><pre style="BORDER-BOTTOM: rgb(136,136,136) 1px solid; BORDER-LEFT: rgb(136,136,136) 1px solid; PADDING-BOTTOM: 2px; PADDING-LEFT: 2px; PADDING-RIGHT: 2px; WORD-WRAP: break-word; WHITE-SPACE: pre-wrap; BORDER-TOP: rgb(136,136,136) 1px solid; BORDER-RIGHT: rgb(136,136,136) 1px solid; PADDING-TOP: 2px" class="prettyprint" name="code" snippet_file_name="blog_20141118_16_5036043" code_snippet_id="524149">&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;/*源自&nbsp;&lt;span style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"&gt;sql/catalyst/src/main/scala/org/apache/spark/&lt;/span&gt;&lt;span style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"&gt;sql/catalyst/analysis/Analyzer.scala */&lt;/span&gt;&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;  object StarExpansion extends Rule[LogicalPlan] {
    def apply(plan: LogicalPlan): LogicalPlan = plan transform {
      // Wait until children are resolved
      case p: LogicalPlan if !p.childrenResolved =&gt; p
      // If the projection list contains Stars, expand it.
      case p @ Project(projectList, child) if containsStar(projectList) =&gt;
        Project(
          projectList.flatMap {
            case s: Star =&gt; s.expand(child.output)
            case o =&gt; o :: Nil
          },
          child)
      case t: ScriptTransformation if containsStar(t.input) =&gt;
        t.copy(
          input = t.input.flatMap {
            case s: Star =&gt; s.expand(t.child.output)
            case o =&gt; o :: Nil
          }
        )
      // If the aggregate function argument contains Stars, expand it.
      case a: Aggregate if containsStar(a.aggregateExpressions) =&gt;
        a.copy(
          aggregateExpressions = a.aggregateExpressions.flatMap {
            case s: Star =&gt; s.expand(a.child.output)
            case o =&gt; o :: Nil
          }
        )
    }

    /**
     * Returns true if `exprs` contains a [[Star]].
     */
    protected def containsStar(exprs: Seq[Expression]): Boolean =
      exprs.collect { case _: Star =&gt; true }.nonEmpty
  }
}&lt;/p&gt;</pre></div>
<div><br>
</div>
<div style="font-family:monospace; white-space:pre">4：Optimizer</div>
<div style="font-family:monospace; white-space:pre">Optimizer的功能就是将来自Analyzer的Analyzed LogicalPlan进行多种rule优化，生成Optimized LogicalPlan。Optimizer定义了3大类12个小类的优化rule：</div>
<div><pre style="BORDER-BOTTOM: rgb(136,136,136) 1px solid; BORDER-LEFT: rgb(136,136,136) 1px solid; PADDING-BOTTOM: 2px; PADDING-LEFT: 2px; PADDING-RIGHT: 2px; WORD-WRAP: break-word; WHITE-SPACE: pre-wrap; BORDER-TOP: rgb(136,136,136) 1px solid; BORDER-RIGHT: rgb(136,136,136) 1px solid; PADDING-TOP: 2px" class="prettyprint" name="code" snippet_file_name="blog_20141118_17_7709397" code_snippet_id="524149">&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;/*源自 sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/optimizer/Optimizer.scala */&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;object Optimizer extends RuleExecutor[LogicalPlan] {
  val batches =
    Batch("Combine Limits", FixedPoint(100),
      CombineLimits) ::
    Batch("ConstantFolding", FixedPoint(100),
      NullPropagation,
      ConstantFolding,
      LikeSimplification,
      BooleanSimplification,
      SimplifyFilters,
      SimplifyCasts,
      SimplifyCaseConversionExpressions) ::
    Batch("Filter Pushdown", FixedPoint(100),
      CombineFilters,
      PushPredicateThroughProject,
      PushPredicateThroughJoin,
      ColumnPruning) :: Nil
}&lt;/p&gt;</pre>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>Combine Limits 合并Limit
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>CombineLimits：将两个相邻的limit合为一个</li></ul>
</li><li>ConstantFolding 常量叠加
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>NullPropagation 空格处理&nbsp;</li><li>ConstantFolding：常量叠加</li><li>LikeSimplification：like表达式简化</li><li>BooleanSimplification：布尔表达式简化</li><li>SimplifyFilters：Filter简化</li><li>SimplifyCasts：Cast简化</li><li>SimplifyCaseConversionExpressions：CASE大小写转化表达式简化&nbsp;</li></ul>
</li><li>Filter Pushdown Filter下推
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>CombineFilters Filter合并&nbsp;</li><li>PushPredicateThroughProject 通过Project谓词下推&nbsp;</li><li>PushPredicateThroughJoin 通过Join谓词下推&nbsp;</li><li>ColumnPruning 列剪枝&nbsp;</li></ul>
</li></ul>
</div>
</div>
<div style="font-family:monospace; white-space:pre">这些优化rule都是使用transform对LogicalPlan进行操作，如合并、删除冗余、简化、剪枝等，是整个LogicalPlan变得更简洁更高效。</div>
<div style="font-family:monospace; white-space:pre">比如将两个相邻的limit进行合并，可以使用<span style="font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体">CombineLimits。</span><span style="font-family:&#39;Hiragino Sans GB W3&#39;,&#39;Hiragino Sans GB&#39;,Arial,Helvetica,simsun,宋体">象sql("select
 * from (select * from src limit 5)a limit 3 ") 这样一个SQL语句，会将limit 5和limit 3进行合并，只剩一个一个limit 3。</span></div>
<div><pre style="BORDER-BOTTOM: rgb(136,136,136) 1px solid; BORDER-LEFT: rgb(136,136,136) 1px solid; PADDING-BOTTOM: 2px; PADDING-LEFT: 2px; PADDING-RIGHT: 2px; WORD-WRAP: break-word; WHITE-SPACE: pre-wrap; BORDER-TOP: rgb(136,136,136) 1px solid; BORDER-RIGHT: rgb(136,136,136) 1px solid; PADDING-TOP: 2px" class="prettyprint" name="code" snippet_file_name="blog_20141118_18_3730038" code_snippet_id="524149">&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;/*源自 sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/optimizer/Optimizer.scala */&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;object CombineLimits extends Rule[LogicalPlan] {
  def apply(plan: LogicalPlan): LogicalPlan = plan transform {
    case ll @ Limit(le, nl @ Limit(ne, grandChild)) =&gt;
      Limit(If(LessThan(ne, le), ne, le), grandChild)
  }
}&lt;/p&gt;</pre>
<div>&nbsp; &nbsp; &nbsp; 又比如Null值的处理，可以使用NullPropagation处理。象sql("select count(null) from src where key is not null")这样一个SQL语句会转换成sql("select count(0) from src where key is not null")来处理。</div>
<div><pre style="BORDER-BOTTOM: rgb(136,136,136) 1px solid; BORDER-LEFT: rgb(136,136,136) 1px solid; PADDING-BOTTOM: 2px; PADDING-LEFT: 2px; PADDING-RIGHT: 2px; WORD-WRAP: break-word; WHITE-SPACE: pre-wrap; BORDER-TOP: rgb(136,136,136) 1px solid; BORDER-RIGHT: rgb(136,136,136) 1px solid; PADDING-TOP: 2px" class="prettyprint" name="code" snippet_file_name="blog_20141118_19_863494" code_snippet_id="524149">&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;/*源自 sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/optimizer/Optimizer.scala */&lt;/p&gt;&lt;p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px;"&gt;object NullPropagation extends Rule[LogicalPlan] {
  def apply(plan: LogicalPlan): LogicalPlan = plan transform {
    case q: LogicalPlan =&gt; q transformExpressionsUp {
      case e @ Count(Literal(null, _)) =&gt; Cast(Literal(0L), e.dataType)
      case e @ Sum(Literal(c, _)) if c == 0 =&gt; Cast(Literal(0L), e.dataType)
      case e @ Average(Literal(c, _)) if c == 0 =&gt; Literal(0.0, e.dataType)
      case e @ IsNull(c) if !c.nullable =&gt; Literal(false, BooleanType)
      case e @ IsNotNull(c) if !c.nullable =&gt; Literal(true, BooleanType)
      case e @ GetItem(Literal(null, _), _) =&gt; Literal(null, e.dataType)
      case e @ GetItem(_, Literal(null, _)) =&gt; Literal(null, e.dataType)
      case e @ GetField(Literal(null, _), _) =&gt; Literal(null, e.dataType)
      case e @ EqualNullSafe(Literal(null, _), r) =&gt; IsNull(r)
      case e @ EqualNullSafe(l, Literal(null, _)) =&gt; IsNull(l)

      ......
    }
  }
}&lt;/p&gt;</pre>&nbsp; &nbsp; &nbsp; 对于具体的优化方法可以使用下一章所介绍的hive/console调试方法进行调试，用户可以使用自定义的优化函数，也可以使用sparkSQL提供的优化函数。使用前先定义一个要优化查询，然后查看一下该查询的Analyzed LogicalPlan，再使用优化函数去优化，将生成的Optimized LogicalPlan和Analyzed LogicalPlan进行比较，就可以看到优化的效果。</div>
</div>
<h2 style="font-family:monospace; white-space:pre"><a name="t4"></a><a target="_blank" name="t4"></a><a target="_blank" href="http://blog.csdn.net/book_mmicky/article/details/40370607" rel="nofollow" style="line-height:30px; font-family:&#39;Microsoft YaHei&#39;; color:rgb(51,51,51); font-size:20px; text-decoration:none">四：深入了解sparkSQL运行计划</a></h2>
<div>前面两章花了不少篇幅介绍了SparkSQL的运行过程，很多读者还是觉得其中的概念很抽象，比如Unresolved LogicPlan、LogicPlan、PhysicalPlan是长得什么样子，没点印象，只知道名词，感觉很缥缈。本章就着重介绍一个工具hive/console，来加深读者对sparkSQL的运行计划的理解。<wbr><span style="line-height:26px; font-family:Arial; font-size:14px"></span>
<div><br>
</div>
<div>1：hive/console安装</div>
<div>&nbsp; &nbsp; &nbsp; sparkSQL从1.0.0开始提供了一个sparkSQL的调试工具hive/console。该工具是给开发者使用，在编译生成的安装部署包中并没有；该工具需要使用sbt编译运行。要使用该工具，需要具备以下条件：</div>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>spark1.1.0源码</li><li>hive0.12源码并编译</li><li>配置环境变量</li></ul>
</div>
<div><br>
</div>
<div>1.1：安装hive/cosole</div>
<div>下面是笔者安装过程：</div>
<div>A：下载spark1.1.0源码，安装在/app/hadoop/spark110_sql目录</div>
<div>B：下载hive0.12源码，安装在/app/hadoop/hive012目录，进入src目录后，使用下面命令进行编译：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:899px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 27873px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_18" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_18" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=18&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 27873px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_108" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_108" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=108&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">ant&nbsp;clean&nbsp;package&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">-Dhadoop.version</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">2</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.2.0&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">-Dhadoop-0.23.version</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">2</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.2.0&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">-Dhadoop.mr.rev</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">23</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div>C：配置环境变量文件～/.bashrc后，source&nbsp;～/.bashrc使环境变量生效。<br>
</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:1010px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 27990px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_19" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_19" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=19&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 27990px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_109" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_109" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=109&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">export&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">HIVE_HOME</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=/app/hadoop/hive012/src/build/dist&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">export&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">HIVE_DEV_HOME</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=/app/hadoop/hive012/src&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">export&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">HADOOP_HOME</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=/app/hadoop/hadoop220&nbsp;&nbsp;</span></span></li></ol>
</div>
D：启动</div>
<div>切换到spark安装目录/app/hadoop/spark110_sql，运行命令：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:1182px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 28171px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_20" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_20" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=20&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 28171px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_110" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_110" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=110&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">sbt/sbt&nbsp;hive/console&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div>经过一段漫长的sbt编译过程，最后出现如下界面：</div>
<div>
<div>
<div>
<div><img alt="" src="./css/20141022083958218" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
在控制台的scala提示符下，输入:help可以获取帮助，输入Tab键会陈列出当前可用的方法、函数、及变量。下图为按Tab键时显示的方法和函数，随着用户不断使用该控制态，用户定义或使用过的变量也会陈列出来。</div>
<div>
<div><img alt="" src="./css/20141022083635890" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;</div>
<div>1.2：hive/console原理</div>
<div>&nbsp; &nbsp; &nbsp; hive/console的调试原理很简单，就是在scala控制台装载了catalyst中几个关键的class，其中的TestHive预定义了表结构并装载命令，这些数据是hive0.12源码中带有的测试数据，装载这些数据是按需执行的；这些数据位于/app/hadoop/hive012/src/data中，也就是$HIVE_DEV_HOME/data中。</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:2267px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 29221px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_21" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_21" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=21&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 29221px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_111" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_111" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=111&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;/*源自&nbsp;sql/hive/src/main/scala/org/apache/spark/sql/hive/TestHive.scala&nbsp;*/&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;//&nbsp;The&nbsp;test&nbsp;tables&nbsp;that&nbsp;are&nbsp;defined&nbsp;in&nbsp;the&nbsp;Hive&nbsp;QTestUtil.&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;//&nbsp;/itests/util/src/main/java/org/apache/hadoop/hive/ql/QTestUtil.java&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">hiveQTestUtilTables</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">Seq</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">(&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;TestTable("src",&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"CREATE&nbsp;TABLE&nbsp;src&nbsp;(key&nbsp;INT,&nbsp;value&nbsp;STRING)".cmd,&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s"LOAD&nbsp;DATA&nbsp;LOCAL&nbsp;INPATH&nbsp;'${getHiveFile("data/files/kv1.txt")}'&nbsp;INTO&nbsp;TABLE&nbsp;src".cmd),&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;TestTable("src1",&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"CREATE&nbsp;TABLE&nbsp;src1&nbsp;(key&nbsp;INT,&nbsp;value&nbsp;STRING)".cmd,&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s"LOAD&nbsp;DATA&nbsp;LOCAL&nbsp;INPATH&nbsp;'${getHiveFile("data/files/kv3.txt")}'&nbsp;INTO&nbsp;TABLE&nbsp;src1".cmd),&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;TestTable("srcpart",&nbsp;()&nbsp;=<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;runSqlHive(&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"CREATE&nbsp;TABLE&nbsp;srcpart&nbsp;(key&nbsp;INT,&nbsp;value&nbsp;STRING)&nbsp;PARTITIONED&nbsp;BY&nbsp;(ds&nbsp;STRING,&nbsp;hr&nbsp;STRING)")&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(ds&nbsp;<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">-</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;Seq("2008-04-08",&nbsp;"2008-04-09");&nbsp;hr&nbsp;</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">-</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;Seq("11",&nbsp;"12"))&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;runSqlHive(&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s"""LOAD&nbsp;DATA&nbsp;LOCAL&nbsp;INPATH&nbsp;'${getHiveFile("data/files/kv1.txt")}'&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|OVERWRITE&nbsp;INTO&nbsp;TABLE&nbsp;srcpart&nbsp;PARTITION&nbsp;(<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">ds</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">'$ds'</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">,</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">hr</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">'$hr'</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">)&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;""".stripMargin)&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;}),&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">......&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">)&nbsp;&nbsp;</span></li></ol>
</div>
因为要使用hive0.12的测试数据，所以需要定义两个环境变量：HIVE_HOME和HIVE_DEV_HOME，如果使用hive0.13的话，用户需要更改到相应目录：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:2775px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 29736px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_22" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_22" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=22&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 29736px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_112" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_112" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=112&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">/*源自&nbsp;sql/hive/src/main/scala/org/apache/spark/sql/hive/TestHive.scala&nbsp;*/&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;/**&nbsp;The&nbsp;location&nbsp;of&nbsp;the&nbsp;compiled&nbsp;hive&nbsp;distribution&nbsp;*/&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;lazy&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">hiveHome</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">envVarToFile</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">("HIVE_HOME")&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;/**&nbsp;The&nbsp;location&nbsp;of&nbsp;the&nbsp;hive&nbsp;source&nbsp;code.&nbsp;*/&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;lazy&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">hiveDevHome</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">envVarToFile</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">("HIVE_DEV_HOME")&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div>另外，如果用户想在hive/console启动的时候，预载更多的class，可以修改spark源码下的 project/SparkBuild.scala文件</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:2956px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 29923px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_23" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_23" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=23&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 29923px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_113" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_113" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=113&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;/*&nbsp;源自&nbsp;project/SparkBuild.scala&nbsp;*/&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">object&nbsp;Hive&nbsp;{&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;lazy&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">settings</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">Seq</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">(&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;javaOptions&nbsp;+=&nbsp;"<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">-XX:MaxPermSize</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">1g</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">",&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Multiple&nbsp;queries&nbsp;rely&nbsp;on&nbsp;the&nbsp;TestHive&nbsp;singleton.&nbsp;See&nbsp;comments&nbsp;there&nbsp;for&nbsp;more&nbsp;details.&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;parallelExecution&nbsp;in&nbsp;Test&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">:</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">false</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">,&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Supporting&nbsp;all&nbsp;SerDes&nbsp;requires&nbsp;us&nbsp;to&nbsp;depend&nbsp;on&nbsp;deprecated&nbsp;APIs,&nbsp;so&nbsp;we&nbsp;turn&nbsp;off&nbsp;the&nbsp;warnings&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;only&nbsp;for&nbsp;this&nbsp;subproject.&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;scalacOptions&nbsp;<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=&nbsp;scalacOptions&nbsp;map&nbsp;{&nbsp;currentOpts:&nbsp;Seq[String]&nbsp;=</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currentOpts.filterNot(<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">_</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;==&nbsp;"-deprecation")&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;initialCommands&nbsp;in&nbsp;console&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">:</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">""</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">"&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|import&nbsp;org.apache.spark.sql.catalyst.analysis._&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|import&nbsp;org.apache.spark.sql.catalyst.dsl._&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|import&nbsp;org.apache.spark.sql.catalyst.errors._&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|import&nbsp;org.apache.spark.sql.catalyst.expressions._&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|import&nbsp;org.apache.spark.sql.catalyst.plans.logical._&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|import&nbsp;org.apache.spark.sql.catalyst.rules._&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|import&nbsp;org.apache.spark.sql.catalyst.types._&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|import&nbsp;org.apache.spark.sql.catalyst.util._&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|import&nbsp;org.apache.spark.sql.execution&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|import&nbsp;org.apache.spark.sql.hive._&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|import&nbsp;org.apache.spark.sql.hive.test.TestHive._&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|import&nbsp;org.apache.spark.sql.parquet.ParquetTestData""".stripMargin&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;)&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">}&nbsp;&nbsp;</span></li></ol>
</div>
<br>
</div>
</div>
2：常用操作</div>
<div>&nbsp; &nbsp; &nbsp; 下面介绍一下hive/console的常用操作，主要是和运行计划相关的常用操作。在操作前，首先定义一个表people和查询query：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:3579px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 30581px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_24" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_24" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=24&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 30581px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_114" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_114" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=114&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">//在控制台逐行运行&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">case&nbsp;class&nbsp;Person(name:String,&nbsp;age:Int,&nbsp;state:String)&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">sparkContext.parallelize(Person("Michael",29,"CA")::Person("Andy",30,"NY")::Person("Justin",19,"CA")::Person("Justin",25,"CA")::Nil).registerTempTable("people")&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">query</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">sql</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">("select&nbsp;*&nbsp;from&nbsp;people")&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div>2.1 查看查询的schema</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:3759px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 30769px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_25" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_25" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=25&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 30769px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_115" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_115" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=115&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">query.printSchema&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022083835453" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
<br>
</div>
<div>2.2 查看查询的整个运行计划</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:3992px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 30942px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_26" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_26" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=26&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 30942px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_116" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_116" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=116&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">query.queryExecution&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022083901843" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<div><br>
</div>
<div>2.3 查看查询的Unresolved LogicalPlan</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:4416px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 31115px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_27" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_27" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=27&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 31353px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_117" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_117" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=117&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">query.queryExecution.logical&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022084317477" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
<br>
</div>
<div>2.4 查看查询的analyzed LogicalPlan</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:4628px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 31344px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_28" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_28" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=28&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 31582px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_118" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_118" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=118&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">query.queryExecution.analyzed&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022084025625" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<div><br>
&nbsp;2.5 查看优化后的LogicalPlan</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:4898px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 31616px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_29" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_29" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=29&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 31854px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_119" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_119" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=119&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">query.queryExecution.optimizedPlan&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022084430641" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
<br>
</div>
<div>2.6 查看物理计划</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:5093px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 31788px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_30" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_30" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=30&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 32028px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_120" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_120" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=120&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">query.queryExecution.sparkPlan&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022084149171" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
<br>
</div>
<div>2.7 查看RDD的转换过程</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:5291px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 31962px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_31" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_31" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=31&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 32200px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_121" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_121" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=121&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">query.toDebugString&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022084552167" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<br style="line-height:26px; font-family:Arial; font-size:14px">
<div>2.8 更多的操作</div>
<div>&nbsp; &nbsp; &nbsp; 更多的操作可以通过Tab键陈列出来，也可以参开sparkSQL的API，也可以参看源代码中的方法和函数。</div>
<div><br>
</div>
<div>3：不同数据源的运行计划</div>
<div>&nbsp; &nbsp; &nbsp; 上面常用操作里介绍了源自RDD的数据，我们都知道，sparkSQL可以源自多个数据源：jsonFile、parquetFile、hive。下面看看这些数据源的schema：</div>
<div>3.1 json文件</div>
<div>&nbsp; &nbsp; &nbsp; json文件支持嵌套表，sparkSQL也可以读入嵌套表，如下面形式的json数据，经修整（去空格和换行符）保存后，可以使用jsonFile读入sparkSQL。</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:5819px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 32359px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_32" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_32" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=32&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 32597px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_122" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_122" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=122&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">{&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;"fullname":&nbsp;"Sean&nbsp;Kelly",&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;"org":&nbsp;"SK&nbsp;Consulting",&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;"emailaddrs":&nbsp;[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{"type":&nbsp;"work",&nbsp;"value":&nbsp;"kelly@seankelly.biz"},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{"type":&nbsp;"home",&nbsp;"pref":&nbsp;1,&nbsp;"value":&nbsp;"kelly@seankelly.tv"}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;"telephones":&nbsp;[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{"type":&nbsp;"work",&nbsp;"pref":&nbsp;1,&nbsp;"value":&nbsp;"+1&nbsp;214&nbsp;555&nbsp;1212"},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{"type":&nbsp;"fax",&nbsp;"value":&nbsp;"+1&nbsp;214&nbsp;555&nbsp;1213"},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{"type":&nbsp;"mobile",&nbsp;"value":&nbsp;"+1&nbsp;214&nbsp;555&nbsp;1214"}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;"addresses":&nbsp;[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{"type":&nbsp;"work",&nbsp;"format":&nbsp;"us",&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"value":&nbsp;"1234&nbsp;Main&nbsp;StnSpringfield,&nbsp;TX&nbsp;78080-1216"},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{"type":&nbsp;"home",&nbsp;"format":&nbsp;"us",&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"value":&nbsp;"5678&nbsp;Main&nbsp;StnSpringfield,&nbsp;TX&nbsp;78080-1316"}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;"urls":&nbsp;[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{"type":&nbsp;"work",&nbsp;"value":&nbsp;"http://seankelly.biz/"},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{"type":&nbsp;"home",&nbsp;"value":&nbsp;"http://seankelly.tv/"}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">}&nbsp;&nbsp;</span></li></ol>
</div>
去空格和换行符后保存为/home/mmicky/data/nestjson.json，使用jsonFile读入并注册成表jsonPerson，然后定义一个查询jsonQuery：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:6317px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 32891px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_33" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_33" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=33&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 33129px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_123" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_123" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=123&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">jsonFile("/home/mmicky/data/nestjson.json").registerTempTable("jsonPerson")&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">jsonQuery</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">sql</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">("select&nbsp;*&nbsp;from&nbsp;jsonPerson")&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div>查看jsonQuery的schema：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:6445px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 33025px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_34" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_34" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=34&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 33264px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_124" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_124" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=124&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">jsonQuery.printSchema&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022084717093" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<div>查看jsonQuery的整个运行计划：<br>
</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:6977px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 33171px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_35" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_35" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=35&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 33409px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_125" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_125" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=125&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">jsonQuery.queryExecution&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022084750165" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<br style="line-height:26px; font-family:Arial; font-size:14px">
<div>3.2 parquet文件</div>
<div>&nbsp; &nbsp; &nbsp; parquet文件读入并注册成表parquetWiki，然后定义一个查询parquetQuery：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:7457px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 33372px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_36" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_36" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=36&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 33610px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_126" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_126" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=126&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">parquetFile("/home/mmicky/data/spark/wiki_parquet").registerTempTable("parquetWiki")&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">parquetQuery</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">sql</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">("select&nbsp;*&nbsp;from&nbsp;parquetWiki")&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div>查询parquetQuery的schema：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:7585px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 33506px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_37" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_37" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=37&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 33744px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_127" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_127" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=127&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">parquetQuery.printSchema&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022084828682" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
查询parquetQuery的整个运行计划：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:7827px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 33764px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_38" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_38" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=38&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 34003px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_128" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_128" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=128&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">parquetQuery.queryExecution&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022084859008" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
<br>
</div>
<div>3.3 hive数据</div>
<div>&nbsp; &nbsp; &nbsp; 之前说了，TestHive类中已经定义了大量的hive0.12的测试数据的表格式，如src、sales等等，在hive/console里可以直接使用；第一次使用的时候，hive/console会装载一次。下面我们使用sales表看看其schema和整个运行计划。首先定义一个查询hiveQuery：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:8304px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 34256px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_39" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_39" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=39&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 34495px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_129" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_129" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=129&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">val&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">hiveQuery</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">sql</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">("select&nbsp;*&nbsp;from&nbsp;sales")&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div>查看hiveQuery的schema：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:8414px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 34373px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_40" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_40" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=40&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 34612px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_130" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_130" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=130&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">hiveQuery.printSchema&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022084605312" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
查看hiveQuery的整个运行计划：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:8601px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 34576px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_41" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_41" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=41&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 34815px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_131" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_131" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=131&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">hiveQuery.queryExecution&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022085012734" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
从上面可以看出，来自jsonFile、parquetFile、hive数据的物理计划还有有很大区别的。</div>
<div><br>
</div>
<div>4：不同查询的运行计划</div>
<div>&nbsp; &nbsp; &nbsp; 为了加深理解，我们列几个常用查询的运行计划和RDD转换过程。</div>
<div>4.1 聚合查询</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:9150px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 34833px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_42" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_42" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=42&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 35072px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_132" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_132" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=132&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">sql("select&nbsp;state,avg(age)&nbsp;from&nbsp;people&nbsp;group&nbsp;by&nbsp;state").queryExecution&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022084708156" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:9485px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 34950px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_43" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_43" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=43&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 35189px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_133" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_133" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=133&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">sql("select&nbsp;state,avg(age)&nbsp;from&nbsp;people&nbsp;group&nbsp;by&nbsp;state").toDebugString&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022085129892" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
&nbsp;</div>
<div>4.2 join操作</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:9922px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 35124px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_44" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_44" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=44&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 35362px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_134" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_134" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=134&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">sql("select&nbsp;a.name,b.name&nbsp;from&nbsp;people&nbsp;a&nbsp;join&nbsp;people&nbsp;b&nbsp;where&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.name</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">b</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.name").queryExecution&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022085231356" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:10333px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 35240px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_45" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_45" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=45&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 35479px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_135" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_135" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=135&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">sql("select&nbsp;a.name,b.name&nbsp;from&nbsp;people&nbsp;a&nbsp;join&nbsp;people&nbsp;b&nbsp;where&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.name</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">b</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.name").toDebugString&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022085306175" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
<br>
</div>
<div>4.3 Distinct操作</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:10802px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 35413px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_46" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_46" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=46&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 35652px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_136" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_136" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=136&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">sql("select&nbsp;distinct&nbsp;a.name,b.name&nbsp;from&nbsp;people&nbsp;a&nbsp;join&nbsp;people&nbsp;b&nbsp;where&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.name</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">b</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.name").queryExecution&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022085338030" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:11263px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 35530px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_47" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_47" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=47&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 35769px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_137" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_137" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=137&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">sql("select&nbsp;distinct&nbsp;a.name,b.name&nbsp;from&nbsp;people&nbsp;a&nbsp;join&nbsp;people&nbsp;b&nbsp;where&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.name</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">b</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.name").toDebugString&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022085413037" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
&nbsp;</div>
<div>5：查询的优化</div>
<div>&nbsp; &nbsp; &nbsp; 上面的查询比较简单，看不出优化的过程，下面看几个例子，可以理解sparkSQL的优化过程。</div>
<div>5.1&nbsp;CombineFilters</div>
<div>&nbsp; &nbsp; &nbsp;&nbsp;CombineFilters就是合并Filter，在含有多个Filter时发生，如下查询：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:11835px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 35788px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_48" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_48" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=48&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 36026px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_138" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_138" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=138&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">sql("select&nbsp;name&nbsp;from&nbsp;(select&nbsp;*&nbsp;from&nbsp;people&nbsp;where&nbsp;age&nbsp;</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=19)&nbsp;a&nbsp;where&nbsp;a.age&nbsp;</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">30</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">").queryExecution&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022085101828" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
上面的查询，在Optimized的过程中，将age&gt;=19和age&lt;30这两个Filter合并了，合并成((age&gt;=19) &amp;&amp; (age&lt;30))。其实上面还做了一个其他的优化，就是project的下推，子查询使用了表的所有列，而主查询使用了列name，在查询数据的时候子查询优化成只查列name。</div>
<div><br>
</div>
<div>5.2&nbsp;PushPredicateThroughProject</div>
<div>&nbsp; &nbsp; &nbsp;&nbsp;PushPredicateThroughProject就是project下推，和上面例子中的project一样。</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:12490px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 36072px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_49" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_49" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=49&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 36311px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_139" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_139" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=139&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">sql("select&nbsp;name&nbsp;from&nbsp;(select&nbsp;name,state&nbsp;as&nbsp;location&nbsp;from&nbsp;people)&nbsp;a&nbsp;where&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">location</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">'CA'</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">").queryExecution&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022085511272" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
&nbsp;</div>
<div>5.3&nbsp;ConstantFolding</div>
<div>&nbsp; &nbsp; &nbsp;&nbsp;ConstantFolding是常量叠加，用于表达式。如下面的例子：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:13037px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 36273px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_50" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_50" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=50&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 36512px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_140" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_140" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=140&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">sql("select&nbsp;name,1+2&nbsp;from&nbsp;people").queryExecution&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022085545358" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
在Optimized的过程中，将常量表达式直接累加在一起，用新的列名来表示。</div>
<div><br>
</div>
<div>5.4 自定义优化</div>
<div>&nbsp; &nbsp; &nbsp; 在sparkSQL中的Optimizer中定义了3类12中优化方法，这里不再一一陈列。对于用于自定义的优化，在hive/console也可以很方便的调试。只要先定义一个LogicalPlan，然后使用自定义的优化函数进行测试就可以了。下面就举个和CombineFilters一样的例子，首先定义一个函数：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:13577px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 36558px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_51" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_51" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=51&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 36797px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_141" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_141" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=141&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">object&nbsp;CombineFilters&nbsp;extends&nbsp;Rule[LogicalPlan]&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;def&nbsp;apply(plan:&nbsp;LogicalPlan):&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">LogicalPlan</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">plan</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;transform&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;Filter(c1,&nbsp;Filter(c2,&nbsp;grandChild))&nbsp;=<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Filter(And(c1,c2),grandChild)&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">}&nbsp;&nbsp;</span></li></ol>
</div>
</div>
<div>然后定义一个query，并使用query.queryExecution.analyzed查看优化前的LogicPlan：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:13774px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 36764px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_52" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_52" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=52&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 37002px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_142" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_142" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=142&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">val&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">query</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">sql</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">("select&nbsp;*&nbsp;from&nbsp;people").where('age&nbsp;</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=19).where('age&nbsp;</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">30</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">)&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">query.queryExecution.analyzed&nbsp;&nbsp;</span></li></ol>
</div>
<img alt="" src="./css/20141022085713435" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
最后，使用自定义优化函数进行优化：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:14016px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 36926px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_53" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_53" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=53&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 37164px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_143" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_143" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=143&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">CombineFilters(query.queryExecution.analyzed)&nbsp;&nbsp;</span></span></li></ol>
</div>
<img alt="" src="./css/20141022085744776" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
可以看到两个Filter合并在一起了。</div>
<div>甚至，在hive/console里直接使用transform对LogicPlan应用定义好的rule，下面定义了一个query，并使用query.queryExecution.analyzed查看应用rule前的LogicPlan：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:14290px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 37127px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_54" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_54" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=54&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 37365px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_144" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_144" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=144&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">val&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">hiveQuery</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">sql</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">("SELECT&nbsp;*&nbsp;FROM&nbsp;(SELECT&nbsp;*&nbsp;FROM&nbsp;src)&nbsp;a")&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">hiveQuery.queryExecution.analyzed&nbsp;&nbsp;</span></li></ol>
</div>
<img alt="" src="./css/20141022085819127" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
然后，直接用transform将自定义的rule：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/40370607#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a><a target="_blank" title="在CODE上查看代码片" href="https://code.csdn.net/snippets/492198" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="在CODE上查看代码片" src="./css/CODE_ico.png" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:1px; left:2px"></a><a target="_blank" title="派生到我的代码片" href="https://code.csdn.net/snippets/492198/fork" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px"><img alt="派生到我的代码片" src="./css/ico_fork.svg" width="12" height="12" style="position:relative; border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none; top:2px; left:2px"></a>
<div style="z-index:99; position:absolute; width:23px; height:12px; top:14506px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 37289px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_55" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_55" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=55&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 37528px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_145" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_145" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=145&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">hiveQuery.queryExecution.analyzed&nbsp;transform&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;case&nbsp;Project(projectList,&nbsp;child)&nbsp;if&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">projectList</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;==&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">child.output</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;child&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;}&nbsp;&nbsp;</span></li></ol>
</div>
<img alt="" src="./css/20141022085845881" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
该transform在LogicPlan的主查询和子查询的project相同时合并project。</div>
<div><br>
</div>
<div>&nbsp; &nbsp; &nbsp; 经过上面的例子，加上自己的理解，相信大部分的读者对sparkSQL中的运行计划应该有了比较明确的了解。</div>
<h2><a name="t5"></a><a target="_blank" name="t5"></a><a target="_blank" href="http://blog.csdn.net/book_mmicky/article/details/39176975" rel="nofollow" style="line-height:30px; font-family:&#39;Microsoft YaHei&#39;; color:rgb(51,51,51); font-size:20px; text-decoration:none">五：测试环境之搭建</a></h2>
</div>
<div>前面介绍了sparkSQL的运行架构，后面将介绍sparkSQL的使用。在介绍sparkSQL的使用之前，我们需要搭建一个sparkSQL的测试环境。本次测试环境涉及到hadoop之HDFS、hive、spark以及相关的数据文件，相关的信息如下：<span style="line-height:26px; font-family:Arial; font-size:14px"></span>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li><span style="font-size:1em">hadoop版本为2.2.0</span></li><li><span style="font-size:1em">hive版本为0.13</span></li><li><span style="font-size:1em">spark版本为1.1.0</span></li><li>MySQL版本为5.6.12</li><li>测试数据下载地点：<a target="_blank" href="http://pan.baidu.com/s/1eQCbT30#path=%252Fblog" rel="nofollow" style="color:rgb(255,153,0); text-decoration:none">http://pan.baidu.com/s/1eQCbT30#path=%252Fblog</a>&nbsp;中的sparkSQL_data.zip</li></ul>
<div>
<div><br>
</div>
<div>测试环境示意图：</div>
<div>
<div>
<div><img alt="" src="./css/20140915095110972" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;</div>
<div>&nbsp; &nbsp; &nbsp; 本测试环境是在一台物理机上搭建的，物理机的配置是16G内存，4核8线程CPU。hadoop1、hadoop2、hadoop3是vitual box虚拟机，构建hadoop集群和spark集群；物理机wyy作为客户端，编写代码和提交计算任务。总的测试环境配置如下：</div>
<div>
<table border="1" cellspacing="0" cellpadding="0" width="95%" style="line-height:28px">
<tbody>
<tr>
<td>&nbsp;<span style="font-size:16px">机器名</span></td>
<td>&nbsp;<span style="font-size:16px">配置</span></td>
<td>&nbsp;<span style="font-size:16px">角色</span></td>
<td>&nbsp;<span style="font-size:16px">软件安装</span></td>
</tr>
<tr>
<td>&nbsp;<span style="font-size:16px">hadoop1</span></td>
<td>&nbsp;4<span style="font-size:16px">G内存，1核</span></td>
<td>&nbsp;<span style="font-size:16px">hadoop：NN/DN Spark：Master/worker</span></td>
<td><span style="font-size:16px">/app/hadoop/hadoop220</span>
<div style="font-size:16px">/app/hadoop/spark110</div>
<div style="font-size:16px">/app/scala2104</div>
<div style="font-size:16px">/usr/java/jdk1.7.0_21</div>
</td>
</tr>
<tr>
<td>&nbsp;<span style="font-size:16px">hadoop2</span></td>
<td>&nbsp;<span style="font-size:16px">4G内存，1核</span></td>
<td>&nbsp;<span style="font-size:16px">hadoop：DN Spark：worker<br>
&nbsp;hive0.13客户端</span></td>
<td><span style="font-size:16px">/app/hadoop/hadoop220</span>
<div style="font-size:16px">/app/hadoop/spark110</div>
<div style="font-size:16px">/app/hadoop/hive013</div>
<div style="font-size:16px">/app/scala2104</div>
<div style="font-size:16px">/usr/java/jdk1.7.0_21</div>
</td>
</tr>
<tr>
<td>&nbsp;<span style="font-size:16px">hadoop3</span></td>
<td>&nbsp;<span style="font-size:16px">4G内存，1核</span></td>
<td>&nbsp;<span style="font-size:16px">hadoop：DN Spark：worker<br>
&nbsp;hive0.13 metaserver service<br>
&nbsp;mysql server</span></td>
<td><span style="font-size:16px">/app/hadoop/hadoop220</span>
<div style="font-size:16px">/app/hadoop/spark100</div>
<div style="font-size:16px">/app/hadoop/hive013</div>
<div style="font-size:16px">/app/scala2104</div>
<div style="font-size:16px">/usr/java/jdk1.7.0_21</div>
<div style="font-size:16px">MySQL5.6.12</div>
</td>
</tr>
<tr>
<td>&nbsp;<span style="font-size:16px">wyy</span></td>
<td>&nbsp;<span style="font-size:16px">16G内存，4核</span></td>
<td>&nbsp;<span style="font-size:16px">client<br>
&nbsp;</span><span style="font-size:16px">hive0.13客户端</span></td>
<td><span style="font-size:16px">/app/hadoop/hadoop220<br>
</span><span style="font-size:16px">/app/hadoop/spark110<br>
</span><span style="font-size:16px">/app/hadoop</span><span style="font-size:16px">/hive013</span></td>
</tr>
</tbody>
</table>
</div>
<div>以上hadoop220、spark、hive安装目录的用户属性都是hadoop（组别为hadoop），其他安装目录的用户属性是root:root。</div>
<div><br>
</div>
<div>&nbsp; &nbsp; &nbsp; 测试环境搭建顺序</div>
<div>1：虚拟集群的搭建（hadoop1、hadoop2、hadoop3）</div>
<div>A：hadoop2.2.0集群搭建</div>
<div>参照博客<a target="_blank" href="http://blog.csdn.net/book_mmicky/article/details/25714091" rel="nofollow" style="color:rgb(255,153,0); text-decoration:none">&nbsp;hadoop2.2.0测试环境搭建&nbsp;</a></div>
<div>或者参看视频&nbsp;<a target="_blank" href="# rel="nofollow" style="color:rgb(255,153,0); text-decoration:none">http://pan.baidu.com/s/1qWqFY4c&nbsp;</a>提取密码:xv4i</div>
<div><br>
</div>
<div>B：MySQL的安装</div>
<div>参照博客<a target="_blank" href="#" rel="nofollow" style="color:rgb(255,153,0); text-decoration:none">mysql5.6.12 for Linux安装</a></div>
<div><br>
</div>
<div>C：hive的安装</div>
<div>参照博客<a target="_blank" href="#" rel="nofollow" style="color:rgb(255,153,0); text-decoration:none">Hive 0.11.0 远程模式搭建</a></div>
<div>本测试中使用的hive0.13，和hive0.11的安装一样。</div>
<div>hive安装在hadoop3、hadoop2、wyy。其中hadoop3启动metastore serive；hadoop2、wyy配置uris后作为hive的客户端。</div>
<div><br>
</div>
<div>D：Spark1.1.0 Standalone集群搭建</div>
<div>参照博客&nbsp;<a target="_blank" href="#" rel="nofollow" style="color:rgb(255,153,0); text-decoration:none">Spark1.0.0 on Standalone 模式部署&nbsp;</a>&nbsp;</div>
<div>这里需要注意的是，本测试中使用的是spark1.1.0，部署包生成命令make-distribution.sh的参数发生了变化，spark1.1.0的make-distribution.sh使用格式：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39176975#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39176975#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39176975#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39176975#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:2341px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 39155px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_56" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_56" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=56&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 39393px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_146" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_146" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=146&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">./make-distribution.sh&nbsp;[--name]&nbsp;[--tgz]&nbsp;[--with-tachyon]&nbsp;</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">maven</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;build&nbsp;options</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li></ol>
</div>
参数的含义：</div>
<div>
<div>--with-tachyon：是否支持内存文件系统Tachyon，不加此参数时为不支持。</div>
<div>--tgz：在根目录下生成 spark-$VERSION-bin.tar.gz，不加此参数是不生成tgz文件，只生成/dist目录。</div>
<div>--name NAME :和— tgz 结合可以生成 spark-$VERSION-bin-$NAME.tgz 的部署包,不加此参数时 NAME 为 hadoop 的版本号。</div>
<div>maven build options：使用maven编译时可以使用的配置选项，如使用-P、-D的选项</div>
</div>
<div>本次要生成基于hadoop2.2.0和yarn并集成hive、ganglia、asl的spark1.1.0部署包，可以使用命令：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39176975#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39176975#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39176975#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39176975#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:2589px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 39435px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_57" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_57" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=57&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 39674px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_147" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_147" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=147&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">./make-distribution.sh&nbsp;--tgz&nbsp;--name&nbsp;2.2.0&nbsp;-Pyarn&nbsp;-Phadoop-2.2&nbsp;-Pspark-ganglia-lgpl&nbsp;-Pkinesis-asl&nbsp;-Phive&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div>最后生成部署包spark-1.1.0-bin-2.2.0.tgz，按照测试环境的规划进行安装。</div>
<div><br>
</div>
<div>2：客户端的搭建</div>
<div>&nbsp; &nbsp; &nbsp; 客户端wyy采用的Ubuntu操作系统，而Spark虚拟集群采用的是CentOS，默认的java安装目录两个操作系统是不一样的，所以在Ubuntu下安装java的时候特意将java的安装路径改成和CentOS一样。不然的话，每次scp了虚拟集群的配置文件之后，要修改hadoop、spark运行配置文件中的JAVA_HOME。</div>
<div>&nbsp; &nbsp; &nbsp; 客户端hadoop2.2.0、Spark1.1.0、hive0.13是直接从虚拟集群中scp出来的，放置在相同的目录下，拥有相同的用户属性。开发工具使用的IntelliJ IDEA，程序编译打包后复制到spark1.1.0的根目录/app/hadoop/spark110下，使用spark-submit提交虚拟机集群运行。</div>
<div><br>
</div>
</div>
<div>3：文件数据准备工作</div>
<div>&nbsp; &nbsp; &nbsp; 启动hadoop2.2.0（只需要HDFS启动就可以了），然后将数据文件上传到对应的目录：</div>
<div>
<div>
<div><img alt="" src="./css/20140915094954671" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>people.txt和people.json作为第六节sparkSQL之基础应用实验数据；</li><li>graphx-wiki-vertices.txt和graphx-wiki-edges.txt作为第八节sparkSQL之综合应用中图处理数据；</li><li>SogouQ.full.txt来源于Sogou实验室，下载地址：<a target="_blank" href="http://download.labs.sogou.com/dl/q.html" rel="nofollow" style="color:rgb(255,153,0); text-decoration:none">http://download.labs.sogou.com/dl/q.html</a>&nbsp;完整版(2GB)：gz格式，作为第九节sparkSQL之调优的测试数据</li></ul>
</div>
</div>
&nbsp;</div>
<div>4：hive数据准备工作</div>
<div>&nbsp; &nbsp; &nbsp; 在hive里定义一个数据库saledata，和三个表tblDate、tblStock、tblStockDetail，并装载数据，具体命令：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39176975#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39176975#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39176975#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39176975#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:3427px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 40109px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_58" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_58" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=58&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 40347px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_148" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_148" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=148&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">CREATE&nbsp;DATABASE&nbsp;SALEDATA;&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">use&nbsp;SALEDATA;&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">//Date.txt文件定义了日期的分类，将每天分别赋予所属的月份、星期、季度等属性&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">//日期，年月，年，月，日，周几，第几周，季度，旬、半月&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">CREATE&nbsp;TABLE&nbsp;tblDate(dateID&nbsp;string,theyearmonth&nbsp;string,theyear&nbsp;string,themonth&nbsp;string,thedate&nbsp;string,theweek&nbsp;string,theweeks&nbsp;string,thequot&nbsp;string,thetenday&nbsp;string,thehalfmonth&nbsp;string)&nbsp;ROW&nbsp;FORMAT&nbsp;DELIMITED&nbsp;FIELDS&nbsp;TERMINATED&nbsp;BY&nbsp;','&nbsp;LINES&nbsp;TERMINATED&nbsp;BY&nbsp;'\n'&nbsp;;&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">//Stock.txt文件定义了订单表头&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">//订单号，交易位置，交易日期&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">CREATE&nbsp;TABLE&nbsp;tblStock(ordernumber&nbsp;string,locationid&nbsp;string,dateID&nbsp;string)&nbsp;ROW&nbsp;FORMAT&nbsp;DELIMITED&nbsp;FIELDS&nbsp;TERMINATED&nbsp;BY&nbsp;','&nbsp;LINES&nbsp;TERMINATED&nbsp;BY&nbsp;'\n'&nbsp;;&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">//StockDetail.txt文件定义了订单明细&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">//订单号，行号，货品，数量，金额&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">CREATE&nbsp;TABLE&nbsp;tblStockDetail(ordernumber&nbsp;STRING,rownum&nbsp;int,itemid&nbsp;string,qty&nbsp;int,price&nbsp;int,amount&nbsp;int)&nbsp;ROW&nbsp;FORMAT&nbsp;DELIMITED&nbsp;FIELDS&nbsp;TERMINATED&nbsp;BY&nbsp;','&nbsp;LINES&nbsp;TERMINATED&nbsp;BY&nbsp;'\n'&nbsp;;&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">//装载数据&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">LOAD&nbsp;DATA&nbsp;LOCAL&nbsp;INPATH&nbsp;'/home/mmicky/mboo/MyClass/doc/sparkSQL/data/Date.txt'&nbsp;INTO&nbsp;TABLE&nbsp;tblDate;&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">LOAD&nbsp;DATA&nbsp;LOCAL&nbsp;INPATH&nbsp;'/home/mmicky/mboo/MyClass/doc/sparkSQL/data/Stock.txt'&nbsp;INTO&nbsp;TABLE&nbsp;tblStock;&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">LOAD&nbsp;DATA&nbsp;LOCAL&nbsp;INPATH&nbsp;'/home/mmicky/mboo/MyClass/doc/sparkSQL/data/StockDetail.txt'&nbsp;INTO&nbsp;TABLE&nbsp;tblStockDetail;&nbsp;&nbsp;</span></li></ol>
</div>
最终在HDFS可以看到相关的数据：</div>
<div>
<div><img alt="" src="./css/20140915095045484" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;&nbsp;<a target="_blank" href="http://blog.csdn.net/book_mmicky/article/details/39177041" rel="nofollow" style="line-height:30px; font-family:&#39;Microsoft YaHei&#39;; color:rgb(51,51,51); font-size:20px; text-decoration:none">六：sparkSQL之基础应用</a></div>
</div>
</div>
<div>SparkSQL引入了一种新的RDD——SchemaRDD，SchemaRDD由行对象（row）以及描述行对象中每列数据类型的schema组成；SchemaRDD很象传统数据库中的表。SchemaRDD可以通过RDD、Parquet文件、JSON文件、或者通过使用hiveql查询hive数据来建立。SchemaRDD除了可以和RDD一样操作外，还可以通过registerTempTable注册成临时表，然后通过SQL语句进行操作。</div>
<div>&nbsp; &nbsp; &nbsp; 值得注意的是：</div>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>Spark1.1使用registerTempTable代替1.0版本的registerAsTable</li><li>Spark1.1在hiveContext中，hql()将被弃用，sql()将代替hql()来提交查询语句，统一了接口。</li><li>使用registerTempTable注册表是一个临时表，生命周期只在所定义的sqlContext或hiveContext实例之中。换而言之，在一个sqlontext（或hiveContext）中registerTempTable的表不能在另一个sqlContext（或hiveContext）中使用。</li></ul>
&nbsp; &nbsp; &nbsp; 另外，spark1.1提供了语法解析器选项spark.sql.dialect，就目前而言，spark1.1提供了两种语法解析器：sql语法解析器和hiveql语法解析器。</div>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>sqlContext现在只支持sql语法解析器（SQL-92语法）</li><li>hiveContext现在支持sql语法解析器和hivesql语法解析器，默认为hivesql语法解析器，用户可以通过配置切换成sql语法解析器，来运行hiveql不支持的语法，如select 1。</li></ul>
</div>
<div>切换可以通过下列方式完成：</div>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>在sqlContexet中使用setconf配置spark.sql.dialect&nbsp;</li><li>在hiveContexet中使用setconf配置spark.sql.dialect</li><li>在sql命令中使用 set spark.sql.dialect=value</li></ul>
<div><img alt="" src="./css/20140915100119201" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;</div>
<div>&nbsp; &nbsp; &nbsp; sparkSQL1.1对数据的查询分成了2个分支：sqlContext 和 hiveContext。至于两者之间的关系，hiveSQL继承了sqlContext，所以拥有sqlontext的特性之外，还拥有自身的特性（最大的特性就是支持hive，<wbr><img title="sparkSQL1.1入门之六：sparkSQL之基础应用 - mmicky - mmicky 的博客" alt="sparkSQL1.1入门之六：sparkSQL之基础应用 - mmicky - mmicky 的博客" src="./css/face1.gif" style="border-right-width:0px; max-width:100%; border-top-width:0px; border-bottom-width:0px; border-left-width:0px">）。&nbsp;
 &nbsp; &nbsp;&nbsp;
<div>&nbsp; &nbsp; &nbsp; 下面就sparkSQL的一些基本操作做一演示：</div>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>sqlContext基础应用
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>RDD</li><li>parquet文件</li><li>json文件</li></ul>
</li><li>hiveContext基础应用</li><li>混合使用</li><li>缓存之使用</li><li>DSL之使用</li></ul>
</div>
<div>&nbsp; &nbsp; &nbsp; 为了方便演示，我们在spark-shell里面进行下列演示，并加以说明。首先，启动spark集群，然后在客户端wyy上启动spark-shell：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:1601px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 41785px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_59" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_59" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=59&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 42024px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_149" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_149" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=149&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">bin/spark-shell&nbsp;--master&nbsp;spark://hadoop1:7077&nbsp;--executor-memory&nbsp;3g&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div><br>
</div>
<div>1：sqlContext基础应用</div>
<div>&nbsp; &nbsp; &nbsp; 首先创建sqlContext，并引入<span style="font-family:monospace; white-space:pre">sqlContext.createSchemaRDD以完成RDD隐式转换成SchemaRDD</span>：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:1766px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 41954px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_60" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_60" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=60&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 42192px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_150" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_150" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=150&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">val&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">sqlContext</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">new</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;org.apache.spark.sql.SQLContext(sc)&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">import&nbsp;sqlContext.createSchemaRDD&nbsp;&nbsp;</span></li></ol>
</div>
<br>
</div>
<div>1.1：RDD</div>
<div>&nbsp; &nbsp; &nbsp; Spark1.1.0开始提供了两种方式将RDD转换成SchemaRDD：</div>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>通过定义case class，使用反射推断Schema（case class方式）</li><li>通过可编程接口，定义Schema，并应用到RDD上（applySchema 方式)</li></ul>
</div>
<div>&nbsp; &nbsp; &nbsp; 前者使用简单、代码简洁，适用于已知Schema的源数据上；后者使用较为复杂，但可以在程序运行过程中实行，适用于未知Schema的RDD上。</div>
<div><br>
</div>
<div>1.1.1&nbsp;case class方式</div>
<div>&nbsp; &nbsp; &nbsp; 对于case class方式，首先要定义case class，在RDD的transform过程中使用case class可以隐式转化成SchemaRDD，然后再使用registerTempTable注册成表。注册成表后就可以在sqlContext对表进行操作，如select 、insert、join等。注意，case class可以是嵌套的，也可以使用类似Sequences 或 Arrays之类复杂的数据类型。</div>
<div>&nbsp; &nbsp; &nbsp; 下面的例子是定义一个符合数据文件/sparksql/people.txt类型的case clase（Person），然后将数据文件读入后隐式转换成SchemaRDD：people，并将people在sqlContext中注册成表rddTable，最后对表进行查询，找出年纪在13-19岁之间的人名。</div>
<div><br>
</div>
<div>/sparksql/people.txt的内容有3行：</div>
<div>
<div><img alt="" src="./css/20140915100220759" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;运行下列代码：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:2575px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 42609px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_61" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_61" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=61&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 42847px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_151" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_151" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=151&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">//RDD1演示&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">case&nbsp;class&nbsp;Person(name:String,age:Int)&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">rddpeople</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">sc</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.textFile("/sparksql/people.txt").map(_.split(",")).map(</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">p</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">Person(p(0),p(1).trim.toInt))&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">rddpeople.registerTempTable("rddTable")&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">sqlContext.sql("SELECT&nbsp;name&nbsp;FROM&nbsp;rddTable&nbsp;WHERE&nbsp;age&nbsp;<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=&nbsp;13&nbsp;AND&nbsp;age&nbsp;</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=&nbsp;19").map(</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">t</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;"Name:&nbsp;"&nbsp;+&nbsp;t(0)).collect().foreach(println)&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div>运行结果：</div>
<div>
<div>
<div><img alt="" src="./css/20140915100053734" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;</div>
<div>1.1.2&nbsp;applySchema 方式<br>
&nbsp; &nbsp; &nbsp;&nbsp;applySchema 方式比较复杂，通常有3步过程：</div>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>从源RDD创建rowRDD</li><li>创建与rowRDD匹配的Schema</li><li>将Schema通过applySchema应用到rowRDD</li></ul>
</div>
<div>上面的例子通过applySchema 方式实现的代码如下：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:3018px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 43063px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_62" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_62" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=62&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 43301px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_152" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_152" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=152&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">//RDD2演示&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">//导入SparkSQL的数据类型和Row&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">import&nbsp;org.apache.spark.sql._&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">//创建于数据结构匹配的schema&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">schemaString</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">"name&nbsp;age"</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">schema</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;<span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">StructType</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">(&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;schemaString.split("&nbsp;").map(<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">fieldName</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;StructField(fieldName,&nbsp;StringType,&nbsp;true)))&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">//创建rowRDD&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">rowRDD</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">sc</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.textFile("/sparksql/people.txt").map(_.split(",")).map(</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">p</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;Row(p(0),&nbsp;p(1).trim))&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">//用applySchema将schema应用到rowRDD&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">rddpeople2</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">sqlContext</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.applySchema(rowRDD,&nbsp;schema)&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">rddpeople2.registerTempTable("rddTable2")&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">sqlContext.sql("SELECT&nbsp;name&nbsp;FROM&nbsp;rddTable2&nbsp;WHERE&nbsp;age&nbsp;<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=&nbsp;13&nbsp;AND&nbsp;age&nbsp;</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=&nbsp;19").map(</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">t</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;"Name:&nbsp;"&nbsp;+&nbsp;t(0)).collect().foreach(println)&nbsp;&nbsp;</span></span></li></ol>
</div>
运行结果：</div>
<div><img alt="" src="./css/20140915100139968" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<div>&nbsp;</div>
</div>
<div>1.2：parquet文件</div>
<div>&nbsp; &nbsp; &nbsp; 同样得，sqlContext可以读取parquet文件，由于parquet文件中保留了schema的信息，所以不需要使用case class来隐式转换。sqlContext读入parquet文件后直接转换成SchemaRDD，也可以将SchemaRDD保存成parquet文件格式。</div>
<div><br>
</div>
<div>我们先将上面建立的SchemaRDD：people保存成parquet文件：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:3614px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 43653px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_63" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_63" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=63&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 43891px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_153" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_153" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=153&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">rddpeople.saveAsParquetFile("/sparksql/people.parquet")&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div>运行后/sparksql/目录下就多出了一个名称为people.parquet的目录：</div>
<div>
<div><img alt="" src="./css/20140915100416043" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
然后，将people.parquet读入，注册成表parquetTable，查询年纪大于25岁的人名：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:4007px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 43822px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_64" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_64" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=64&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 44060px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_154" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_154" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=154&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">//parquet演示&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">parquetpeople</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">sqlContext</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.parquetFile("/sparksql/people.parquet")&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">parquetpeople.registerTempTable("parquetTable")&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">sqlContext.sql("SELECT&nbsp;name&nbsp;FROM&nbsp;parquetTable&nbsp;WHERE&nbsp;age&nbsp;<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=&nbsp;25").map(</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">t</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;"Name:&nbsp;"&nbsp;+&nbsp;t(0)).collect().foreach(println)&nbsp;&nbsp;</span></span></li></ol>
</div>
运行结果：</div>
<div><img alt="" src="./css/20140915100245640" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<div>&nbsp;</div>
<div>1.3：json文件</div>
<div>&nbsp; &nbsp; &nbsp; sparkSQL1.1.0开始提供对json文件格式的支持，这意味着开发者可以使用更多的数据源，如鼎鼎大名的NOSQL数据库MongDB等。sqlContext可以从jsonFile或jsonRDD获取schema信息，来构建SchemaRDD，注册成表后就可以使用。</div>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>jsonFile - 加载JSON文件目录中的数据，文件的每一行是一个JSON对象。&nbsp;</li><li>jsonRdd - 从现有的RDD加载数据，其中RDD的每个元素包含一个JSON对象的字符串。</li></ul>
</div>
<div>&nbsp; &nbsp; &nbsp;&nbsp;下面的例子读入一个json文件/sparksql/people.json，注册成jsonTable，并查询年纪大于25岁的人名。</div>
<div><br>
</div>
<div>/sparksql/people.json的内容：</div>
<div><img alt="" src="./css/20140915100515620" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none">&nbsp;</div>
<div>运行下面代码：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:4755px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 44362px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_65" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_65" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=65&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 44600px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_155" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_155" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=155&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">//json演示&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">jsonpeople</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">sqlContext</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.jsonFile("/sparksql/people.json")&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">jsonpeople.registerTempTable("jsonTable")&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">sqlContext.sql("SELECT&nbsp;name&nbsp;FROM&nbsp;jsonTable&nbsp;WHERE&nbsp;age&nbsp;<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=&nbsp;25").map(</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">t</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;"Name:&nbsp;"&nbsp;+&nbsp;t(0)).collect().foreach(println)&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div>运行结果：</div>
<div><img alt="" src="./css/20140915100343078" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<div><br>
</div>
<div>2：hiveContext基础应用</div>
<div>&nbsp; &nbsp; &nbsp; 使用hiveContext之前首先要确认以下两点：</div>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>使用的Spark是支持hive</li><li>hive的配置文件hive-site.xml已经存在conf目录中</li></ul>
&nbsp; &nbsp; &nbsp; 前者可以查看lib目录下是否存在以datanucleus开头的3个JAR来确定，后者注意是否在hive-site.xml里配置了uris来访问hive metastore。</div>
<div>
<div><br>
</div>
<div>要使用hiveContext，需要先构建hiveContext：</div>
</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:5230px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 44846px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_66" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_66" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=66&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 45084px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_156" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_156" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=156&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">val&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">hiveContext</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">new</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;org.apache.spark.sql.hive.HiveContext(sc)&nbsp;&nbsp;</span></span></li></ol>
</div>
然后就可以对hive数据进行操作了，下面我们将使用hive中的销售数据（第五小结中的hive数据），首先切换数据库到saledata并查看有几个表：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:5366px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 44986px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_67" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_67" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=67&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 45225px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_157" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_157" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=157&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">hiveContext.sql("use&nbsp;saledata")&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">hiveContext.sql("show&nbsp;tables").collect().foreach(println)&nbsp;&nbsp;</span></li></ol>
</div>
</div>
<div>可以看到有在第五小节定义的3个表：</div>
<div>
<div>
<div><img alt="" src="./css/20140915100430781" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;</div>
现在查询一下所有订单中每年的销售单数、销售总额：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:5626px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 45200px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_68" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_68" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=68&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 45439px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_158" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_158" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=158&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">//所有订单中每年的销售单数、销售总额&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">//三个表连接后以count(distinct&nbsp;a.ordernumber)计销售单数，sum(b.amount)计销售总额&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">hiveContext.sql("select&nbsp;c.theyear,count(distinct&nbsp;a.ordernumber),sum(b.amount)&nbsp;from&nbsp;tblStock&nbsp;a&nbsp;join&nbsp;tblStockDetail&nbsp;b&nbsp;on&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.ordernumber</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">b</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.ordernumber&nbsp;join&nbsp;tbldate&nbsp;c&nbsp;on&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.dateid</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">c</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.dateid&nbsp;group&nbsp;by&nbsp;c.theyear&nbsp;order&nbsp;by&nbsp;c.theyear").collect().foreach(println)&nbsp;&nbsp;</span></span></li></ol>
</div>
运行结果：</div>
<div>
<div>
<div><img alt="" src="./css/20140915100459171" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;</div>
再做一个稍微复杂点的查询，求出所有订单每年最大金额订单的销售额：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:5971px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 45450px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_69" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_69" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=69&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 45688px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_159" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_159" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=159&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">/************************&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">所有订单每年最大金额订单的销售额:&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">第一步，先求出每份订单的销售额以其发生时间&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">select&nbsp;a.dateid,a.ordernumber,sum(b.amount)&nbsp;as&nbsp;sumofamount&nbsp;from&nbsp;tblStock&nbsp;a&nbsp;join&nbsp;tblStockDetail&nbsp;b&nbsp;on&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.ordernumber</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">b</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.ordernumber&nbsp;group&nbsp;by&nbsp;a.dateid,a.ordernumber&nbsp;&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">第二步，以第一步的查询作为子表，和表tblDate连接，求出每年最大金额订单的销售额&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">select&nbsp;c.theyear,max(d.sumofamount)&nbsp;from&nbsp;tbldate&nbsp;c&nbsp;join&nbsp;(select&nbsp;a.dateid,a.ordernumber,sum(b.amount)&nbsp;as&nbsp;sumofamount&nbsp;from&nbsp;tblStock&nbsp;a&nbsp;join&nbsp;tblStockDetail&nbsp;b&nbsp;on&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.ordernumber</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">b</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.ordernumber&nbsp;group&nbsp;by&nbsp;a.dateid,a.ordernumber&nbsp;)&nbsp;d&nbsp;&nbsp;on&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">c.dateid</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">d</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.dateid&nbsp;group&nbsp;by&nbsp;c.theyear&nbsp;sort&nbsp;by&nbsp;c.theyear&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">*************************/&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">hiveContext.sql("select&nbsp;c.theyear,max(d.sumofamount)&nbsp;from&nbsp;tbldate&nbsp;c&nbsp;join&nbsp;(select&nbsp;a.dateid,a.ordernumber,sum(b.amount)&nbsp;as&nbsp;sumofamount&nbsp;from&nbsp;tblStock&nbsp;a&nbsp;join&nbsp;tblStockDetail&nbsp;b&nbsp;on&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.ordernumber</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">b</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.ordernumber&nbsp;group&nbsp;by&nbsp;a.dateid,a.ordernumber&nbsp;)&nbsp;d&nbsp;&nbsp;on&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">c.dateid</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">d</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.dateid&nbsp;group&nbsp;by&nbsp;c.theyear&nbsp;sort&nbsp;by&nbsp;c.theyear").collect().foreach(println)&nbsp;&nbsp;</span></span></li></ol>
</div>
运行结果：</div>
<div>
<div>
<div><img alt="" src="./css/20140915100537968" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;</div>
最后做一个更复杂的查询，求出所有订单中每年最畅销货品：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:6422px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 45875px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_70" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_70" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=70&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 46114px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_160" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_160" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=160&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">/************************&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">所有订单中每年最畅销货品：&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">第一步：求出每年每个货品的销售金额&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">select&nbsp;c.theyear,b.itemid,sum(b.amount)&nbsp;as&nbsp;sumofamount&nbsp;from&nbsp;tblStock&nbsp;a&nbsp;join&nbsp;tblStockDetail&nbsp;b&nbsp;on&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.ordernumber</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">b</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.ordernumber&nbsp;join&nbsp;tbldate&nbsp;c&nbsp;on&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.dateid</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">c</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.dateid&nbsp;group&nbsp;by&nbsp;c.theyear,b.itemid&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">第二步：求出每年单品销售的最大金额&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">select&nbsp;d.theyear,max(d.sumofamount)&nbsp;as&nbsp;maxofamount&nbsp;from&nbsp;(select&nbsp;c.theyear,b.itemid,sum(b.amount)&nbsp;as&nbsp;sumofamount&nbsp;from&nbsp;tblStock&nbsp;a&nbsp;join&nbsp;tblStockDetail&nbsp;b&nbsp;on&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.ordernumber</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">b</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.ordernumber&nbsp;join&nbsp;tbldate&nbsp;c&nbsp;on&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.dateid</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">c</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.dateid&nbsp;group&nbsp;by&nbsp;c.theyear,b.itemid)&nbsp;d&nbsp;group&nbsp;by&nbsp;d.theyear&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">第三步：求出每年与销售额最大相符的货品就是最畅销货品&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">select&nbsp;distinct&nbsp;&nbsp;e.theyear,e.itemid,f.maxofamount&nbsp;from&nbsp;(select&nbsp;c.theyear,b.itemid,sum(b.amount)&nbsp;as&nbsp;sumofamount&nbsp;from&nbsp;tblStock&nbsp;a&nbsp;join&nbsp;tblStockDetail&nbsp;b&nbsp;on&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.ordernumber</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">b</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.ordernumber&nbsp;join&nbsp;tbldate&nbsp;c&nbsp;on&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.dateid</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">c</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.dateid&nbsp;group&nbsp;by&nbsp;c.theyear,b.itemid)&nbsp;e&nbsp;join&nbsp;(select&nbsp;d.theyear,max(d.sumofamount)&nbsp;as&nbsp;maxofamount&nbsp;from&nbsp;(select&nbsp;c.theyear,b.itemid,sum(b.amount)&nbsp;as&nbsp;sumofamount&nbsp;from&nbsp;tblStock&nbsp;a&nbsp;join&nbsp;tblStockDetail&nbsp;b&nbsp;on&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.ordernumber</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">b</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.ordernumber&nbsp;join&nbsp;tbldate&nbsp;c&nbsp;on&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.dateid</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">c</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.dateid&nbsp;group&nbsp;by&nbsp;c.theyear,b.itemid)&nbsp;d&nbsp;group&nbsp;by&nbsp;d.theyear)&nbsp;f&nbsp;on&nbsp;(</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">e.theyear</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">f</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.theyear&nbsp;and&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">e.sumofamount</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">f</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.maxofamount)&nbsp;order&nbsp;by&nbsp;e.theyear&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">*************************/&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">hiveContext.sql("select&nbsp;distinct&nbsp;&nbsp;e.theyear,e.itemid,f.maxofamount&nbsp;from&nbsp;(select&nbsp;c.theyear,b.itemid,sum(b.amount)&nbsp;as&nbsp;sumofamount&nbsp;from&nbsp;tblStock&nbsp;a&nbsp;join&nbsp;tblStockDetail&nbsp;b&nbsp;on&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.ordernumber</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">b</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.ordernumber&nbsp;join&nbsp;tbldate&nbsp;c&nbsp;on&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.dateid</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">c</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.dateid&nbsp;group&nbsp;by&nbsp;c.theyear,b.itemid)&nbsp;e&nbsp;join&nbsp;(select&nbsp;d.theyear,max(d.sumofamount)&nbsp;as&nbsp;maxofamount&nbsp;from&nbsp;(select&nbsp;c.theyear,b.itemid,sum(b.amount)&nbsp;as&nbsp;sumofamount&nbsp;from&nbsp;tblStock&nbsp;a&nbsp;join&nbsp;tblStockDetail&nbsp;b&nbsp;on&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.ordernumber</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">b</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.ordernumber&nbsp;join&nbsp;tbldate&nbsp;c&nbsp;on&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.dateid</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">c</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.dateid&nbsp;group&nbsp;by&nbsp;c.theyear,b.itemid)&nbsp;d&nbsp;group&nbsp;by&nbsp;d.theyear)&nbsp;f&nbsp;on&nbsp;(</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">e.theyear</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">f</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.theyear&nbsp;and&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">e.sumofamount</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">f</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.maxofamount)&nbsp;order&nbsp;by&nbsp;e.theyear").collect().foreach(println)&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div>运行结果：</div>
<div>
<div><img alt="" src="./css/20140915100642562" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;</div>
<div>3：混合使用</div>
<div>&nbsp; &nbsp; &nbsp; 在sqlContext或hiveContext中，来源于不同数据源的表在各自生命周期中可以混用，但是不同实例之间的表不能混合使用。</div>
<div><br>
</div>
<div>3.1 sqlContext中混合使用：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:7026px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 46588px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_71" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_71" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=71&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 46827px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_161" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_161" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=161&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">//sqlContext中混合使用&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">//sqlContext中来自rdd的表rddTable和来自parquet文件的表parquetTable混合使用&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">sqlContext.sql("select&nbsp;a.name,a.age,b.age&nbsp;from&nbsp;rddTable&nbsp;a&nbsp;join&nbsp;parquetTable&nbsp;b&nbsp;on&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.name</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">b</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.name").collect().foreach(println)&nbsp;&nbsp;</span></span></li></ol>
</div>
运行结果：</div>
<div>
<div><img alt="" src="./css/20140915100928418" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;&nbsp;</div>
<div>3.2 hiveContext中混合使用：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:7300px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 46820px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_72" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_72" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=72&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 47059px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_162" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_162" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=162&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">//hiveContext中混合使用&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">//创建一个hiveTable，并将数据加载，注意people.txt第二列有空格，所以age取string类型&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">hiveContext.sql("CREATE&nbsp;TABLE&nbsp;hiveTable(name&nbsp;string,age&nbsp;string)&nbsp;ROW&nbsp;FORMAT&nbsp;DELIMITED&nbsp;FIELDS&nbsp;TERMINATED&nbsp;BY&nbsp;','&nbsp;LINES&nbsp;TERMINATED&nbsp;BY&nbsp;'\n'&nbsp;")&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">hiveContext.sql("LOAD&nbsp;DATA&nbsp;LOCAL&nbsp;INPATH&nbsp;'/home/mmicky/mboo/MyClass/doc/sparkSQL/data/people.txt'&nbsp;INTO&nbsp;TABLE&nbsp;hiveTable")&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">//创建一个源自parquet文件的表parquetTable2，然后和hiveTable混合使用&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">hiveContext.parquetFile("/sparksql/people.parquet").registerAsTable("parquetTable2")&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">hiveContext.sql("select&nbsp;a.name,a.age,b.age&nbsp;from&nbsp;hiveTable&nbsp;a&nbsp;join&nbsp;parquetTable2&nbsp;b&nbsp;on&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.name</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">b</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.name").collect().foreach(println)&nbsp;&nbsp;</span></span></li></ol>
</div>
运行结果：<br>
<img alt="" src="./css/20140915101045498" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<div>&nbsp;</div>
<div>4：缓存之使用</div>
<div>&nbsp; &nbsp; &nbsp; sparkSQL的cache可以使用两种方法来实现：</div>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>cacheTable()方法</li><li>CACHE TABLE命令</li></ul>
&nbsp; &nbsp; &nbsp; 千万不要先使用cache SchemaRDD，然后registerAsTable ；使用RDD的cache()将使用原生态的cache，而不是针对SQL优化后的内存列存储。看看cacheTable的源代码：</div>
<div>
<div><img alt="" src="./css/20140915101102190" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;在默认的情况下，内存列存储的压缩功能是关闭的，要使用压缩功能需要配置变量COMPRESS_CACHED。</div>
<div>
<div><img alt="" src="./css/20140915100913187" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;在sqlContext里可以如下使用cache：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:8157px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 47431px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_73" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_73" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=73&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 47669px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_163" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_163" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=163&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">//sqlContext的cache使用&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">sqlContext.cacheTable("rddTable")&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">sqlContext.sql("SELECT&nbsp;name&nbsp;FROM&nbsp;rddTable&nbsp;WHERE&nbsp;age&nbsp;<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=&nbsp;13&nbsp;AND&nbsp;age&nbsp;</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=&nbsp;19").map(</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">t</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;"Name:&nbsp;"&nbsp;+&nbsp;t(0)).collect().foreach(println)&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">sqlContext.sql("CACHE&nbsp;TABLE&nbsp;parquetTable")&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">sqlContext.sql("SELECT&nbsp;name&nbsp;FROM&nbsp;parquetTable&nbsp;WHERE&nbsp;age&nbsp;<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=&nbsp;13&nbsp;AND&nbsp;age&nbsp;</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=&nbsp;19").map(</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">t</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;"Name:&nbsp;"&nbsp;+&nbsp;t(0)).collect().foreach(println)&nbsp;&nbsp;</span></span></li></ol>
</div>
观察webUI，可以看到cache的信息。（注意cache是lazy的，要有action才会实现；uncache是eager的，可以立即实现）</div>
<div>
<div><img alt="" src="./css/20140915101141003" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;使用如下命令可以取消cache：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:8706px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 47705px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_74" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_74" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=74&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 47943px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_164" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_164" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=164&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">sqlContext.uncacheTable("rddTable")&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">sqlContext.sql("UNCACHE&nbsp;TABLE&nbsp;parquetTable")&nbsp;&nbsp;</span></li></ol>
</div>
</div>
<div>同样的，在hiveContext也可以使用上面的方法cache或uncache（hiveContext继承于sqlContext）。</div>
<div><br>
</div>
<div>5：DSL之使用</div>
<div>&nbsp; &nbsp; &nbsp; sparkSQL除了支持HiveQL和SQL-92语法外，还支持DSL（Domain Specific Language）。在DSL中，使用scala符号'+标示符表示基础表中的列，spark的execution engine会将这些标示符隐式转换成表达式。另外可以在API中找到很多DSL相关的方法，如where()、select()、limit()等等，详细资料可以查看catalyst模块中的dsl子模块，下面为其中定义几种常用方法：</div>
<div>
<div><img alt="" src="./css/20140915101208100" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;</div>
<div>关于DSL的使用，随便举个例子，结合DSL方法，很容易上手：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39177041#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:9424px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 48087px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_75" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_75" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=75&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 48326px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_165" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_165" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=165&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">//DSL演示&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">teenagers_dsl</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">rddpeople</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.where('age&nbsp;</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=&nbsp;10).where('age&nbsp;</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=&nbsp;19).select('name)&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">teenagers_dsl.map(<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">t</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;"Name:&nbsp;"&nbsp;+&nbsp;t(0)).collect().foreach(println)&nbsp;&nbsp;</span></span></li></ol>
</div>
<br>
</div>
<div>6：Tips</div>
<div>&nbsp; &nbsp; &nbsp; 上面介绍了sparkSQL的基础应用，sparkSQL还在高速发展中，存在者不少缺陷，如：</div>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>scala2.10.4本身对case class有22列的限制，在使用RDD数据源的时候就会造成不方便；</li><li>sqlContext中3个表不能同时join，需要两两join后再join一次；</li><li>sqlContext中不能直接使用values插入数据；</li><li>。。。</li></ul>
&nbsp; &nbsp; &nbsp; 总的来说，hiveContext还是令人满意，sqlContext就有些差强人意了。另外，顺便提一句，在编写sqlContext应用程序的时候，case class要定义在object之外。</div>
</div>
<h2><a name="t6"></a><a target="_blank" name="t6"></a><a target="_blank" href="http://blog.csdn.net/book_mmicky/article/details/39152727" rel="nofollow" style="line-height:30px; font-family:&#39;Microsoft YaHei&#39;; color:rgb(51,51,51); font-size:20px; text-decoration:none">七：ThriftServer和CLI</a></h2>
</div>
<div>spark1.1相较于spark1.0，最大的差别就在于spark1.1增加了万人期待的CLI和ThriftServer。使得hive用户还有用惯了命令行的RDBMS数据库管理员很容易地上手sparkSQL，在真正意义上进入了SQL时代。下面先简单介绍其使用，限于时间关系，以后再附上源码分析。<span style="line-height:26px; font-family:Arial; font-size:14px"></span>
<div><br>
</div>
<div>1：令人惊讶的CLI</div>
<div>&nbsp; &nbsp; &nbsp; 刚部署好spark1.1就迫不及待地先测试CLI（bin/spark-sql），对于习惯了sql命令行的本人，失去了shark后，对于sparkSQL1.0一度很是抵触（其实对于开发调试人员来说，spark-shell才是利器，可以很方便地使用各个spark生态中的组件）。急切中，没有关闭hive metastore服务，然后一个bin/spark-sql就进入了命令行，然后通过hive metastore就可以直接对hive进行查询了：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:691px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 48804px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_76" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_76" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=76&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 49043px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_166" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_166" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=166&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">spark-sql</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;use&nbsp;saledata;&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">//所有订单中每年的销售单数、销售总额&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">spark-sql<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;select&nbsp;c.theyear,count(distinct&nbsp;a.ordernumber),sum(b.amount)&nbsp;from&nbsp;tblStock&nbsp;a&nbsp;join&nbsp;tblStockDetail&nbsp;b&nbsp;on&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.ordernumber</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">b</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.ordernumber&nbsp;join&nbsp;tbldate&nbsp;c&nbsp;on&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.dateid</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">c</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.dateid&nbsp;group&nbsp;by&nbsp;c.theyear&nbsp;order&nbsp;by&nbsp;c.theyear;&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div>运行结果：</div>
<div><img alt="" src="./css/20140915103820411" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
顺便地测试了一下hive0.13的语法（测试系统中使用的是hive0.13，spark1.1编译的时候是hive0.12，毫无意外地，在CLI里是不能使用hive0.13的语法，必须使用和spark匹配的hive版本的hive语法）。<span style="line-height:26px; font-family:Arial; font-size:14px"></span>
<div><br>
</div>
<div>1.1 CLI配置<br>
<div>
<div>&nbsp; &nbsp; &nbsp; 在使用CLI前，要先启动hive metastore；而CLI的配置非常简单，在conf/hive-site.xml中之需要指定hive metastore的uris就可以使用了。现在要在客户端wyy上使用spark-sql，配置conf/hive-site.xml如下：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:1182px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 49183px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_77" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_77" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=77&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 49422px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_167" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_167" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=167&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">configuration</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">property</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">name</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">hive.metastore.uris</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">name</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">value</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">thrift://hadoop3:9083</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">value</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">description</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">Thrift&nbsp;URI&nbsp;for&nbsp;the&nbsp;remote&nbsp;metastore.&nbsp;Used&nbsp;by&nbsp;metastore&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;remote&nbsp;metastore.</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">description</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">property</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">configuration</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div>
<div><br>
</div>
<div>1.2 CLI命令参数</div>
<div>
<div>通过<span style="font-family:monospace; white-space:pre">bin/spark-sql --help可以查看</span>CLI命令参数：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:1452px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 49457px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_78" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_78" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=78&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 49695px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_168" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_168" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=168&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">[hadoop@hadoop3&nbsp;spark110]$&nbsp;bin/spark-sql&nbsp;--help&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">Usage:&nbsp;./bin/spark-sql&nbsp;[options]&nbsp;[cli&nbsp;option]&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">CLI&nbsp;options:&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;-d,--define&nbsp;<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">key</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">key</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">value</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Variable&nbsp;subsitution&nbsp;to&nbsp;apply&nbsp;to&nbsp;hive&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commands.&nbsp;e.g.&nbsp;-d&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">A</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">B</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;or&nbsp;--define&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">A</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">B</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;--database&nbsp;<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">databasename</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Specify&nbsp;the&nbsp;database&nbsp;to&nbsp;use&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;-e&nbsp;<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">quoted-query-string</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SQL&nbsp;from&nbsp;command&nbsp;line&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;-f&nbsp;<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">filename</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SQL&nbsp;from&nbsp;files&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;-h&nbsp;<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">hostname</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connecting&nbsp;to&nbsp;Hive&nbsp;Server&nbsp;on&nbsp;remote&nbsp;host&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;--hiveconf&nbsp;<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">property</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">property</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">value</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;Use&nbsp;value&nbsp;for&nbsp;given&nbsp;property&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;--hivevar&nbsp;<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">key</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">key</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">value</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Variable&nbsp;subsitution&nbsp;to&nbsp;apply&nbsp;to&nbsp;hive&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commands.&nbsp;e.g.&nbsp;--hivevar&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">A</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">B</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;-i&nbsp;<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">filename</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Initialization&nbsp;SQL&nbsp;file&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;-p&nbsp;<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">port</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connecting&nbsp;to&nbsp;Hive&nbsp;Server&nbsp;on&nbsp;port&nbsp;number&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;-S,--silent&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Silent&nbsp;mode&nbsp;in&nbsp;interactive&nbsp;shell&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;-v,--verbose&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Verbose&nbsp;mode&nbsp;(echo&nbsp;executed&nbsp;SQL&nbsp;to&nbsp;the&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console)&nbsp;&nbsp;</span></li></ol>
</div>
</div>
<div>其中[options] 是CLI启动一个SparkSQL应用程序的参数，如果不设置--master的话，将在启动spark-sql的机器以local方式运行，只能通过http://机器名:4040进行监控；这部分参数，可以参照<a target="_blank" href="http://blog.csdn.net/book_mmicky/article/details/25714545" rel="nofollow" style="color:rgb(255,153,0); text-decoration:none">Spark1.0.0
 应用程序部署工具spark-submit</a>&nbsp;的参数。</div>
<div><span style="font-family:monospace; white-space:pre">[cli option]是CLI的参数，通过这些参数，CLI可以直接运行SQL文件、进入命令行运行SQL命令等等，类似以前的shark的用法。</span>需要注意的是CLI不是使用JDBC连接，所以不能连接到ThriftServer；但可以配置conf/hive-site.xml连接到hive的metastore，然后对hive数据进行查询。</div>
<div><br>
</div>
</div>
<div>1.3 CLI使用</div>
启动spark-sql：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:2038px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 50047px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_79" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_79" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=79&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 50286px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_169" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_169" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=169&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">bin/spark-sql&nbsp;--master&nbsp;spark://hadoop1:7077&nbsp;--executor-memory&nbsp;3g&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div>在集群监控页面可以看到启动了SparkSQL应用程序：</div>
<div>
<div><img alt="" src="./css/20140915103741203" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
这时就可以使用HQL语句对hive数据进行查询，另外，可以使用COMMAND，如使用set进行设置参数：默认情况下，sparkSQL shuffle的时候是200个partition，可以使用如下命令修改这个参数：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:2301px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 50244px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_80" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_80" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=80&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 50483px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_170" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_170" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=170&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">SET&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">spark.sql.shuffle.partitions</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">20</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">；&nbsp;&nbsp;</span></span></li></ol>
</div>
运行同一个查询语句，参数改变后，Task（partition）的数量就由200变成了20。</div>
<div>
<div><img alt="" src="./css/20140915103809687" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
基本上，在CLI可以使用绝大多数的hive特性。&nbsp;</div>
<div><br>
</div>
<div>2：ThriftServer</div>
<div>
<div>&nbsp; &nbsp; &nbsp; ThriftServer是一个JDBC/ODBC接口，用户可以通过JDBC/ODBC连接ThriftServer来访问SparkSQL的数据。ThriftServer在启动的时候，会启动了一个sparkSQL的应用程序，而通过JDBC/ODBC连接进来的客户端共同分享这个sparkSQL应用程序的资源，也就是说不同的用户之间可以共享数据；ThriftServer启动时还开启一个侦听器，等待JDBC客户端的连接和提交查询。所以，在配置ThriftServer的时候，至少要配置ThriftServer的主机名和端口，如果要使用hive数据的话，还要提供hive
 metastore的uris。</div>
<div><br>
</div>
<div>2.1 ThriftServer配置</div>
<div>&nbsp; &nbsp; &nbsp; 通常，ThriftServer可以在conf/hive-site.xml中定义以下几项配置，也可以使用环境变量的方式进行配置（环境变量的优先级高于hive-site.xml）。</div>
<div>&nbsp; &nbsp; &nbsp; 下面是在实验集群中hadoop2上启动ThriftServer的hive-site.xml配置：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:3138px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 50748px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_81" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_81" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=81&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 50987px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_171" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_171" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=171&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">configuration</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">property</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">name</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">hive.metastore.uris</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">name</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">value</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">thrift://hadoop3:9083</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">value</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">description</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">Thrift&nbsp;URI&nbsp;for&nbsp;the&nbsp;remote&nbsp;metastore.&nbsp;Used&nbsp;by&nbsp;metastore&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;remote&nbsp;metastore.</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">description</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">property</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">property</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">name</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">hive.server2.thrift.min.worker.threads</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">name</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">value</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">5</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">value</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">description</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">Minimum&nbsp;number&nbsp;of&nbsp;Thrift&nbsp;worker&nbsp;threads</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">description</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">property</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">property</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">name</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">hive.server2.thrift.max.worker.threads</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">name</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">value</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">500</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">value</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">description</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">Maximum&nbsp;number&nbsp;of&nbsp;Thrift&nbsp;worker&nbsp;threads</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">description</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">property</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">property</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">name</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">hive.server2.thrift.port</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">name</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">value</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">10000</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">value</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">description</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">Port&nbsp;number&nbsp;of&nbsp;HiveServer2&nbsp;Thrift&nbsp;interface.&nbsp;Can&nbsp;be&nbsp;overridden&nbsp;by&nbsp;setting&nbsp;$HIVE_SERVER2_THRIFT_PORT</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">description</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">property</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">property</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">name</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">hive.server2.thrift.bind.host</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">name</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">value</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">hadoop2</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">value</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">description</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">Bind&nbsp;host&nbsp;on&nbsp;which&nbsp;to&nbsp;run&nbsp;the&nbsp;HiveServer2&nbsp;Thrift&nbsp;interface.Can&nbsp;be&nbsp;overridden&nbsp;by&nbsp;setting$HIVE_SERVER2_THRIFT_BIND_HOST</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">description</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">property</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&lt;/</span><span class="tag-name" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">configuration</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div>
<div><br>
</div>
<div>2.2 ThriftServer命令参数</div>
<div>
<div>使用<span style="font-family:monospace; white-space:pre">sbin/start-thriftserver.sh --help可以查看ThriftServer的命令参数：</span></div>
<div><span style="font-family:monospace; white-space:pre"></span>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:3847px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 51463px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_82" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_82" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=82&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 51701px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_172" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_172" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=172&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">[hadoop@hadoop3&nbsp;spark110]$&nbsp;sbin/start-thriftserver.sh&nbsp;--help&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">Usage:&nbsp;./sbin/start-thriftserver&nbsp;[options]&nbsp;[thrift&nbsp;server&nbsp;options]&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">Thrift&nbsp;server&nbsp;options:&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Use&nbsp;value&nbsp;for&nbsp;given&nbsp;property&nbsp;&nbsp;</span></li></ol>
</div>
</div>
<div>其中[options] 是ThriftServer启动一个SparkSQL应用程序的参数，如果不设置--master的话，将在启动ThriftServer的机器以local方式运行，只能通过http://机器名:4040进行监控；这部分参数，可以参照<a target="_blank" href="http://blog.csdn.net/book_mmicky/article/details/25714545" rel="nofollow" style="color:rgb(255,153,0); text-decoration:none">Spark1.0.0
 应用程序部署工具spark-submit</a>&nbsp;的参数。在集群中提供ThriftServer的话，一定要配置master、executor-memory等参数。</div>
<div>[thrift server options]是ThriftServer的参数，可以使用-d<span style="font-family:monospace; white-space:pre">property=value的格式来定义；</span>在实际应用上，因为参数比较多，通常使用conf/hive-site.xml配置。</div>
</div>
<div><br>
</div>
<div>2.3 ThriftServer使用</div>
<div>2.3.1 启动ThriftServer</div>
<div>启动ThriftServer，使之运行在spark集群中：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:4233px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 51852px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_83" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_83" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=83&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 52091px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_173" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_173" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=173&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">sbin/start-thriftserver.sh&nbsp;--master&nbsp;spark://hadoop1:7077&nbsp;--executor-memory&nbsp;3g&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div>在集群监控页面可以看到启动了SparkSQL应用程序：</div>
<div><img alt="" src="./css/20140915104142353" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<span style="color:rgb(255,0,0)">注意不要将<span style="font-family:monospace; white-space:pre">hive.server2.thrift.bind.host配置能localhost，不然远程客户端不能连接。</span></span></div>
<div><span style="font-family:monospace; white-space:pre"><br>
</span></div>
<div><span style="font-family:monospace; white-space:pre">2.3.2 远程客户端连接</span></div>
<div><span style="font-family:monospace"><span style="white-space:pre">切换到客户端wyy，启动bin/beeline，用!connect jdbc:hive2://hadoop2:10000</span></span><span style="font-family:monospace; white-space:pre">连接ThriftServer，因为没有采用权限管理，所以用户名用运行bin/beeline的用户，密码为空：</span></div>
<div>
<div><img alt="" src="./css/20140915103952312" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
然后，对tblstock进行下面操作：</div>
<div>
<ol style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>切换数据库saledata；</li><li>cache table tblstock；</li><li>对tblstock计数；</li></ol>
<div><img alt="" src="./css/20140915104221244" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
因为首次操作，所以统计花了11.725秒，查看webUI，tblStock已经缓存：</div>
<div>
<div><img alt="" src="./css/20140915104028984" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
然后启动另外一个远程连接，切换到hadoop1，<span style="font-family:monospace"><span style="white-space:pre">启动bin/beeline，用!connect jdbc:hive2://hadoop2:10000</span></span><span style="font-family:monospace; white-space:pre">连接ThriftServer，然后直接运行</span>对tblstock计数（注意没有进行数据库的切换）：</div>
<div>
<div><img alt="" src="./css/20140915104042000" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
用时<span style="color:rgb(255,0,0)">0.664秒</span>，再查看webUI中的stage：</div>
<div>
<div><img alt="" src="./css/20140915104254176" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
Locality Level是PROCESS，显然是使用了缓存表。</div>
<div>从上可以看出，ThriftServer可以连接多个JDBC/ODBC客户端，并相互之间可以共享数据。顺便提一句，ThriftServer启动后处于监听状态，用户可以使用ctrl+c退出ThriftServer；而beeline的退出使用!q命令。</div>
<div>&nbsp;</div>
<div>2.3.3 代码示例</div>
<div>&nbsp; &nbsp; &nbsp; 有了ThriftServer，开发人员可以非常方便的使用JDBC/ODBC来访问sparkSQL。下面是一个scala代码，查询表tblStockDetail ，返回amount&gt;3000的单据号和交易金额：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39152727#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:6180px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 52750px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_84" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_84" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=84&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 52988px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_174" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_174" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=174&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">package&nbsp;doc&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">import&nbsp;java.sql.DriverManager&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">object&nbsp;SQLJDBC&nbsp;{&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;def&nbsp;main(args:&nbsp;Array[String])&nbsp;{&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;Class.forName("org.apache.hive.jdbc.HiveDriver")&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">conn</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">DriverManager</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.getConnection("jdbc:hive2://hadoop2:10000",&nbsp;"hadoop",&nbsp;"")&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">statement</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">conn</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.createStatement&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">rs</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">statement</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.executeQuery("select&nbsp;ordernumber,amount&nbsp;from&nbsp;tblStockDetail&nbsp;where&nbsp;amount</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">3000")&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(rs.next)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">ordernumber</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">rs</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.getString("ordernumber")&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">amount</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">rs</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.getString("amount")&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;println("<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">ordernumber</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;%s,&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">amount</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;%s".format(ordernumber,&nbsp;amount))&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;{&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;e:&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">Exception</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;e.printStackTrace&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;conn.close&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">}&nbsp;&nbsp;</span></li></ol>
</div>
运行结果：</div>
<div>
<div><img alt="" src="./css/20140915104332864" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
如需更详细的信息，请参照：<a target="_blank" href="https://cwiki.apache.org/confluence/display/Hive/HiveServer2+Clients" rel="nofollow" style="color:rgb(255,153,0); text-decoration:none">HiveServer2 Clients</a>。</div>
<div><br>
</div>
<div>3：小结</div>
<div>&nbsp; &nbsp; &nbsp; 总的来说，ThriftServer和CLI的引入，使得sparkSQL可以更方便的使用hive数据，使得sparkSQL可以更接近使用者，而非开发者。</div>
</div>
</div>
</div>
<h2><a name="t7"></a><a target="_blank" name="t7"></a><a target="_blank" href="http://blog.csdn.net/book_mmicky/article/details/39202093" rel="nofollow" style="line-height:30px; font-family:&#39;Microsoft YaHei&#39;; color:rgb(51,51,51); font-size:20px; text-decoration:none">八：sparkSQL之综合应用</a></h2>
</div>
<div>Spark之所以万人瞩目，除了内存计算，还有其ALL-IN-ONE的特性，实现了One stack rule them all。下面简单模拟了几个综合应用场景，不仅使用了sparkSQL，还使用了其他Spark组件：<br>
<div>
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>店铺分类，根据销售额对店铺分类，使用sparkSQL和MLLib</li><li>PageRank，计算最有价值的网页，使用sparkSQL和GraphX</li></ul>
</div>
<div>
<div>&nbsp; &nbsp; &nbsp; 前者将使用sparkSQL+MLlib的聚类算法，后者将使用sparkSQL+GraphX的PageRank算法。本实验采用IntelliJ IDEA调试代码，最后生成doc.jar，然后使用spark-submit提交给集群运行。</div>
<div><br>
</div>
<div>1：店铺分类</div>
<div>&nbsp; &nbsp; &nbsp; 分类在实际应用中非常普遍，比如对客户进行分类、对店铺进行分类等等，对不同类别采取不同的策略，可以有效的降低企业的营运成本、增加收入。机器学习中的聚类就是一种根据不同的特征数据，结合用户指定的类别数量，将数据分成几个类的方法。下面举个简单的例子，对第五小结中的hive数据，按照销售数量和销售金额这两个特征数据，进行聚类，分出3个等级的店铺。</div>
<div>&nbsp; &nbsp; &nbsp; 在IDEA中建立一个object：SQLMLlib</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:813px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 53841px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_85" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_85" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=85&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 54079px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_175" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_175" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=175&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">package&nbsp;doc&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">import&nbsp;org.apache.log4j.{Level,&nbsp;Logger}&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">import&nbsp;org.apache.spark.sql.catalyst.expressions.Row&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">import&nbsp;org.apache.spark.{SparkConf,&nbsp;SparkContext}&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">import&nbsp;org.apache.spark.sql.hive.HiveContext&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">import&nbsp;org.apache.spark.mllib.clustering.KMeans&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">import&nbsp;org.apache.spark.mllib.linalg.Vectors&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">object&nbsp;SQLMLlib&nbsp;{&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;def&nbsp;main(args:&nbsp;Array[String])&nbsp;{&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//屏蔽不必要的日志显示在终端上&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;Logger.getLogger("org.apache.spark").setLevel(Level.WARN)&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;Logger.getLogger("org.eclipse.jetty.server").setLevel(Level.OFF)&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//设置运行环境&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">sparkConf</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">new</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;SparkConf().setAppName("SQLMLlib")&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">sc</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">new</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;SparkContext(sparkConf)&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">hiveContext</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">new</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;HiveContext(sc)&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//使用sparksql查出每个店的销售数量和金额&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;hiveContext.sql("use&nbsp;saledata")&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;hiveContext.sql("SET&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">spark.sql.shuffle.partitions</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">20</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">")&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">sqldata</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">hiveContext</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.sql("select&nbsp;a.locationid,&nbsp;sum(b.qty)&nbsp;totalqty,sum(b.amount)&nbsp;totalamount&nbsp;from&nbsp;tblStock&nbsp;a&nbsp;join&nbsp;tblstockdetail&nbsp;b&nbsp;on&nbsp;</span><span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">a.ordernumber</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">=</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">b</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.ordernumber&nbsp;group&nbsp;by&nbsp;a.locationid")&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//将查询数据转换成向量&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">parsedData</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">sqldata</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.map&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;Row(_,&nbsp;totalqty,&nbsp;totalamount)&nbsp;=<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">features</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">Array</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">[Double](totalqty.toString.toDouble,&nbsp;totalamount.toString.toDouble)&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Vectors.dense(features)&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//对数据集聚类，3个类，20次迭代，形成数据模型&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//注意这里会使用设置的partition数20&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">numClusters</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">3</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">numIterations</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">20</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">model</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">KMeans</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.train(parsedData,&nbsp;numClusters,&nbsp;numIterations)&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//用模型对读入的数据进行分类，并输出&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//由于partition没设置，输出为200个小文件，可以使用bin/hdfs&nbsp;dfs&nbsp;-getmerge&nbsp;合并下载到本地&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">result2</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">sqldata</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.map&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;Row(locationid,&nbsp;totalqty,&nbsp;totalamount)&nbsp;=<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">features</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">Array</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">[Double](totalqty.toString.toDouble,&nbsp;totalamount.toString.toDouble)&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">linevectore</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">Vectors</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.dense(features)&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">prediction</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">model</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.predict(linevectore)&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;locationid&nbsp;+&nbsp;"&nbsp;"&nbsp;+&nbsp;totalqty&nbsp;+&nbsp;"&nbsp;"&nbsp;+&nbsp;totalamount&nbsp;+&nbsp;"&nbsp;"&nbsp;+&nbsp;prediction&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;}.saveAsTextFile(args(0))&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;sc.stop()&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">}&nbsp;&nbsp;</span></li></ol>
</div>
编译打包后，复制到spark安装目录下运行：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:1818px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 54851px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_86" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_86" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=86&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 55090px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_176" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_176" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=176&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">cp&nbsp;/home/mmicky/IdeaProjects/doc/out/artifacts/doc/doc.jar&nbsp;.&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">bin/spark-submit&nbsp;--master&nbsp;spark://hadoop1:7077&nbsp;--executor-memory&nbsp;3g&nbsp;--class&nbsp;doc.SQLMLlib&nbsp;doc.jar&nbsp;/sparksql/output1&nbsp;&nbsp;</span></li></ol>
</div>
</div>
<div>
<div>运行过程，可以发现聚类过程都是使用20个partition：</div>
<div>
<div><img alt="" src="./css/20140915104814725" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;运行完毕，使用getmerge将结果转到本地文件，并查看结果：</div>
</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:2399px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 55037px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_87" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_87" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=87&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 55276px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_177" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_177" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=177&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">bin/hdfs&nbsp;dfs&nbsp;-getmerge&nbsp;/sparksql/output1&nbsp;result.txt&nbsp;&nbsp;</span></span></li></ol>
</div>
</div>
<div>
<div><img alt="" src="./css/20140915104843195" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
最后使用R做示意图，用3种不同的颜色表示不同的类别。</div>
<div>
<div><img alt="" src="./css/20140915104657937" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;&nbsp;</div>
<div>2：PageRank</div>
<div>&nbsp; &nbsp; &nbsp;&nbsp;PageRank,即网页排名，又称网页级别、Google左侧排名或佩奇排名，是Google创始人拉里·佩奇和谢尔盖·布林于1997年构建早期的搜索系统原型时提出的链接分析算法。目前很多重要的链接分析算法都是在PageRank算法基础上衍生出来的。PageRank是Google用于用来标识网页的等级/重要性的一种方法，是Google用来衡量一个网站的好坏的唯一标准。在揉合了诸如Title标识和Keywords标识等所有其它因素之后，Google通过PageRank来调整结果，使那些更具“等级/重要性”的网页在搜索结果中令网站排名获得提升，从而提高搜索结果的相关性和质量。</div>
<div>&nbsp; &nbsp; &nbsp; Spark GraphX引入了google公司的图处理引擎pregel，可以方便的实现PageRank的计算。下面实例采用的数据是wiki数据中含有Berkeley标题的网页之间连接关系，该数据集已经经过ETL，最终为两个文件：graphx-wiki-vertices.txt和graphx-wiki-edges.txt ，可以分别用于图计算的顶点和边。</div>
<div>&nbsp; &nbsp; &nbsp; 首先，启动bin/spark-sql，将这两个文件定义为表：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:3814px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 55514px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_88" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_88" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=88&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 55752px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_178" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_178" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=178&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">//启动spark-sql，运行下列语句创建表&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">CREATE&nbsp;TABLE&nbsp;vertices(ID&nbsp;BigInt,Title&nbsp;String)&nbsp;ROW&nbsp;FORMAT&nbsp;DELIMITED&nbsp;FIELDS&nbsp;TERMINATED&nbsp;BY&nbsp;'\t'&nbsp;LINES&nbsp;TERMINATED&nbsp;BY&nbsp;'\n';&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">LOAD&nbsp;DATA&nbsp;INPATH&nbsp;'/sparksql/graphx-wiki-vertices.txt'&nbsp;INTO&nbsp;TABLE&nbsp;vertices;&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">CREATE&nbsp;TABLE&nbsp;edges(SRCID&nbsp;BigInt,DISTID&nbsp;BigInt)&nbsp;ROW&nbsp;FORMAT&nbsp;DELIMITED&nbsp;FIELDS&nbsp;TERMINATED&nbsp;BY&nbsp;'\t'&nbsp;LINES&nbsp;TERMINATED&nbsp;BY&nbsp;'\n';&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">LOAD&nbsp;DATA&nbsp;INPATH&nbsp;'/sparksql/graphx-wiki-edges.txt'&nbsp;INTO&nbsp;TABLE&nbsp;edges;&nbsp;&nbsp;</span></li></ol>
</div>
</div>
<div>&nbsp; &nbsp; &nbsp; 然后，在IDEA中建立一个object：SQLGraphX</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:4010px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 55715px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_89" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_89" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=89&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 55953px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_179" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_179" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=179&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">package&nbsp;doc&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">import&nbsp;org.apache.log4j.{Level,&nbsp;Logger}&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">import&nbsp;org.apache.spark.sql.hive.HiveContext&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">import&nbsp;org.apache.spark.{SparkContext,&nbsp;SparkConf}&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">import&nbsp;org.apache.spark.graphx._&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">import&nbsp;org.apache.spark.sql.catalyst.expressions.Row&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">object&nbsp;SQLGraphX&nbsp;{&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;def&nbsp;main(args:&nbsp;Array[String])&nbsp;{&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//屏蔽日志&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;Logger.getLogger("org.apache.spark").setLevel(Level.WARN)&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;Logger.getLogger("org.eclipse.jetty.server").setLevel(Level.OFF)&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//设置运行环境&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">sparkConf</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">new</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;SparkConf().setAppName("PageRank").setMaster("local")&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">sc</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">new</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;SparkContext(sparkConf)&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">hiveContext</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">new</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;HiveContext(sc)&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//使用sparksql查出每个店的销售数量和金额&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;hiveContext.sql("use&nbsp;saledata")&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">verticesdata</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">hiveContext</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.sql("select&nbsp;id,&nbsp;title&nbsp;from&nbsp;vertices")&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">edgesdata</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">hiveContext</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.sql("select&nbsp;srcid,distid&nbsp;from&nbsp;edges")&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//装载顶点和边&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">vertices</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">verticesdata</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.map&nbsp;{&nbsp;case&nbsp;Row(id,&nbsp;title)&nbsp;=</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;(id.toString.toLong,&nbsp;title.toString)}&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">edges</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">edgesdata</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.map&nbsp;{&nbsp;case&nbsp;Row(srcid,&nbsp;distid)&nbsp;=</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;Edge(srcid.toString.toLong,&nbsp;distid.toString.toLong,&nbsp;0)}&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//构建图&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">graph</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">Graph</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">(vertices,&nbsp;edges,&nbsp;"").persist()&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;//pageRank算法里面的时候使用了cache()，故前面persist的时候只能使用MEMORY_ONLY&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;println("**********************************************************")&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;println("PageRank计算，获取最有价值的数据")&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;println("**********************************************************")&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">prGraph</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">graph</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.pageRank(0.001).cache()&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">titleAndPrGraph</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=&nbsp;</span><span class="attribute-value" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; padding-top:0px">graph</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">.outerJoinVertices(prGraph.vertices)&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(v,&nbsp;title,&nbsp;rank)&nbsp;=<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;(rank.getOrElse(0.0),&nbsp;title)&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;titleAndPrGraph.vertices.top(10)&nbsp;{&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ordering.by((entry:&nbsp;(VertexId,&nbsp;(Double,&nbsp;String)))&nbsp;=<span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;entry._2._1)&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;}.foreach(<span class="attribute" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:red; border-left-style:none; padding-top:0px">t</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;=</span><span class="tag" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:blue; border-left-style:none; font-weight:bold; padding-top:0px">&gt;</span><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">&nbsp;println(t._2._2&nbsp;+&nbsp;":&nbsp;"&nbsp;+&nbsp;t._2._1))&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;&nbsp;&nbsp;sc.stop()&nbsp;&nbsp;</span></li><li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">}&nbsp;&nbsp;</span></li></ol>
</div>
</div>
<div>编译打包后，复制到spark安装目录下运行：</div>
<div>
<div class="dp-highlighter bg_html" style="background-color:rgb(231,229,220); margin:18px 0px; width:936px; font-family:Consolas,&#39;Courier New&#39;,Courier,mono,serif; font-size:12px; overflow:auto; padding-top:1px">
<div class="bar" style="padding-left:45px">
<div class="tools" style="border-left:rgb(153,153,153) 3px solid; padding-bottom:10px; line-height:normal; background-color:rgb(248,248,248); padding-left:10px; padding-right:8px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; color:silver; font-size:9px; padding-top:3px">
<strong>[html]</strong>&nbsp;<a target="_blank" class="ViewSource" title="view plain" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">view
 plain</a><a target="_blank" class="CopyToClipboard" title="copy" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">copy</a><a target="_blank" class="PrintSource" title="print" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">print</a><a target="_blank" class="About" title="?" href="http://blog.csdn.net/book_mmicky/article/details/39202093#" rel="nofollow" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px 10px 0px 0px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(160,160,160); font-size:9px; border-left-style:none; text-decoration:none; padding-top:0px">?</a>
<div style="z-index:99; position:absolute; width:23px; height:11px; top:4945px; left:417px">
</div>
<div style="position: absolute; left: 610px; top: 56655px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_90" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_90" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=90&amp;width=16&amp;height=16" wmode="transparent"></div><div style="position: absolute; left: 610px; top: 56893px; width: 16px; height: 16px; z-index: 99;"><embed id="ZeroClipboardMovie_180" src="https://csdnimg.cn/public/highlighter/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="16" height="16" name="ZeroClipboardMovie_180" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=180&amp;width=16&amp;height=16" wmode="transparent"></div></div>
</div>
<ol class="dp-xml" style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; background-color:rgb(255,255,255); margin:0px 0px 1px 45px; padding-left:0px; padding-right:0px; border-top-style:none; color:rgb(92,92,92); border-left-style:none; padding-top:0px">
<li class="alt" style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px"><span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; border-left-style:none; padding-top:0px">cp&nbsp;/home/mmicky/IdeaProjects/doc/out/artifacts/doc/doc.jar&nbsp;.&nbsp;&nbsp;</span></span></li><li style="list-style-position:outside; border-bottom-style:none; border-left:rgb(153,153,153) 3px solid; padding-bottom:0px!important; line-height:18px; border-right-style:none; background-color:rgb(248,248,248); list-style-type:decimal-leading-zero; margin:0px; padding-left:10px!important; padding-right:3px!important; border-top-style:none; color:rgb(85,85,85); padding-top:0px!important">
<span style="border-bottom-style:none; padding-bottom:0px; border-right-style:none; margin:0px; padding-left:0px; padding-right:0px; border-top-style:none; color:black; border-left-style:none; padding-top:0px">bin/spark-submit&nbsp;--master&nbsp;spark://hadoop1:7077&nbsp;--executor-memory&nbsp;3g&nbsp;--class&nbsp;doc.SQLGraphX&nbsp;doc.jar&nbsp;&nbsp;</span></li></ol>
</div>
</div>
<div>运行结果：</div>
<div><img alt="" src="./css/20140915104837781" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
<div><br>
</div>
<div>3：小结</div>
<div>&nbsp; &nbsp; &nbsp; 在现实数据处理过程中，这种涉及多个系统处理的场景很多。通常各个系统之间的数据通过磁盘落地再交给下一个处理系统进行处理。对于Spark来说，通过多个组件的配合，可以以流水线的方式来处理数据。从上面的代码可以看出，程序除了最后有磁盘落地外，都是在内存中计算的。避免了多个系统中交互数据的落地过程，提高了效率。这才是spark生态系统真正强大之处：One stack rule them all。另外sparkSQL+sparkStreaming可以架构当前非常热门的Lambda架构体系，为CEP提供解决方案。也正是如此强大，才吸引了广大开源爱好者的目光，促进了spark生态的高速发展。</div>
</div>
<h2><a name="t8"></a><a target="_blank" name="t8"></a><span style="line-height:30px; font-family:&#39;Microsoft YaHei&#39;; color:rgb(255,102,102); font-size:20px"><a target="_blank" href="http://blog.csdn.net/book_mmicky/article/details/40394081" rel="nofollow" style="text-decoration:none">九：sparkSQL之调优</a></span></h2>
<h2><span style="font-weight:normal"><span style="font-size:15px">spark是一个快速的内存计算框架；同时是一个并行运算的框架。在计算性能调优的时候，除了要考虑广为人知的木桶原理外，还要考虑</span><span style="font-size:15px">平行运算的</span><span style="font-size:15px">Amdahl定理。</span><span style="line-height:26px; font-family:Arial; font-size:14px"></span></span>
<div style="font-size:15px"><span style="font-weight:normal">&nbsp; &nbsp; &nbsp;&nbsp;木桶原理又称短板理论，其核心思想是：一只木桶盛水的多少，并不取决于桶壁上最高的那块木块，而是取决于桶壁上最短的那块。将这个理论应用到系统性能优化上，系统的最终性能取决于系统中性能表现最差的组件。例如，即使系统拥有充足的内存资源和CPU资源，但是如果磁盘I/O性能低下，那么系统的总体性能是取决于当前最慢的磁盘I/O速度，而不是当前最优越的CPU或者内存。在这种情况下，如果需要进一步提升系统性能，优化内存或者CPU资源是毫无用处的。只有提高磁盘I/O性能才能对系统的整体性能进行优化。</span></div>
<div style="font-size:15px">
<div><span style="font-weight:normal"><img alt="" src="./css/20141023112640443" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</span></div>
<span style="font-weight:normal">&nbsp; &nbsp; &nbsp; &nbsp;Amdahl定理，一个计算机科学界的经验法则，因吉恩·阿姆达尔而得名。它代表了处理器平行运算之后效率提升的能力。并行计算中的加速比是用并行前的执行速度和并行后的执行速度之比来表示的，它表示了在并行化之后的效率提升情况。阿姆达尔定律是固定负载（计算总量不变时）时的量化标准。可用公式<span style="line-height:22px; font-family:sans-serif; color:rgb(37,37,37); font-size:14px">：</span><img alt="\frac{W_s + W_p}{W_s + \frac{W_p}{p}}" src="./css/e28f864f6e832dc74aa267d7a911fe3a.png" style="border-bottom:0px; border-left:0px; line-height:22px; margin:0px; display:inline; font-family:sans-serif; max-width:100%; color:rgb(37,37,37); font-size:14px; vertical-align:middle; border-top:0px; border-right:0px">来表示。式中<img title="sparkSQL1.1入门之九：sparkSQL之调优 - mmicky - mmicky 的博客" alt="W_s, W_p" src="./css/bd7ed6585db904730461519ca8865c9d.png" style="border-bottom:0px; border-left:0px; line-height:22px; margin:0px; display:inline; font-family:sans-serif; max-width:100%; color:rgb(37,37,37); font-size:14px; vertical-align:middle; border-top:0px; border-right:0px">分别表示问题规模的串行分量（问题中不能并行化的那一部分）和并行分量，p表示处理器数量。当<img alt="p\to \infty" src="./css/adf4dde682aaad98afa462bd1856444e.png" style="border-bottom:0px; border-left:0px; line-height:22px; margin:0px; display:inline; font-family:sans-serif; max-width:100%; color:rgb(37,37,37); font-size:14px; vertical-align:middle; border-top:0px; border-right:0px">时，上式的极限是<img alt="\frac{W}{W_s}" src="./css/3337f27fae249bccb53956d1dc74dd76.png" style="border-bottom:0px; border-left:0px; line-height:22px; margin:0px; display:inline; font-family:sans-serif; max-width:100%; color:rgb(37,37,37); font-size:14px; vertical-align:middle; border-top:0px; border-right:0px">，其中，<img title="sparkSQL1.1入门之九：sparkSQL之调优 - mmicky - mmicky 的博客" alt="{W}={W_s}+{W_p}" src="./css/0cf95d49237240a9b18ae9dd6bd2bb03.png" style="border-bottom:0px; border-left:0px; line-height:22px; margin:0px; display:inline; font-family:sans-serif; max-width:100%; color:rgb(37,37,37); font-size:14px; vertical-align:middle; border-top:0px; border-right:0px">。这意味着无论我们如何增大处理器数目，加速比是无法高于这个数的。</span></div>
<div style="font-size:15px"><span style="font-weight:normal">&nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div style="font-size:15px"><span style="font-weight:normal">&nbsp; &nbsp; &nbsp; SparkSQL作为Spark的一个组件，在调优的时候，也要充分考虑到上面的两个原理，既要考虑如何充分的利用硬件资源，又要考虑如何利用好分布式系统的并行计算。由于测试环境条件有限，本篇不能做出更详尽的实验数据来说明，只能在理论上加以说明。</span></div>
<div style="font-size:15px"><span style="font-weight:normal"><br>
</span></div>
<div style="font-size:15px"><span style="font-weight:normal">1：并行性</span></div>
<div style="font-size:15px"><span style="font-weight:normal">&nbsp; &nbsp; &nbsp; SparkSQL在集群中运行，将一个查询任务分解成大量的Task分配给集群中的各个节点来运行。通常情况下，Task的数量是大于集群的并行度。比如前面第六章和第七章查询数据时，shuffle的时候使用了缺省的spark.sql.shuffle.partitions，即200个partition，也就是200个Task：</span></div>
<div style="font-size:15px">
<div><span style="font-weight:normal"><img alt="" src="./css/20141023112220125" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</span></div>
<span style="font-weight:normal">&nbsp;而实验的集群环境却只能并行3个Task，也就是说同时只能有3个Task保持Running：</span></div>
<div style="font-size:15px">
<div><span style="font-weight:normal"><img alt="" src="./css/20141023112237203" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</span></div>
<span style="font-weight:normal">这时大家就应该明白了，要跑完这200个Task就要跑200/3=67批次。如何减少运行的批次呢？那就要尽量提高查询任务的并行度。查询任务的并行度由两方面决定：集群的处理能力和集群的有效处理能力。</span></div>
<div style="font-size:15px">
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li><span style="font-weight:normal">对于Spark Standalone集群来说，集群的处理能力是由conf/spark-env中的SPARK_WORKER_INSTANCES参数、SPARK_WORKER_CORES参数决定的；而SPARK_WORKER_INSTANCES*SPARK_WORKER_CORES不能超过物理机器的实际CPU core；</span></li><li><span style="font-weight:normal">集群的有效处理能力是指集群中空闲的集群资源，一般是指使用spark-submit或spark-shell时指定的--total-executor-cores，一般情况下，我们不需要指定，这时候，Spark Standalone集群会将所有空闲的core分配给查询，并且在Task轮询运行过程中，Standalone集群会将其他spark应用程序运行完后空闲出来的core也分配给正在运行中的查询。</span></li></ul>
</div>
<div style="font-size:15px"><span style="font-weight:normal">综上所述，sparkSQL的查询并行度主要和集群的core数量相关，合理配置每个节点的core可以提高集群的并行度，提高查询的效率。</span></div>
<div style="font-size:15px"><span style="font-weight:normal"><br>
</span></div>
<div style="font-size:15px"><span style="font-weight:normal">2： 高效的数据格式</span></div>
<div style="font-size:15px"><span style="font-weight:normal">&nbsp; &nbsp; &nbsp; 高效的数据格式，一方面是加快了数据的读入速度，另一方面可以减少内存的消耗。高效的数据格式包括多个方面：</span></div>
<div style="font-size:15px"><span style="font-weight:normal">2.1 数据本地性</span></div>
<div style="font-size:15px"><span style="font-weight:normal">&nbsp; &nbsp; &nbsp; 分布式计算系统的精粹在于移动计算而非移动数据，但是在实际的计算过程中，总存在着移动数据的情况，除非是在集群的所有节点上都保存数据的副本。移动数据，将数据从一个节点移动到另一个节点进行计算，不但消耗了网络IO，也消耗了磁盘IO，降低了整个计算的效率。为了提高数据的本地性，除了优化算法（也就是修改spark内存，难度有点高），就是合理设置数据的副本。设置数据的副本，这需要通过配置参数并长期观察运行状态才能获取的一个经验值。</span></div>
<div style="font-size:15px"><span style="font-weight:normal">&nbsp; &nbsp; &nbsp; 下面是spark webUI监控Stage的一个图：</span></div>
<div style="font-size:15px">
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li><span style="font-weight:normal">PROCESS_LOCAL是指读取缓存在本地节点的数据</span></li><li><span style="font-weight:normal">NODE_LOCAL是指读取本地节点硬盘数据</span></li><li><span style="font-weight:normal">ANY是指读取非本地节点数据</span></li><li><span style="font-weight:normal">通常读取数据PROCESS_LOCAL&gt;NODE_LOCAL&gt;ANY，尽量使数据以PROCESS_LOCAL或NODE_LOCAL方式读取。其中PROCESS_LOCAL还和cache有关。</span></li></ul>
</div>
<div style="font-size:15px">
<div><span style="font-weight:normal"><img alt="" src="./css/20141023112735527" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</span></div>
<span style="font-weight:normal">&nbsp;</span></div>
<div style="font-size:15px"><span style="font-weight:normal">2.2 合适的数据类型</span></div>
<div style="font-size:15px"><span style="font-weight:normal">&nbsp; &nbsp; &nbsp; 对于要查询的数据，定义合适的数据类型也是非常有必要。对于一个tinyint可以使用的数据列，不需要为了方便定义成int类型，一个tinyint的数据占用了1个byte，而int占用了4个byte。也就是说，一旦将这数据进行缓存的话，内存的消耗将增加数倍。在SparkSQL里，定义合适的数据类型可以节省有限的内存资源。</span></div>
<div style="font-size:15px"><span style="font-weight:normal"><br>
</span></div>
<div style="font-size:15px"><span style="font-weight:normal">2.3 合适的数据列</span></div>
<div style="font-size:15px"><span style="font-weight:normal">&nbsp; &nbsp; &nbsp; 对于要查询的数据，在写SQL语句的时候，尽量写出要查询的列名，如Select a,b from tbl，而不是使用Select * from tbl；这样不但可以减少磁盘IO，也减少缓存时消耗的内存。</span></div>
<div style="font-size:15px"><span style="font-weight:normal"><br>
</span></div>
<div style="font-size:15px"><span style="font-weight:normal">2.4 更优的数据存储格式</span></div>
<div style="font-size:15px"><span style="font-weight:normal">&nbsp; &nbsp; &nbsp; 在查询的时候，最终还是要读取存储在文件系统中的文件。采用更优的数据存储格式，将有利于数据的读取速度。查看sparkSQL的stage，可以发现，很多时候，数据读取消耗占有很大的比重。对于sqlContext来说，支持 textFiile、SequenceFile、ParquetFile、jsonFile；对于hiveContext来说，支持AvroFile、ORCFile、Parquet
 File，以及各种压缩。根据自己的业务需求，测试并选择合适的数据存储格式将有利于提高sparkSQL的查询效率。</span></div>
<div style="font-size:15px"><span style="font-weight:normal"><br>
</span></div>
<div style="font-size:15px"><span style="font-weight:normal">3：内存的使用</span></div>
<div style="font-size:15px"><span style="font-weight:normal">&nbsp; &nbsp; &nbsp; spark应用程序最纠结的地方就是内存的使用了，也是最能体现“细节是魔鬼”的地方。Spark的内存配置项有不少，其中比较重要的几个是：</span></div>
<div style="font-size:15px">
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li><span style="font-weight:normal">SPARK_WORKER_MEMORY，在conf/spark-env.sh中配置SPARK_WORKER_MEMORY 和SPARK_WORKER_INSTANCES，可以充分的利用节点的内存资源，SPARK_WORKER_INSTANCES*SPARK_WORKER_MEMORY不要超过节点本身具备的内存容量；</span></li><li><span style="font-weight:normal">executor-memory，在spark-shell或spark-submit提交spark应用程序时申请使用的内存数量；不要超过节点的SPARK_WORKER_MEMORY；</span></li><li><span style="font-weight:normal">spark.storage.memoryFraction spark应用程序在所申请的内存资源中可用于cache的比例</span></li><li><span style="font-weight:normal">spark.shuffle.memoryFraction&nbsp;spark应用程序在所申请的内存资源中可用于shuffle的比例</span></li></ul>
</div>
<div style="font-size:15px"><span style="font-weight:normal">在实际使用上，对于后两个参数，可以根据常用查询的内存消耗情况做适当的变更。另外，在SparkSQL使用上，有几点建议：</span></div>
<div style="font-size:15px">
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li><span style="font-weight:normal">对于频繁使用的表或查询才进行缓存，对于只使用一次的表不需要缓存；</span></li><li><span style="font-weight:normal">对于join操作，优先缓存较小的表；</span></li><li><span style="font-weight:normal">要多注意Stage的监控，多思考如何才能更多的Task使用PROCESS_LOCAL；</span></li><li><span style="font-weight:normal">要多注意Storage的监控，多思考如何才能Fraction cached的比例更多</span></li></ul>
</div>
<div style="font-size:15px">
<div><span style="font-weight:normal"><img alt="" src="./css/20141023112756150" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</span></div>
<span style="font-weight:normal">&nbsp;</span></div>
<div style="font-size:15px"><span style="font-weight:normal">4：合适的Task</span></div>
<div style="font-size:15px"><span style="font-weight:normal">&nbsp; &nbsp; &nbsp; 对于SparkSQL，还有一个比较重要的参数，就是shuffle时候的Task数量，通过spark.sql.shuffle.partitions来调节。调节的基础是spark集群的处理能力和要处理的数据量，spark的默认值是200。Task过多，会产生很多的任务启动开销，Task多少，每个Task的处理时间过长，容易straggle。</span></div>
<div style="font-size:15px"><span style="font-weight:normal"><br>
</span></div>
<div style="font-size:15px"><span style="font-weight:normal">5：其他的一些建议</span></div>
<div style="font-size:15px"><span style="font-weight:normal">&nbsp; &nbsp; &nbsp; 优化的方面的内容很多，但大部分都是细节性的内容，下面就简单地提提：</span></div>
<div style="font-size:15px">
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li><span style="font-weight:normal">想要获取更好的表达式查询速度，可以将spark.sql.codegen设置为Ture；</span></li><li><span style="font-weight:normal">对于大数据集的计算结果，不要使用collect() ,collect()就结果返回给driver，很容易撑爆driver的内存；一般直接输出到分布式文件系统中；</span></li><li><span style="font-weight:normal">对于Worker倾斜，设置spark.speculation=true 将持续不给力的节点去掉；</span></li><li><span style="font-weight:normal">对于数据倾斜，采用加入部分中间步骤，如聚合后cache，具体情况具体分析；</span></li><li><span style="font-weight:normal">适当的使用序化方案以及压缩方案；</span></li><li><span style="font-weight:normal">善于利用集群监控系统，将集群的运行状况维持在一个合理的、平稳的状态；</span></li><li><span style="font-weight:normal">善于解决重点矛盾，多观察Stage中的Task，查看最耗时的Task，查找原因并改善；</span></li></ul>
<div><span style="font-weight:normal"><br>
</span></div>
</div>
<div style="font-size:15px"><span style="font-weight:normal">&nbsp; &nbsp; &nbsp; 由于时间仓促，本篇在以后的版本再增加一些实例。</span></div>
</h2>
<h2><a name="t10"></a><a target="_blank" name="t10"></a><a target="_blank" href="http://blog.csdn.net/book_mmicky/article/details/40394005" rel="nofollow" style="line-height:30px; font-family:&#39;Microsoft YaHei&#39;; color:rgb(51,51,51); font-size:20px; text-decoration:none">十：总结</a></h2>
<div><span style="font-size:15px">回顾一下，在前面几章中，就sparkSQL1.1.0基本概念、运行架构、基本操作和实用工具做了基本介绍。</span><span style="line-height:26px; font-family:Arial; font-size:14px"></span>
<div style="font-size:15px">基本概念：</div>
<div style="font-size:15px">
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>SchemaRDD
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>Rule</li><li>Tree</li><li>LogicPlan</li><li>Parser</li><li>Analyzer</li><li>Optimizer</li><li>SparkPlan</li></ul>
</li><li>运行架构：
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>sqlContext运行架构</li><li>hiveContext运行架构</li></ul>
</li><li>基本操作
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>原生RDD的操作</li><li>parquet文件的操作</li><li>json文件的操作</li><li>hive数据的操作</li><li>和其他spark组件混合使用</li></ul>
</li><li>实用工具
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>hive/console的操作</li><li>CLI的配置和操作</li><li>ThriftServer的配置和操作</li></ul>
</li></ul>
</div>
<div style="font-size:15px">&nbsp; &nbsp; &nbsp; 由于时间仓促，有很多地方来不及详细，特别是第三章和第九章；另外还有一些新的特性没有介绍，比如列存储的实现过程、CODEGEN的源码分析等，将在后续的版本逐步完善。<wbr>
<div>&nbsp; &nbsp; &nbsp;从总体上来说，由于CLI的引入，使得sparkSQL1.1.0在易用性方面得到了极大地提高；而ThriftServer的引入，方便了开发者对基于SparkSQL的应用程序开发；hive/console的引入，极大地方面了开发者对sparkSQL源码的修改和调试；还有json数据的引入，不但扩充了sparkSQL的数据来源，同时对嵌套数据开始做了尝试。从Spark1.1.0开始，sparkSQL逐渐开始像是一个产品了，而不像spark1.0.0，感觉像是一个测试品。当然，由于sparkSQL项目的启动时间比较晚，到现在为止还不到一年，在很多方面还存在着不足：</div>
</div>
<div style="font-size:15px">
<ul style="padding-bottom:0px; margin:5px 0px 5px 40px; padding-left:0px; padding-right:0px; padding-top:0px">
<li>SQL-92语法的支持度，sparkSQL使用了一个简单的SQL语法解析器，对于一些复杂的语法没办法解析，比如三个表进行join的时候，不能一次性join，而要通过两两join后再join一次；</li><li>cost model ，虽然sparkSQL的catalyst在最初设计的时候就考虑到了cost model，但在现在的版本还没有引入。我们相信，未来引入cost model之后，sparkSQL的性能将得到进一步地提升；</li><li>并发性能，从impala得到的信息，sparkSQL的并发性能和impala相比，还是有不少的差距，这将是sparkSQL的一个发展方向。</li></ul>
<div>
<div><img alt="" src="./css/20141023111800750" style="border-bottom-style:none; border-right-style:none; max-width:100%; border-top-style:none; border-left-style:none"><br>
</div>
&nbsp;</div>
</div>
<div style="font-size:15px">&nbsp; &nbsp; &nbsp;&nbsp;</div>
</div>
</div>
</div>
</span></div>
</div>
</div>
</div>
</div>
<article>
</div>
</body>
</html>